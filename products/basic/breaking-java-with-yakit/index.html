<!doctype html>
<html class="docs-version-current" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Yak Official Website Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Yak Official Website Blog Atom Feed"><title data-react-helmet="true">使用 Yakit 打破 Java 序列化协议语言隔离 | Yak Official Website</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://yaklang.io/products/basic/breaking-java-with-yakit"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-CN"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-products-current"><meta data-react-helmet="true" property="og:title" content="使用 Yakit 打破 Java 序列化协议语言隔离 | Yak Official Website"><meta data-react-helmet="true" name="description" content="一句话背景知识"><meta data-react-helmet="true" property="og:description" content="一句话背景知识"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://yaklang.io/products/basic/breaking-java-with-yakit"><link data-react-helmet="true" rel="alternate" href="https://yaklang.io/products/basic/breaking-java-with-yakit" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://yaklang.io/en/products/basic/breaking-java-with-yakit" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://yaklang.io/products/basic/breaking-java-with-yakit" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.c23e1cf3.css">
<link rel="preload" href="/assets/js/runtime~main.4c706b91.js" as="script">
<link rel="preload" href="/assets/js/main.b72d8c2f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link diy-link-item">官方文档</a><ul class="dropdown__menu"><li><a href="/docs/intro" class="dropdown__link diy-link-item" target="_blank">Yak 语言</a></li><li><a href="/products/intro" class="dropdown__link diy-link-item" target="_blank">Yakit 平台</a></li></ul></div><a class="navbar__item navbar__link diy-link-item" href="/team">关于我们</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yaklang" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link diy-link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/products/intro">Yakit: 集成化单兵安全能力平台</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/products/download_and_install">下载与安装指南</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Yakit 中的基础安全工具</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/products/basic/local">特色：本地模式与远程模式</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/products/basic/load-resource">插件商店系统</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/products/basic/portscan">通用能力：端口扫描</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/products/basic/blasting-and-unauthorized-testing">爆破与未授权检测</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/products/basic/modular-fingerprint-scanning">模块化指纹扫描的“终极”形态</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/products/basic/update-nuclei-poc">专项漏洞数据库更新</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/products/basic/breaking-java-with-yakit">使用 Yakit 打破 Java 序列化协议语言隔离</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Yakit 技术论述</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Web Fuzzer超全解析</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Yakit技术研究</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Yakit 插件体系最佳实践</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Yakit 编程最佳实践</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Yakit 实战案例</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">研发技术漫谈: 技术解析</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">__已过时的文档</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>使用 Yakit 打破 Java 序列化协议语言隔离</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="一句话背景知识"></a>一句话背景知识<a class="hash-link" href="#一句话背景知识" title="Direct link to heading">#</a></h2><p>众所周知，在使用 Java 编写漏洞利用或检测时，ysoserial 或类似工具会构造一个特定的执行命令的对象，然后进行序列化，作为用户只把序列化（Marshal）后的二进制对象作为 Payload，打到特定位置或注册为远程对象，通过 RMI 或者远程服务 readObject 后直接 RCE。
虽然这是一个人人都知道的过程。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="威胁"></a>威胁<a class="hash-link" href="#威胁" title="Direct link to heading">#</a></h2><p>当然，“赛博回忆录-反制系列” 针对这个问题做了详细的文章，Java 实现的漏洞利用实际上是一把 “双刃剑”，在使用各种链来构造特定反序列化流的同时，自己也是一个“靶子”。
其实早在反制系列出现之前，笔者在长亭工作时，子航师傅就提过 Java RMI 的反制，可以做到放一个 1099 RMI 蜜罐在公网，谁来打就打回去反向 RCE。这个原理也非常容易理解。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="如何不被反制？"></a>如何不被“反制”？<a class="hash-link" href="#如何不被反制？" title="Direct link to heading">#</a></h2><p>大家做漏洞扫描这类安全开发的时候，非常头痛的事情在于，偏爱 Python 或 Golang，不考虑用 Java 实现。</p><p>就直接导致很多 Java 漏洞的检测变得非常扭曲。</p><p>如果用了 Java 又需要思考如何不被反制，用户需要严格控制不要加载任何来源于攻击者的类或者流。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="现状："></a>现状：<a class="hash-link" href="#现状：" title="Direct link to heading">#</a></h3><p>市面上关于有 Java 相关的漏洞扫描现在主流分两类：</p><ol><li><span style="background:#fff67acc">依赖 Java 环境</span>，并且 ysoserial.jar 作为扫描器依赖打包，以 Popen / system / subprocess / Exec 调用 java -jar ysoserial.jar 来生成特定 Payload 来进行漏洞检测或攻击。</li><li><span style="background:#fff67acc">另一类选择硬编码利用链的 Payload，然后根据执行命令的 Payload 长度构造合适的 “块”</span>，替换原 Payload 位置，从而构造出一个可用的 Payload。大家常见的 xray 就是通过 “硬编码” 来实现利用链的。</li></ol><p>众所周知，针对一些 Groovy 链和常见的 CC1 链都是可以直接找到对应的命令的位置，直接替换即可。实际在第二种实现中，有着非常大的限制：TemplatesImpl </p><blockquote><p><a href="http://com.sun.org" target="_blank" rel="noopener noreferrer">com.sun.org</a>.apache.xalan.internal.xsltc.trax.TemplatesImpl 模版是很多链执行命令的关键。</p></blockquote><p>尝试过进行一些分析的读者其实非常清楚，我们在有 TemplatesImpl 的链（例如 CC2[CommonCollections2] / CC3 / CC4）中，无法直接 “搜到” 执行的命令的关键字。其实本质上是因为，有一些命令和代码被编译成了 “Java 字节码”，然后又被序列化成了 “TC_BLOCKDATA”，表象就是，每个字节都加了 Padding，我们发现无法 “搜” 到对应 string 了。当然，我们也可以人为去做 “Padding”，然后把 Payload 自己去 Padding 后塞入链中特定位置，也可以构造出一个 “可用” 的 Payload。</p><p>作为对比，第一种实现写的代码更少，调用别人的东西而已，无非多启动几个进程；“被反制风险” 当然不言而喻，如果启用 RMI 去攻击，那么被反制可以说是“咎由自取”了。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="透过现象看本质"></a>透过现象看本质<a class="hash-link" href="#透过现象看本质" title="Direct link to heading">#</a></h2><p>本质上 Java 序列化协议 和 Json 从解决问题的角度来说，没有任何区别：都是<span style="background:#fff67acc">为了让数据可以脱离 “程序” 单独存在，进行传输或持久化</span>。只是载体不一样而已。</p><p>我们可以很容易理解 Json，其实 Java 序列化协议一样，protobuf 也一样，Bson，Gson，xml 都有这个目的，并且可以说是主要目的。</p><p>被反制并不是说只有 Java 反序列化过程会出现问题，PHP 也一样，fastjson 甚至是在反序列化 Json 的过程中，加载了不该加载的东西。</p><p>然而要兼容反序列化协议其实并不难，甚至我们可以脑洞一下，我们能把 Java 序列化流中的对象都解析出来，然后经过一些格式检查存储成更利于大家观察的 Json，并且，大家可以修改了 Json 之后，再按照 Java 序列化的协议组合回去。</p><blockquote><p><a href="https://docs.oracle.com/javase/7/docs/platform/serialization/spec/protocol.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/7/docs/platform/serialization/spec/protocol.html</a>
<a href="https://docs.oracle.com/en/java/javase/17/docs/specs/serialization/protocol.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/en/java/javase/17/docs/specs/serialization/protocol.html</a></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="talk-is-cheap"></a>Talk is Cheap<a class="hash-link" href="#talk-is-cheap" title="Direct link to heading">#</a></h2><p>其实笔者并不愿意花大量的笔墨来介绍 Java 序列化协议，这些内容其实如果大家稍有研究的话，属于基础知识。我们可以直接来观察一个基础例子：</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="从一片落叶开始：tc_string"></a>从一片落叶开始：TC_STRING<a class="hash-link" href="#从一片落叶开始：tc_string" title="Direct link to heading">#</a></h3><p>我们从最简单的案例开始：我们从字符串对象的序列化开始</p><p><img src="/assets/images/breaking-TC_STRING-7ef8aad36cefee2e4a168e1e36f83078.png"></p><p>通过执行上面的代码，我们发现执行的结果为：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly makefile"><pre tabindex="0" class="prism-code language-makefile codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rO0ABXQAFnlha2xhbmcuaW8taXMtYXdlc29tZSE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>当我们把上述的内容变为十六进制的时候，我们熟悉的 ACED 出现了。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly nginx"><pre tabindex="0" class="prism-code language-nginx codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aced000574001679616b6c616e672e696f2d69732d617765736f6d6521</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>在我们小工具中，我们选择 “Codec =&gt; Java =&gt; 反序列化 Java 对象流（Hex）” </p><p><img src="/assets/images/breaking-java-hex-2c58f6efbd9e315d5cbbbe8c06fbae42.png"></p><p>可以发现我们把左边的序列化的流转换成了一段 JSON</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">116</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;type_verbose&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TC_STRING&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;is_long&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;size&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">22</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;raw&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;eWFrbGFuZy5pby1pcy1hd2Vzb21lIQ==&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;value&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;yaklang.io-is-awesome!&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;handle&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>同样的，我们把序列化后的内容放在左栏，选择 “Java =&gt; Java 对象流序列化(JSON=&gt;HEX)” 即可还原我们的 TC_STRING 变成 ACED 开头的 Java 对象流。</p><p><img src="/assets/images/breaking-java-reduction-53b26358cd3eb0a8fb83908935dc7c71.png"></p><p>当然，虽然这个工具看起来非常简单，但是绝对也不仅仅是生成 / 还原一下 HEX。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="serialdumper-的-yaklangio-版本"></a>SerialDumper 的 yaklang.io 版本<a class="hash-link" href="#serialdumper-的-yaklangio-版本" title="Direct link to heading">#</a></h3><p>我们 Java 序列化协议的实现过程中，增加了和 SerialDumper 一样的功能。</p><p><img src="/assets/images/breaking-java-serial-dumper-07146321738b07acf6e51eb46894d97f.png"></p><p>熟悉 Java 反序列化的同学也可能都对 SerialDumper 非常熟悉，通常，我们能直接查看一个 ACED 二进制流的工具并不多</p><blockquote><p>SerialDumper 是 Java 反序列化漏洞大热的时候 toptensoftware 开源的一款序列化分析工具。</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="复杂案例（一）：可读化cc1-利用链"></a>复杂案例（一）：“可读化”CC1 利用链<a class="hash-link" href="#复杂案例（一）：可读化cc1-利用链" title="Direct link to heading">#</a></h3><p>当然，如果仅仅只能序列化一个 TC_STRING 其实是很鸡肋的。我们尝试一些更复杂的序列化流。</p><p>笔者使用 </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Bash"><pre tabindex="0" class="prism-code language-Bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">java -jar ysoserial.jar CommenCollections1 &quot;YAKITEXT&quot; &gt; cc1.ser &amp;&amp; yak hex -f cc1.ser</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>当然 yak hex 命令是 yak 引擎自带的小工具，可以把一个文件以十六进制的形式打印出来。不安装 yak 也有很多种办法可以做到。</p><video src="https://yaklang.oss-cn-beijing.aliyuncs.com/video/yakit-hex.mp4" loop="" playsinline="" controls="" autoplay="" style="width:890px"></video><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="复杂案例（二）：cc1-利用链与-json-互可逆"></a>复杂案例（二）：CC1 利用链与 JSON 互可逆<a class="hash-link" href="#复杂案例（二）：cc1-利用链与-json-互可逆" title="Direct link to heading">#</a></h3><p>当然，我们发现，仿 SerialDumper 的实现在大多数时候，虽然可读性增强了，但是并不可逆，我们针对这种情况，实现了 ACED 反序列化流与 JSON 的互转。</p><p>虽然在 “从一片落叶开始” 中，我们已经发现了这个特性，但是还不够复杂，实战 ysoserial 的案例的展示更有那味儿。</p><video src="https://yaklang.oss-cn-beijing.aliyuncs.com/video/yakit-ysoserial.mp4" loop="" playsinline="" controls="" autoplay="" style="width:890px"></video><blockquote><p>额外说明：虽然大多数大家看到的反序列化后的对象都是 TC_XXX 开头的对象，但是偶尔会出现 X_CLASSDATA 这类
‘X’ 开头的对象名称，这些并不是 Java 中的，而是 yaklang.io 为了方便让其对象更容易可逆互转认为进行了结构分
割。</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="结语与意外"></a>结语与意外<a class="hash-link" href="#结语与意外" title="Direct link to heading">#</a></h2><p>“最后几块拼图” 其实说的是作为一个常年和漏洞扫描算法与扫描装置斗争的代码崽，尝试花一点时间来做“最后一英里”的事情。其实这个思路和操作并不是独一无二的，世界上并没有那么多 “独一无二” 的东西可以给大家来搞。</p><blockquote><p>在完成这个模块的时候，我和 @phith0n P 牛提起这个事儿，他：“卧槽？我也写了一个这玩意”。<br>
嗯...  </p><p>果然在没有任何预兆的情况下和大家撞车了。</p></blockquote><p>当然，对 P 师傅来说，这个项目还不够深入，比如，Java 字节码本质上也可以变成这样的形式，这一块因为各种原因，还没来得及实现完毕，也算是遗憾；在后续的项目中，我们团队也会进行 Java 字节码的生成的工作。</p><p>但是对于 yaklang.io 来说，这个项目并不是结束，我们基于这个项目可以做非常优秀的扩展</p><ol><li>更安全，平台无关的 ysoserial payload generator 的实现</li><li>更安全的 RMI Exploit</li></ol><p>回到项目刚开始和大家讲的，我们要做 “安全能力基座”，拼图当然要拼完。</p><p>当然，Java 序列化流分析也只是一部分，yak 语言也将会开放 java 各种序列化流处理和分析的接口，方便大家随时使用与集成。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="version-note"></a>Version Note:<a class="hash-link" href="#version-note" title="Direct link to heading">#</a></h3><ol><li>Yakit 版本 &gt;= Yakit 1.0.11-sp6 </li><li>yak 核心引擎 &gt;= 1.0.11-sp9</li></ol><p>大家在安装最新版本的 Yakit 和 yak 核心引擎的之后，就可以使用本文录屏和截屏中的 Java 序列化流分析工具（Codec =&gt; Java）。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h3><blockquote><p>SerialDumper (hxxps://github[dot]com/toptensoftware/serialdump)
Java序列化协议 <a href="https://docs.oracle.com/javase/7/docs/platform/serialization/spec/protocol.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/7/docs/platform/serialization/spec/protocol.html</a></p></blockquote></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/products/basic/update-nuclei-poc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 专项漏洞数据库更新</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/products/professional/yak-script-system"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">技术总览：&quot;地表最强&quot; 的插件系统 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一句话背景知识" class="table-of-contents__link">一句话背景知识</a></li><li><a href="#威胁" class="table-of-contents__link">威胁</a></li><li><a href="#如何不被反制？" class="table-of-contents__link">如何不被“反制”？</a><ul><li><a href="#现状：" class="table-of-contents__link">现状：</a></li></ul></li><li><a href="#透过现象看本质" class="table-of-contents__link">透过现象看本质</a></li><li><a href="#talk-is-cheap" class="table-of-contents__link">Talk is Cheap</a><ul><li><a href="#从一片落叶开始：tc_string" class="table-of-contents__link">从一片落叶开始：TC_STRING</a></li><li><a href="#serialdumper-的-yaklangio-版本" class="table-of-contents__link">SerialDumper 的 yaklang.io 版本</a></li><li><a href="#复杂案例（一）：可读化cc1-利用链" class="table-of-contents__link">复杂案例（一）：“可读化”CC1 利用链</a></li><li><a href="#复杂案例（二）：cc1-利用链与-json-互可逆" class="table-of-contents__link">复杂案例（二）：CC1 利用链与 JSON 互可逆</a></li></ul></li><li><a href="#结语与意外" class="table-of-contents__link">结语与意外</a><ul><li><a href="#version-note" class="table-of-contents__link">Version Note:</a></li><li><a href="#reference" class="table-of-contents__link">Reference</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="div--flex footer__bottom text--center"><div class="footer-logo-copyright-navigation"><div class="margin-bottom--sm"><a class="footer-link" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright copyright-style">Copyright © 2022 for Yak Project. Own by v1ll4n. Powered by Docusaurus</div><div class="link-body"><a class="footer__link-item" href="/docs/intro" target="_blank">官方文档</a><a class="footer__link-item" href="/team">研发团队</a></div></div><div class="footer-contact-me"><a href="https://github.com/yaklang/yakit" target="_blank" class="contact-icon-body"><span role="img" aria-label="github" class="anticon anticon-github icon-style github-icon"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></span></a><div class="contact-icon-body"><span role="img" aria-label="wechat" class="anticon anticon-wechat icon-style wechat-icon"><svg viewBox="64 64 896 896" focusable="false" data-icon="wechat" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M690.1 377.4c5.9 0 11.8.2 17.6.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6a21.5 21.5 0 019.1 17.6c0 2.4-.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-.1 17.8-.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8zm-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1zm-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1zm586.8 415.6c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7a9 9 0 006.4-2.6 9 9 0 002.6-6.4c0-2.2-.9-4.4-1.4-6.6-.3-1.2-7.6-28.3-12.2-45.3-.5-1.9-.9-3.8-.9-5.7.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9zm179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9a36.08 36.08 0 01-36 35.9z"></path></svg></span></div></div></div></div></footer></div>
<script src="/assets/js/runtime~main.4c706b91.js"></script>
<script src="/assets/js/main.b72d8c2f.js"></script>
</body>
</html>