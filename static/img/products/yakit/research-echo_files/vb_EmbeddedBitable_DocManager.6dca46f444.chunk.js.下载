(window.webpackJsonp=window.webpackJsonp||[]).push([["3c4462be8a3d","9f26a15f70c2","6566a5520d19","de20b5688127","55f14c389d78"],{vb1043:function(e,n,t){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}n.__esModule=!0,r(t("vb1044"))},vb1044:function(e,t,n){"use strict";t.__esModule=!0;var i=n("vb108"),o=n("vb395"),s=n("vb1045"),l=n("vb676");function r(t,e){var n=void 0;var r=i.default({context:t,sagaMonitor:n,onError:e}),a=o.getRefCountedManager(s.getSagaManager(r),l.sagaEquals);return{middleware:[r],onModuleManagerCreated:function(e){t&&(t.moduleManager=e)},onModuleAdded:function(e){e.sagas&&a.add(e.sagas)},onModuleRemoved:function(e){e.sagas&&a.remove(e.sagas)},dispose:function(){a.dispose()}}}t.getSagaExtension=r},vb1045:function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)r[a]=i[o];return r};t.__esModule=!0;var a=n("vb676"),i=n("vb395");function o(t){var n=i.getMap(a.sagaEquals);return{getItems:function(){return r(n.keys)},add:function(e){e&&e.forEach(function(e){e&&!n.get(e)&&n.add(e,s(t,e))})},remove:function(e){e&&e.forEach(function(e){n.get(e)&&n.remove(e).cancel()})},dispose:function(){n.keys.forEach(function(e){return n.get(e).cancel()})}}}function s(e,t){if("function"==typeof t){var n=t;return e.run(n)}var r=t.saga,a=t.argument;return e.run(r,a)}t.getSagaManager=o},vb1046:function(e,t,n){"use strict";t.__esModule=!0;var r=n("vb198");function a(){return{middleware:[r.default]}}t.getThunkExtension=a},vb1047:function(e,h,f){"use strict";(function(s){f.d(h,"a",function(){return u});var e=f("vb253"),d=f.n(e),t=f("vb56"),l=f.n(t),n=f("vb64"),a=f.n(n),r=f("vb234"),i=f.n(r),o=f("vb235"),c=f.n(o),u=function(){function r(e,t,n){var o=this;i()(this,r),this.components=e,this.contentManager=t,this.displayMultiple=n,this.notifyCommentLoadedMap=new Map,this.notifyCommentBatchUpdateMap=new Map,this.comments=null,this.getComments=function(e){var t=o.getComponents(e);return t?t.getComments(e):o.getDefaultComments(e)},this.setOnCommentBatchUpdate=function(e,t,n){var r=o.getComponents(e);r?r.setCommentBatchUpdate(e,t,n):o.setNotifyCommentBatchUpdateFn(e,t)},this.setCommentData=function(e,t){o.comments=t.comments;var n=o.getComponents(e);if(!n){var r=o.getDefaultComments(e),a=o.getNotifyCommentBatchUpdateFn(e);return a&&a(r),Promise.resolve()}return n.setCommentData(e,t)},this.startNewComment=function(e,t,n){var r=o.getComponents(e);if(r)return r.startNewComment(e,t,n)},this.getResolvedComments=function(e){var t=o.getComponents(e);return t?t.getResolvedComments(e):[]},this.setResolvedCommentIds=function(e,t){var n=o.getComponents(e);if(n)return n.setResolvedCommentIds(e,t)},this.addHoverHighlight=function(e,t){var n=o.getComponents(e);if(n)return n.addHoverHighlight(e,t)},this.removeHoverHighlight=function(e,t){var n=o.getComponents(e);if(n)return n.removeHoverHighlight(e,t)},this.resolveComment=function(){var n=a()(l.a.mark(function e(t,n){var r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.resolveComment(t,n));case 4:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),this.activateComment=function(e,t){var n=o.getComponents(e);if(n)return n.activateComment(e,t)},this.deactivateComment=function(e,t){var n=o.getComponents(e);if(n)return n.deactivateComment(e,t)},this.reopenComment=function(){var n=a()(l.a.mark(function e(t,n){var r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.reopenComment(t,n));case 4:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),this.findComment=function(){var n=a()(l.a.mark(function e(t,n){var r,a,i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.getComponents(t)){e.next=5;break}return a=o.getDefaultComments(t),i=a.find(function(e){return e.commentId===n}),e.abrupt("return",i);case 5:return e.abrupt("return",r.findComment(t,n));case 7:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),this.getTeaParams=function(e,t){var n=o.getComponents(e);if(n)return n.getTeaParams(e,t)},this.getSmartableCommentManager=function(e){var t=o.getComponents(e);if(t)return t.getSmartableCommentManager(e)},this.getCommentPositions=function(e){var t=o.getComponents(e);if(t)return t.getCommentPositions(e)}}return c()(r,[{key:"setNotifyCommentLoadedFn",value:function(e,t){this.notifyCommentLoadedMap.set(e,t)}},{key:"getNotifyCommentLoadedFn",value:function(e){return this.notifyCommentLoadedMap.get(e)}},{key:"setNotifyCommentBatchUpdateFn",value:function(e,t){this.notifyCommentBatchUpdateMap.set(e,t)}},{key:"getNotifyCommentBatchUpdateFn",value:function(e){return this.notifyCommentBatchUpdateMap.get(e)}},{key:"getDefaultComments",value:function(e){var t=[],n=this.contentManager.dataSource.getSource().base.getTableById(e);if(!n)return t;var r=this.contentManager.dataSource.getShowingViewId(n.id),a=r?n.getViewById(r):n.views[0];if(!a)return t;var i=a.getVisibleRecords(),o=this.generateTableCommentMap(n),s=Object.keys(o);if(i)for(var l=0;l<s.length;l++){var c=s[l];if(i.includes(c)){var u=(o[c]||[]).filter(function(e){return!e.isResolved});t.push.apply(t,d()(u))}}return t}},{key:"generateTableCommentMap",value:function(e){var t=this.comments,o={};if(t&&e&&0<t.length)for(var n=e.commentMap||{},r=Object.keys(n),a=function(e){var a=r[e],i=n[a];if(i&&i.length<0)return"continue";t.forEach(function(e){var t=e.commentId,n=e.finish;if(i&&i.includes(t)){var r={recordId:a,commentId:t,quote:s("bitable.comment_title",""),isResolved:!!n,offsetTop:0,offsetHeight:0};o[a]?o[a]=o[a].concat(r):o[a]=[r]}})},i=0;i<r.length;i++)a(i);return o}},{key:"getComponents",value:function(e){var t=this.components.get(e);return this.displayMultiple||(t=this.components.values().next().value),t}},{key:"getActiveComments",value:function(e){var t=this.getComponents(e);return t?t.getActiveComments(e):[]}},{key:"saveComment",value:function(){var r=a()(l.a.mark(function e(t,n,r){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",a.saveComment(t,n,r));case 4:case"end":return e.stop()}},e,this)}));function e(e,t,n){return r.apply(this,arguments)}return e}()},{key:"removeComment",value:function(){var n=a()(l.a.mark(function e(t,n){var r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.removeComment(t,n));case 4:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"removeTempComment",value:function(){var n=a()(l.a.mark(function e(t,n){var r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.removeTempComment(t,n));case 4:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()}]),r}()}).call(this,f("vb153"))},vb1048:function(e,f,b){"use strict";(function(n){b.d(f,"a",function(){return h});var e=b("vb56"),s=b.n(e),t=b("vb234"),r=b.n(t),a=b("vb235"),i=b.n(a),o=b("vb64"),l=b.n(o),c=b("vb53");function u(e,t,n,r){return d.apply(this,arguments)}function d(){return(d=l()(s.a.mark(function e(t,n,r,a){var i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new FormData).set("token",r),i.set("tableId",a),i.set("srcToken",t),i.set("srcTableId",n),i.set("rev","0"),e.abrupt("return",c.request.post(Object(c.prependAPI)("/api/bitable/applytemplate/"),i,{headers:{"Content-Type":"multipart/form-data"}}));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var h=function(){function t(e){var o=this;r()(this,t),this.useTemplate=function(){var t=l()(s.a.mark(function e(t){var n,r,a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.templateToken,r=t.tableId,e.prev=1,a=o.dataSource.getToken(),e.next=5,u(n,"",a,r);case 5:return i=e.sent,o.dataSource.fetchTableToMaxVersion(r,1),e.abrupt("return",i);case 10:return e.prev=10,e.t0=e.catch(1),o.showError(e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}},e,null,[[1,10]])}));return function(e){return t.apply(this,arguments)}}(),this.dataSource=e}return i()(t,[{key:"showError",value:function(e){console.error(e),c.Toast.show({type:"error",closable:!0,content:n("common.apply_template_fail")})}}]),t}()}).call(this,b("vb153"))},vb1049:function(e,x,D){"use strict";(function(a){D.d(x,"a",function(){return B});var e=D("vb56"),i=D.n(e),t=D("vb64"),n=D.n(t),r=D("vb60"),o=D.n(r),s=D("vb234"),l=D.n(s),c=D("vb235"),u=D.n(c),d=D("vb300"),h=D.n(d),f=D("vb287"),b=D.n(f),v=D("vb241"),p=D.n(v),m=D("vb58"),g=D.n(m),y=D("vb526"),_=D("vb114"),w=D("vb90"),S=D("vb53"),k=(D("vb679"),D("vb420")),C=D("vb421"),T=D("vb680");function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var O=!0,M=function(t){function o(e){var n;return l()(this,o),(n=t.call(this,I({},e,{isVCEnable:O}))||this).getCommentPositions=function(e){return n.smartableCommentManager.getCommentPositions(e)},n.setHistory=function(){n.renderer.storageManager.setHistory(n.props.history)},n.loadedTable=function(e){n.renderer.loadedTable(e)},n.switchTable=function(e){n.renderer.switchTable(n.bitableStore.base,e)},n.addNewTable=function(e){var t=n.bitableStore.base;S.store.dispatch(Object(_.updateTables)(t)),n.renderer.addNewTable(t,e),n.setState({delayLoading:!0},function(){requestAnimationFrame(function(){return n.state.delayLoading&&n.setState({delayLoading:!1})})})},n.handleUploadError=function(e){var t=e&&e.errorType;if(S.BearWebHelper&&!S.BearWebHelper.isLark()&&S.Constant&&t===S.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_CREATE_LIMIT)S.BearWebHelper.triggerStoragePicLimitDialog();else{if(S.BearWebHelper&&S.Constant&&t===S.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_USER_STORAGE_LIMIT){var n={mountPoint:e.mountPoint,mountNodeToken:e.parentToken},r={meta:{}};return e.file.data.viewType===_.ViewType.Form&&(r.meta.reason="bitable_form_upload_file"),void S.BearWebHelper.triggerUserPicLimitDialog(n,r)}S.Toast.show({type:"error",content:a("common.server_busy")})}},n}return p()(o,t),u()(o,[{key:"componentDidMount",value:function(){var e=n()(i.a.mark(function e(){var t,n,r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h()(b()(o.prototype),"componentDidMount",this).call(this),t=this.props,n=t.tableId,r=t.mountOption,!(a=r.operator)){e.next=7;break}return e.next=6,this.bitableStore.waitTableClientVarLoaded(n);case 6:a.onTableLoaded&&a.onTableLoaded();case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"componentDidUpdate",value:function(e){h()(b()(o.prototype),"componentDidUpdate",this).call(this,e);var t=this._token;if(e.token===t){if(!Object(_.isShortCut)())return;var n=this.props.query,r=e.query,a=n.get(_.QUERY_TABLE_KEY)||null,i=n.get(_.QUERY_VIEW_KEY)||null;(a!==r.get(_.QUERY_TABLE_KEY)||i!==r.get(_.QUERY_VIEW_KEY))&&a&&i&&this.renderer&&this.renderer.switchView(this.bitableStore.base,a,i)}this.props.onLoaded&&!this._onMountFired&&(this._onMountFired=!0,this.props.onLoaded()),this.props.onRecover&&this.addRecoverCallback(this.props.onRecover)}},{key:"componentWillReceiveProps",value:function(e){e.isEditMode!==this.props.isEditMode&&(!1===e.isEditMode?this.freeze():this.unfreeze())}},{key:"initCommentManager",value:function(){var e=this.bitableStore,t=this.renderer,n=this.props,r=n.mountOption,a=n.suiteToken,i=n.suiteType,o=r.operator,s={onTableLoaded:o.onTableLoaded,onBatchUpdateBlockComment:o.onBatchUpdateBlockComment,onStartNewComment:o.onStartNewComment};this.commonInit=new T.a({suiteToken:a,suiteType:i});var l=S.CommentHelper&&S.CommentHelper.sheetNewCommentEnable;this.smartableCommentManager=new _.AloneSmartableCommentManager({renderer:t,bitableStore:e,comment:s,customCommentCard:l?C.b:void 0,customCommentBar:l?C.a:void 0})}},{key:"render",value:function(){var e=this.props,t=e.bitableStore,n=e.token,r=e.tableId,a=e.viewId,i=e.onTableChangedInUndo,o=e.mountOption,s=this.state,l=s.suspend,c=s.height,u=s.delayLoading,d=o.hideComment,h=o.isTemplateMode,f=!(S.browser.isFeed||d);return l?null:g.a.createElement(_.SheetBitable,{token:n,bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,tableId:r,viewId:a,onTableChangedInUndo:i,mountOption:o,ready:!0,isTemplateMode:h,height:c,delayLoading:u,IOConfig:{IO:S.IO.getInstance()},bitableConfig:{attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:S.SOURCE_ENUM.SHEET},ui:{showComment:f}},isVCEnable:O})}}]),o}(y.a),B=Object(w.connect)(function(e,t){var n=!S.SuiteReduxSelector||!S.SuiteReduxSelector.selectIsInEditMode||S.SuiteReduxSelector.selectIsInEditMode(e);return{tableId:Object(_.activeTableIdSelector)(e)||t.tableId,viewId:Object(_.activeViewIdSelector)(e),query:Object(S.selectQuery)(e),isEditMode:n,editable:Object(k.a)(e),suiteType:S.SuiteReduxSelector.selectCurrentSuiteType(e),suiteToken:S.SuiteReduxSelector.selectCurrentSuiteToken(e)}})(M)}).call(this,D("vb153"))},vb1050:function(e,t,n){},vb1051:function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return b});var r,a,i=n("vb53"),o=n("vb172"),s=n.n(o);(a=r||(r={}))[a.UNDEFINED=0]="UNDEFINED",a[a.FEED=1]="FEED",a[a.ANNOUNCE=2]="ANNOUNCE",a[a.MINUTE=3]="MINUTE";var l="report";function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return s.a.parseUrl(e).query}function u(e){if(!i.browser.isFeed)return 0;var t=+e.lark||1;switch(e.open_type){case"announce":t=r.ANNOUNCE;break;case"meeting_notes":t=r.MINUTE}return t}function d(e){return u(c(e))}function h(){return d(location.href)===r.ANNOUNCE}function f(){var e=c(location.href);return!!e&&e.open_type===l}function b(){return"true"===c(window.location.search).hideCommentBtn}},vb1052:function(e,h,f){"use strict";(function(r){f.d(h,"a",function(){return d});var e=f("vb234"),a=f.n(e),t=f("vb235"),i=f.n(t),n=f("vb241"),o=f.n(n),s=f("vb58"),l=f.n(s),c=f("vb1053"),u=(f("vb1054"),f("vb114")),d=function(t){function n(){var e;return a()(this,n),(e=t.apply(this,arguments)||this).blockInfo=function(e){var t=r("bitable.bitable");return e===u.EErrorCodeType.copyError?r("CreationDoc_DocX_duplicate_block_failed_content",t):t+r("CreationDoc_Docs_Diagram.LoadingFailed.Desc")},e}return o()(n,t),i()(n,[{key:"componentDidMount",value:function(){var e=this.props.errorCodeType,t=void 0===e?u.EErrorCodeType.dataError:e;u.BitableDep.collectBitableEvent("client_bitable_in_doc_error_block",{block_type:t})}},{key:"render",value:function(){var e=this.props,t=e.errorCodeType,n=void 0===t?u.EErrorCodeType.dataError:t,r=e.offsetX;return l.a.createElement("div",{className:"block-error-view",style:{marginLeft:r}},l.a.createElement("div",{className:"block-error-view-img"},l.a.createElement(c.a,null)),l.a.createElement("div",{className:"block-error-view-text"},this.blockInfo(n)))}}]),n}(l.a.Component)}).call(this,f("vb153"))},vb1053:function(e,t,n){"use strict";var r=n("vb381"),a=n.n(r),i=n("vb58"),o=n.n(i);function s(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}t.a=function(e){e.styles;var t=s(e,["styles"]);return o.a.createElement("svg",a()({width:"88",height:"88",viewBox:"0 0 88 88",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("g",{clipPath:"url(#6dd800fc94d8ef6d718de2ecabdae5e2-a)"},o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M37.62 32.08l-1.5 6.01-22.78 7.52s-1.2-5.41 9.89-12.03c4.22-2.52 1.73-3.84.9-4.81-1.8-2.1.6-3.6 4.2-5.11 3.58-1.5 0-3.01-.6-5.87-.6-2.85 4.8-9.77 11.39-11.28 6.59-1.5 16.66-.81 15.28 10.23-.3 2.4-.6 4.21-.6 4.21s-.6-2.1-3-1.2c-1.94.73-.9 2.1-3.6 0-2.39-1.2-5.39-3.91-5.09-7.52-1.8 2.7-3.3 5.41-6.9 6.61-.9 10.83 2.4 13.24 2.4 13.24z",fill:"#18263C"}),o.a.createElement("path",{d:"M48.7 24.86s5.1-.3 4.8-3.6c-.3-3.32-4.2-.31-4.2-.31M35.22 18.54s-1.3 14.25 5.1 14.44",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),o.a.createElement("path",{d:"M13.64 45.31l22.48-7.22 1.5-5.71M26.12 44.06s4.03 14.03 17.06 10.22c13.04-3.8 10.67-19.5 10.67-19.5M42.11 11.93c-.6.3-1.5 5.11-8.69 7.52M49 20.95s-5.69-2.7-6.29-6.32",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M38.88 23.12c-.43.43-1.12.43-1.54 0a1.1 1.1 0 0 1 0-1.55 1.09 1.09 0 0 1 1.54 0 1.1 1.1 0 0 1 0 1.55zM45.52 22.86a1.1 1.1 0 1 1-2.19 0 1.1 1.1 0 0 1 2.19 0z",fill:"#18263C"}),o.a.createElement("path",{d:"M40.91 28.47l-1.8.3 1.5-6.62",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M53.2 22.75l-1.5 9.63-5.7 2.1v-3.9s2.4-4.22 2.7-5.42c0 0 1.61-.42 2.1-.6.65-.24 2.4-1.8 2.4-1.8z",fill:"#18263C"}),o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.32 74.01h61.4V30.1H9.31V74z",fill:"#D6DAE1"}),o.a.createElement("path",{d:"M39.54 29.57l-2.83 22.22h5.67l-3.3 22.22",stroke:"#fff"}),o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M62.73 30h7.9v-3.95h-7.9V30z",fill:"#FFC200"}),o.a.createElement("path",{d:"M.53 42.48l4.93-.41c4.98-.42 11.21-8.34 14.12-7.92 2.9.41-4.15 6.25-1.66 9.17 2.78 3.25 16.2-.84 15.78 2.91-.41 3.75-15.36 5-15.78 2.92-.41-2.08 17.86 0 17.86 3.75s-17.86 3.34-18.27 1.67c-.42-1.67 15.78.42 15.78 3.75s-16.62 3.33-17.03 1.67c-.42-1.67 14.56 1.13 14.12 3.33-.83 4.17-30.26 2.5-30.26 2.5M79.4 42.48l-4.92-.41c-4.99-.42-11.22-8.34-14.12-7.92-2.91.41 4.15 6.25 1.66 9.17-2.78 3.25-16.2-.84-15.78 2.91.41 3.75 15.36 5 15.78 2.92.41-2.08-17.86 0-17.86 3.75s17.86 3.34 18.27 1.67c.42-1.67-15.78.42-15.78 3.75s16.61 3.33 17.03 1.67c.42-1.67-14.56 1.13-14.12 3.33.83 4.17 30.26 2.5 30.26 2.5",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"})),o.a.createElement("defs",null,o.a.createElement("clipPath",{id:"6dd800fc94d8ef6d718de2ecabdae5e2-a"},o.a.createElement("path",{fill:"#fff",d:"M0 0h88v88H0z"}))))}},vb1054:function(e,t,n){},vb1055:function(T,E,I){(function(e){var C,t,n;t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:this,n=function(t){"use strict";var n,r=t.Base64,e="2.4.3";if(T.exports)try{n=I("vb130").Buffer}catch(e){}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(a),o=String.fromCharCode,s=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?o(192|t>>>6)+o(128|63&t):o(224|t>>>12&15)+o(128|t>>>6&63)+o(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return o(240|t>>>18&7)+o(128|t>>>12&63)+o(128|t>>>6&63)+o(128|63&t)},l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,c=function(e){return e.replace(l,s)},u=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(1<e.length?e.charCodeAt(1):0)<<8|(2<e.length?e.charCodeAt(2):0);return[a.charAt(n>>>18),a.charAt(n>>>12&63),2<=t?"=":a.charAt(n>>>6&63),1<=t?"=":a.charAt(63&n)].join("")},d=t.btoa?function(e){return t.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,u)},h=n?n.from&&n.from!==Uint8Array.from?function(e){return(e.constructor===n.constructor?e:n.from(e)).toString("base64")}:function(e){return(e.constructor===n.constructor?e:new n(e)).toString("base64")}:function(e){return d(c(e))},f=function(e,t){return t?h(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):h(String(e))},b=function(e){return f(e,!0)},v=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),p=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return o(55296+(t>>>10))+o(56320+(1023&t));case 3:return o((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return o((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},m=function(e){return e.replace(v,p)},g=function(e){var t=e.length,n=t%4,r=(0<t?i[e.charAt(0)]<<18:0)|(1<t?i[e.charAt(1)]<<12:0)|(2<t?i[e.charAt(2)]<<6:0)|(3<t?i[e.charAt(3)]:0),a=[o(r>>>16),o(r>>>8&255),o(255&r)];return a.length-=[0,0,2,1][n],a.join("")},y=t.atob?function(e){return t.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,g)},_=n?n.from&&n.from!==Uint8Array.from?function(e){return(e.constructor===n.constructor?e:n.from(e,"base64")).toString()}:function(e){return(e.constructor===n.constructor?e:new n(e,"base64")).toString()}:function(e){return m(y(e))},w=function(e){return _(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},S=function(){var e=t.Base64;return t.Base64=r,e};if(t.Base64={VERSION:e,atob:y,btoa:d,fromBase64:w,toBase64:f,utob:c,encode:f,encodeURI:b,btou:m,decode:w,noConflict:S},"function"==typeof Object.defineProperty){var k=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",k(function(){return w(this)})),Object.defineProperty(String.prototype,"toBase64",k(function(e){return f(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",k(function(){return f(this,!0)}))}}return t.Meteor&&(Base64=t.Base64),T.exports?T.exports.Base64=t.Base64:void 0===(C=function(){return t.Base64}.apply(E,[]))||(T.exports=C),{Base64:t.Base64}},T.exports=n(t)}).call(this,I("vb78"))},vb115:function(e,t,n){"use strict";n.r(t),n.d(t,"NEW_VIEW_RECORD_COUNT_IN_DOC",function(){return p}),n.d(t,"NEW_VIEW_FIELD_MAP_IN_DOC",function(){return m}),n.d(t,"addIndexToTableViewMap",function(){return g}),n.d(t,"generateAddTableCs",function(){return y}),n.d(t,"DefaultActions",function(){return d});var r=n("vb234"),a=n.n(r),i=n("vb235"),o=n.n(i),s=n("vb60"),l=n.n(s),M=n("vb114"),v=n("vb325"),B=n("vb184");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){l()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var p=3,m=[M.FieldType.Text,M.FieldType.Text,M.FieldType.SingleSelect];function g(e){var n=e.viewMap,t=e.views,r={};return t&&t.forEach(function(e,t){r[e]=u({},n[e],{owner:"",index:t})}),u({},e,{viewMap:t?r:n})}function b(r,t){var e=Object.keys(t).filter(function(e){return t[e].type===M.FieldType.Attachment}),n={};if(e.length<=0)return n;var a={};return e.forEach(function(n){Object.keys(r).forEach(function(e){var t=r[e];t[n]&&t[n].value&&(a[n]=a[n]||{},a[n][e]=t[n].value)})}),n[M.ResourceType.Attachments]={data:a},n}function y(e){for(var t=e.tableId,n=e.viewMap,r=e.recordMap,a=e.fieldMap,i=e.memberId,o=e.commentMap,s=void 0===o?{}:o,l=e.resourceMap,c=void 0===l?{}:l,u=e.userMap,d=void 0===u?{}:u,h=e.recordMeta,f=void 0===h?{}:h,b=e.milestoneMap,v=void 0===b?{}:b,p=e.reminderMap,m=void 0===p?{}:p,g=e.renewRecord,y=void 0===g||g,_=e.contentCreation,w=void 0!==_&&_,S=0,k=Object.keys(m);S<k.length;S++){var C=m[k[S]];if(C)for(var T=0,E=Object.keys(C);T<E.length;T++){var I=E[T];C[I]||delete C[I]}}var O={action:M.BaseActionNames.AddTable,type:M.ActionTypes.Base,tableId:t,isRecover:!1,contentCreation:w,renewRecord:y,data:{index:0,name:t,snapshot:{recordMap:r,fieldMap:a,reminderMap:m,viewMap:n,recordMeta:y?{}:f,userMap:d,commentMap:s,resourceMap:c,milestoneMap:v}}};return n&&0!==Object.keys(n).length||M.BitableDep.collectBitableEvent("client_bitable_view_map_state_dev",{table_id:t,stack:(new Error).stack}),{localRev:0,operations:[{actions:[O],command:M.CollaCommands.AddTable,type:M.ActionTypes.Base}],member_id:i,signature:"".concat(i,"-").concat(Object(B.v4)()),type:"USER_CHANGES"}}var d=function(){function i(){a()(this,i)}return o()(i,null,[{key:"addTableUsingTableInstance",value:function(e,t){var n=e.id,r=!0,a=g(e.toJSON()),i=a.viewMap,o=a.recordMap,s=a.recordMeta,l=a.fieldMap,c=a.userMap,u=a.resourceMap,d=a.commentMap,h=a.reminderMap,f=a.milestoneMap,b=y({tableId:n,viewMap:i,recordMap:o,fieldMap:l,userMap:c,memberId:t,contentCreation:r,recordMeta:s,commentMap:d,resourceMap:u,reminderMap:h,milestoneMap:void 0===f?{}:f});return this.stashedActions[n]=b}},{key:"addTableUsingBlockData",value:function(e){var t=e.operations[0].actions[0].tableId;return this.stashedActions[t]=JSON.parse(JSON.stringify(e)),e}},{key:"addTable",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:v.a.Default,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:M.ViewType.Grid,a=3<arguments.length?arguments[3]:void 0,i=Object(M.getNewId)(M.IDPrefix.table,[]);if(r===M.ViewType.Kanban)t=M.TableUtil.createDefaultKanbanByTableId(i,i).toJSON();else if(r===M.ViewType.Gantt)t=M.TableUtil.createDefaultGanttByTableId(i,i,a).toJSON();else if(r===M.ViewType.Gallery)t=M.TableUtil.createDefaultGalleryByTableId(i,i).toJSON();else if(r===M.ViewType.Form)t=M.TableUtil.createDefaultFormByTableId(i,i).toJSON();else{var o=n===v.a.EmbeddedInDoc,s=o?m:M.NEW_VIEW_FIELDS,l=o?p:M.NEW_VIEW_RECORD_COUNT;t=M.TableUtil.createDefaultByTableId(i,i,s,l).toJSON()}var c=g(t),u=c.viewMap,d=c.recordMap,h=c.recordMeta,f=y({tableId:i,viewMap:u,recordMap:d,fieldMap:c.fieldMap,userMap:c.userMap,memberId:e,recordMeta:h});this.stashedActions[i]=f;var b=i+"_"+M.TeaEvent.BlockLoaded+"_"+M.BitableBlockLoadedStage.Done;return M.TrackerInstance.start(M.TeaEvent.BlockLoaded,{},{eventKey:b}),b=i+"_"+M.TeaEvent.BlockLoaded+"_"+M.BitableBlockLoadedStage.GetToken,M.TrackerInstance.start(M.TeaEvent.BlockLoaded,{},{eventKey:b}),f}},{key:"addTableFromSnapshot",value:function(e,t){2<arguments.length&&void 0!==arguments[2]?arguments[2]:v.a.Default;var n=Object(M.getNewId)(M.IDPrefix.table,[]),r=t.id?JSON.parse(JSON.stringify(t)):t;r.id=n;var a=r.viewMap,i=r.recordMap,o=r.recordMeta,s=r.fieldMap,l=r.userMap,c=r.resourceMap,u=r.milestoneMap,d=void 0===u?{}:u,h=y({tableId:n,viewMap:a,recordMap:i,fieldMap:s,userMap:l,memberId:e,recordMeta:o,resourceMap:c||b(i,s),milestoneMap:d});this.stashedActions[n]=h;var f=n+"_"+M.TeaEvent.BlockLoaded+"_"+M.BitableBlockLoadedStage.Done;return M.TrackerInstance.start(M.TeaEvent.BlockLoaded,{},{eventKey:f}),f=n+"_"+M.TeaEvent.BlockLoaded+"_"+M.BitableBlockLoadedStage.GetToken,M.TrackerInstance.start(M.TeaEvent.BlockLoaded,{},{eventKey:f}),h}},{key:"addTables",value:function(n,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:v.a.Default,a={},t=e.map(function(e){var t=i.addTableFromSnapshot(n,e,r);return a[e.id]=t.operations[0].actions[0].tableId,t});return i.replaceLinkField(t,a),t}},{key:"replaceLinkField",value:function(e,a){e.forEach(function(e){var t=e.operations[0].actions[0].data.snapshot.fieldMap;for(var n in t){var r=t[n];r.type!==M.FieldType.SingleLink&&r.type!==M.FieldType.DuplexLink||(r.property.tableId=a[r.property.tableId])}})}},{key:"delTable",value:function(e,t){return{operations:{actions:[{action:M.BaseActionNames.DeleteTable,type:M.ActionTypes.Base,tableId:e,data:{index:t}}],command:M.CollaCommands.DeleteTable,type:M.ActionTypes.Base},type:"USER_CHANGES"}}},{key:"clearStashedActions",value:function(){var t=this;Object.keys(this.stashedActions).forEach(function(e){return delete t.stashedActions[e]})}},{key:"jsonToCS",value:function(e){var t=M.Serializer.json.parse(e),n=h(t),r=n.fieldMap,a=n.fieldIds,i=f(t);return{recordMap:i,fieldMap:r,viewMap:_(i,a),userMap:t&&t.userData||{}}}},{key:"csToJSON",value:function(e,t,n,r){if(!e)return null;var a=M.Table.fromJSON(e);if(!a)return null;a.setBase(n);var i=a.getViewById(t);if(!i)return null;var o,s=new M.Range(0,0,i.getAllRecords().length,i.getColumnCount()),l=i.getAllRecords(),c=i.getAllFields();return r&&(o=a.commentMap),i.getStdValueTableFromRange([s],l,c,!1,o)}}]),i}();function h(e){var n={},r=[];return e.header.forEach(function(e,t){0!==t||M.FieldCenter.instance.isSupportPrimary(e.type)||(e.type=M.FieldType.Text,delete e.property),n[e.id]=e,r.push(e.id)}),{fieldMap:n,fieldIds:r}}function f(s){var l={};return s.body.forEach(function(e,i){var o=Object(M.getNewId)(M.IDPrefix.record,[]);l[o]={},s.header.forEach(function(e,t){var n=s.body[i][t];if(n.sourceType!==e.type){var r=[];n.data.forEach(function(e){r.push(e.text)}),r.length&&(n.data=[{type:M.FieldCenter.instance.getStringType(M.FieldType.Text),text:r.join(",")}]),l[o][e.id]={value:n.data}}else{var a=s.bodyCell[i][t];l[o][e.id]=a}})}),l}function _(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],e=Object(M.getNewId)(M.IDPrefix.view,[]),t=M.TableUtil.createDefaultByTableId(e,e,M.NEW_VIEW_FIELDS,M.NEW_VIEW_RECORD_COUNT).toJSON(),a=t.viewMap,i=t.views,o={};return i.forEach(function(e,t){o[e]=u({},a[e],{owner:"",index:t}),o[e].property.fields=r,o[e].property.records=Object.keys(n)}),o}d.stashedActions={}},vb116:function(e,t,n){"use strict";n.r(t);var r=n("vb56"),o=n.n(r),a=n("vb253"),s=n.n(a),i=n("vb64"),u=n.n(i),l=n("vb234"),c=n.n(l),d=n("vb235"),h=n.n(d),f=n("vb140"),b=n("vb114"),v=n("vb53"),p={},m={},g=50,y=8e3,_=2e3,w=8e3;function S(e){return p[e]}function k(e){p[e]=(p[e]||0)+1}function C(e,t){m[e]=t}function T(e){return!!m[e]}function E(e){return Object(b.isUserFieldType)(e)||e===b.FieldType.Text||e===b.FieldType.DateTime}var I="MentionPermissionManager",O="PERMISSION_CHANGE_KEY",M="CHECK_USER_AVATAR_KEY",B=function(){function r(e,t){var n=this;c()(this,r),this.needLoadUserIds=new Set,this.batchFetchUsersArr=[],this.batchFetchOnlyLoadAvatarUsersArr=[],this.isFetchingAvatar=!1,this.batchUpdateFaster=Object(f.a)(function(){n.renderer.updateFaster()},_,{maxWait:w,trailing:!0}),this.batchFetchUsersPemission=function(e){n.needLoadUserIds.add(e),n.fetchUserPermission()},this.fetchUserPermission=Object(f.a)(function(){n.userPermissionManager.addUsers(Array.from(n.needLoadUserIds)),n.needLoadUserIds.clear()},500),this.renderer=e,this.bitableStore=t,this.userPermissionManager=new v.UserPermissionManager({onPermissionChange:function(e){var t=n.renderer.getActiveTable();t&&Object.keys(t.records).forEach(function(e){t.updateRecordVersionMap(e)}),n.batchUpdateFaster(),v.EventEmitter.emit(O,e)},onError:function(e){console.error(e)}})}return h()(r,[{key:"getFieldWhichHasUsers",value:function(e){var t=[];for(var n in e.fields){var r=e.fields[n];E(r.type)&&t.push(r)}return t}},{key:"checkUserToken",value:function(e){return e.type===b.SegmentType.Mention&&e.mentionType===b.MentionType.User&&!Number.isNaN(Number(e.token))}},{key:"initUsers",value:function(){var i=this,o=this.renderer.getActiveTable();if(o){var e=this.getFieldWhichHasUsers(o),s=new Set,r=new Set,l=function(e,t){var n=o.getUserItemById(e);i.bitableStore.addUserWatch(e,o.id,t),(!n||n.avatarUrl&&b.filterUserUrls.some(function(e){return n.avatarUrl.includes(e)}))&&(T(e)||r.add(e))},t=function(a){o.records[a]&&e.forEach(function(n){if(n.type===b.FieldType.Text){var e=o.getCellValue(a,n.id);Array.isArray(e)&&e.forEach(function(e){i.checkUserToken(e)&&(s.add(e.token),l(e.token,n.id))})}else if(n.type===b.FieldType.User){var t=o.getCellValue(a,n.id);t&&Array.isArray(t.users)&&t.users.forEach(function(e){s.add(e.userId),l(e.userId,n.id)})}else if(n.type===b.FieldType.CreatedUser||n.type===b.FieldType.ModifiedUser){n.getUserIds(o,a,n.id).forEach(function(e){s.add(e),l(e,n.id)})}else if(n.type===b.FieldType.DateTime){var r=o.getReminder(a,n.id);r&&r.notifyEntities.users&&r.notifyEntities.users.forEach(function(e){var t=e.userId;s.add(t),l(t,n.id)})}})};for(var n in o.records)t(n);this.fetchUsers(o,Array.from(r)),this.addUsers(Array.from(s))}}},{key:"fetchUsers",value:function(l,e){var c=this,t=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(e.length){var a=[],i=function(o){var s=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return c.userPermissionManager.fetchUsers(o).then(function(e){var t=e.payload||{},n=t.entities,a=void 0===n?{}:n,r=t.result_list,i=[];return((void 0===r?[]:r)||[]).forEach(function(e){var t=a[e],n=l.getUserItemById(e),r={userId:e,name:t.cn_name,enName:t.en_name,avatarUrl:t.avatar_url};if(!s&&t.avatar_url)return l.setUserItem(r,!0,s),void c.bitableStore.triggerTableRerenderWhenUserLoad(e);t.avatar_url&&n&&n.avatarUrl!==t.avatar_url&&i.push(e),l.setUserItem(r,!0,s)}),c.addUsers(o),i}).finally(function(){o.forEach(function(e){C(e,!1)})})};e.forEach(function(e){C(e,!0),t?c.batchFetchOnlyLoadAvatarUsersArr.push(e):c.batchFetchUsersArr.push(e)}),Promise.resolve().then(function(){for(;c.batchFetchUsersArr.length;){var e=c.batchFetchUsersArr.splice(0,g);i(e)}}),this.isFetchingAvatar||(this.isFetchingAvatar=!0,setTimeout(u()(o.a.mark(function e(){var t,n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=s()(c.batchFetchOnlyLoadAvatarUsersArr),c.batchFetchOnlyLoadAvatarUsersArr=[],t=[];case 3:if(!a.length){e.next=18;break}return n=a.splice(0,g),e.prev=5,e.next=8,i(n,!0);case 8:(r=e.sent)&&r.length&&t.push.apply(t,s()(r)),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(5),c.isFetchingAvatar=!1,Error(e.t0);case 16:e.next=3;break;case 18:c.isFetchingAvatar=!1,t.forEach(function(e){c.bitableStore.triggerTableRerenderWhenUserLoad(e)});case 20:case"end":return e.stop()}},e,null,[[5,12]])})),y))}}},{key:"addUsers",value:function(e){this.userPermissionManager.addUsers(e),this.bindCellRenderMiddleWare()}},{key:"addUserByAction",value:function(e){var t=this;if(e.action===b.DataActionNames.SetRecord){var n=e.data,r=new Set;for(var a in n){var i=n[a],o=i.type,s=i.value;if(s)if(o===b.FieldType.Text&&Array.isArray(s))s.forEach(function(e){t.checkUserToken(e)&&r.add(e.token)});else if(o===b.FieldType.User&&Array.isArray(s.users))s.users.forEach(function(e){r.add(e.userId)});else if(o===b.FieldType.DateTime){var l=i.reminders&&i.reminders.reminder;l&&l.notifyEntities.users&&l.notifyEntities.users.forEach(function(e){r.add(e.userId)})}}this.userPermissionManager.addUsers(Array.from(r))}}},{key:"setUserItemWithPermission",value:function(e,t,n,r,a){var i=!(5<arguments.length&&void 0!==arguments[5])||arguments[5];e.getUserItemById(t)||(a?e.setUserItem(a):T(t)||S(t)&&!(S(t)<3)||(i&&e.markDirtyForField(n,r),this.fetchUsers(e,[t]),this.addUsers([t]),k(t)));var o=this.userPermissionManager.getPermissionByUser(t);o?e.setUserPermission(t,o):this.batchFetchUsersPemission(t)}},{key:"checkUserPermission",value:function(e,n,r,t,a){var i=this,o=n.fields[r];if(!o)return e;var s=o.type,l=e,c=Object(b.getProxyFieldAndValue)(o,e);return c.proxy&&(o=c.field,l=c.value,s=o.type),s===b.FieldType.Text&&Array.isArray(l)?l.forEach(function(e){var t;e.type===b.SegmentType.Mention&&e.mentionType===b.MentionType.User&&(e.name&&e.en_name&&(t={userId:e.token,name:e.name,enName:e.en_name,avatarUrl:e.link}),i.setUserItemWithPermission(n,e.token,r,a,t))}):Object(b.isUserFieldType)(s)&&l&&Array.isArray(l.users)&&l.users.forEach(function(e){i.setUserItemWithPermission(n,e.userId,r,a)}),e}},{key:"checkUserAvatar",value:function(e,t,n,r,a){var i=this,o=t.fields[n];if(!o)return e;var s=o.type,l=e;if(Object(b.isUserFieldType)(s)&&l&&Array.isArray(l.users)){var c=l.users.map(function(e){return e.userId});c.forEach(function(e){i.bitableStore.addUserWatch(e,t.id,n)});var u=c.filter(function(e){return T(e)||t.checkUserInfo(e)?null:e});if(!u.length)return e;this.fetchUsers(t,u,!0)}return e}},{key:"bindCellRenderMiddleWare",value:function(){var e=this.renderer.activeBitableWidget;e&&(e.middleWare.setMiddleware(I,this.checkUserPermission.bind(this)),e.middleWare.setMiddleware(M,this.checkUserAvatar.bind(this)))}},{key:"reset",value:function(){this.userPermissionManager.destroy();var e=this.renderer.activeBitableWidget;e&&(e.middleWare.removeMiddleware(I),e.middleWare.removeMiddleware(M))}},{key:"addPermissionChangeListener",value:function(e){v.EventEmitter.on(O,e)}},{key:"removePermissionChangeListener",value:function(e){v.EventEmitter.off(O,e)}}]),r}(),x=function(){function e(){c()(this,e),this.userValidMap={}}return h()(e,[{key:"setUserItemValid",value:function(e){this.userValidMap[e]={isValid:!0}}},{key:"checkUserInfo",value:function(e){var t=!1;return e&&this.userValidMap[e]&&(t=this.userValidMap[e].isValid),t}},{key:"init",value:function(){this.userValidMap={}}}]),e}(),D=n("vb269"),R=n("vb314");function L(e){Object(v.injectBitableDep)(e),b.BitableGlobalConfig.setGlobalConfig({UserManagerHelper:{MentionPermissionManager:B,UserValidationManager:new x},config:{cardSyncMode:b.CardSyncMode.RealTime},collectBitableEvent:D.b,GzipWorker:new R.a})}n.d(t,"default",function(){return L})},vb121:function(e,t,n){"use strict";n.r(t);var r,a,s,i,o=n("vb234"),u=n.n(o),l=n("vb235"),d=n.n(l),c=n("vb299"),h=n.n(c),f=n("vb300"),y=n.n(f),b=n("vb287"),_=n.n(b),v=n("vb241"),p=n.n(v),m=n("vb254"),g=n.n(m),w=n("vb132"),S=n("vb56"),k=n.n(S),C=n("vb64"),T=n.n(C),E=n("vb60"),I=n.n(E),O=n("vb87"),M=n.n(O),B=n("vb800");(a=r||(r={})).INSIDE_PAGE="insidePage",a.PASTE="paste",a.USER_INSERT="userInsert",(i=s||(s={}))[i.Add=0]="Add",i[i.Paste=1]="Paste",i[i.Del=2]="Del";var x=n("vb114"),D=n("vb1047");function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach(function(e){I()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var P,F,j=!0,U=function(){function o(e,t,n,r,a,i){var l=this;u()(this,o),this.token=e,this.displayMultiple=t,this.getOrders=n,this.hostType=r,this.blockExtraFunctions=a,this.reduxStore=i,this.mountQueue=[],this.mountEventQueue=new Map,this.hosts={},this.containers={},this.isRender=!1,this.mountOptions={},this.mountingInfo=null,this.autoSwitchActiveId=!1,this.selectionState=[],this.updateSelectionStateCoreTimer=0,this.previewHistoryOptions={isHighlight:!1,users:{}},this.blockMountResolver=new Map,this.isBlockMount=new Map,this.mountNext=function(){var e=l.mountQueue.shift();if(l.mountingInfo=null,e){var t=e.id,n=e.option;if(t){var r=n.createdSource===x.BitableDep.ExternalConst.CreatedSource.USER_INSERT,a=n.createdSource===x.BitableDep.ExternalConst.CreatedSource.PASTE;if(!r&&!a){var i=t+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.Done;x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:i})}var o=t+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.InitSmartable;if(x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:o}),l.mountOptions[t]=n,l.mountingInfo=e,!l.displayMultiple&&l.isRender)return l.mountingInfo.resolve(),l.mountingInfo=null,l.active(t),void(0<l.mountQueue.length&&setTimeout(function(){l.mountingInfo=null,l.mountNext()}));if(l.contentManager){var s=l.hosts[t];s?(x.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_next",table_id:t}),l.isRender=!0,M.a.render(l.getEmbeddedComponent(t),s),setTimeout(function(){l.mountingInfo=null,l.mountNext()},200)):l.collectMountError("contentManager host undefined",t)}else l.collectMountError("contentManager undefined",t)}}},this.updateBlockMountStatus=function(e){var t=l.blockMountResolver.get(e);t&&t.forEach(function(e){e&&e()})},this.onComponentContentLoaded=function(e,t){e&&e.resolve();var n=t.base.getTableById(e.id),r={};n&&(r={fields_num:Object.keys(n.fields).length,records_num:Object.keys(n.records).length}),r.createdSource=e.option.createdSource,x.BitableDep.injectBitableDepAsync&&x.BitableDep.injectBitableDepAsync();var a=e.id+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.DomRender;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,L({stage:x.BitableBlockLoadedStage.DomRender},r),{eventKey:a}),a=e.id+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.Done,x.TrackerInstance.send(x.TeaEvent.BlockLoaded,L({stage:x.BitableBlockLoadedStage.Done},r),{eventKey:a}),x.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_render_done",table_id:e.id})},this.onClientVarLoaded=function(){var t=T()(k.a.mark(function e(t){var n,r,a,i;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.contentManager.getTableById(t)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.waitTableLoaded();case 5:if(!(r=l.contentPersenters.get(t))){e.next=9;break}return e.next=9,r.handleBitableIfPaste();case 9:a=l.commentManager.getNotifyCommentLoadedFn(t),i=l.commentManager.getComments(t),a&&a(i),l.uiManager.updateErrorCodeType(t);case 13:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.onClientVarError=function(e,t){var n=l.mountEventQueue.get(e);n&&n(),l.mountOptions[e]&&(l.mountOptions[e].errorCodeType=Object(x.getErrorCodeType)(t)),l.uiManager.updateErrorCodeType(e,Object(x.getErrorCodeType)(t))},this.onTableChangedInUndo=function(e){if(l.mountOptions[e]){var t=l.mountOptions[e].operator.activeTab;t&&t(e)}},this.onDataChanged=function(e){if(l.mountOptions[e]){var t=l.mountOptions[e].operator.onChanged;t&&t(e)}},this.internalSizeChanged=function(e,t,n,r,a,i){if(l.mountOptions[e]){var o=l.mountOptions[e].operator.internalSizeChange;o&&o(n,t,r,a,i)}},this.editbarPinChanged=function(e,t){if(l.mountOptions[e]){var n=l.mountOptions[e].operator.editbarPinChange;n&&n(t)}},this.updateSelectionState=function(n,e,r){var t=function(){1===l.selectionState.length?l.selectionState.forEach(function(e){var t=l.contentPersenters.get(n);t&&(t.getSelection()?l.uiManager.updateSelectionState(e,!1,r):l.uiManager.updateSelectionState(e,!0,r))}):l.selectionState.forEach(function(e){l.uiManager.updateSelectionState(e,!0,r)})};window.clearTimeout(l.updateSelectionStateCoreTimer),e?(l.selectionState.push(n),l.updateSelectionStateCoreTimer=window.setTimeout(t,10)):(l.selectionState=l.selectionState.filter(function(e){return e!==n}),l.uiManager.updateSelectionState(n,!1))},this.findNextActiveId=function(t){if(!l.contentManager)return"";var e=l.contentManager.dataSource.getActivedId();if(e!==t)return e;var n=l.mountedIds.findIndex(function(e){return e===t}),r=0<n?n-1:1;return l.mountedIds[r]},this.activeNext=function(e){if(l.contentManager&&l.contentManager.dataSource&&0<l.mountedIds.length){var t=l.contentManager.dataSource;(t.getIndexFromId(e)||0)!==t.getIndexFromId(t.getActivedId())&&t.active(t.getIndexFromId(e)||0)}},this.addContentPresenter=function(){var e=l.getAction(s.Add,null);l.contentManager&&l.contentManager.executeLocalActions(e)},this.pasteContentPresenter=function(e){var t=l.getAction(s.Paste,e);l.contentManager&&l.contentManager.executeLocalActions(t)},this.delContentPresenter=function(e){var t=l.getAction(s.Paste,e);l.contentManager&&l.contentManager.executeLocalActions(t)},this.contentPersenters=new Map,this.contentManager=this.createContentManager(),this.uiManager=new B.b(this.contentPersenters),this.commentManager=new D.a(this.contentPersenters,this.contentManager,t),this.mountedIds=[],n&&n().forEach(function(e){l.mountedIds.push("object"===g()(e)?e.tableId:e)})}return d()(o,[{key:"mountContentPresenter",value:function(e){var t=e.id,n=e.host;try{if(j){var r=window.scmbitable.tracker;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.CommonjsLoad,cost_time:r.common_cost_time},{eventKey:x.BitableBlockLoadedStage.CommonjsLoad}),x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.SmartablejsLoad,cost_time:r.initBitable_const_time},{eventKey:x.BitableBlockLoadedStage.SmartablejsLoad}),x.BitableDep.collectBitableEvent("bitable_scm",{bitableVersion:window.scmbitable.scmInfo.version,bitableSdkVersion:window.scmbitable.pkgInfo.sdk_version,bearwebVersion:window.scm.version,masterVersion:window.scmbitable.tracker.masterVersion.garrMaster,stage:window.scmbitable.stage})}j=!1}catch(e){console.log(e)}var a=e.createdSource===x.BitableDep.ExternalConst.CreatedSource.USER_INSERT,i=e.createdSource===x.BitableDep.ExternalConst.CreatedSource.PASTE;if(a||i){var o=t+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.GetToken;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.GetToken},{eventKey:o})}if(!n){var s="Container Cannot Be Null";throw this.collectMountError(s,t),new Error(s)}if(0<this.mountQueue.filter(function(e){return e.id===t}).length){var l="MountQueue Repeat";throw this.collectMountError(l,t),new Error(l)}return this.contentManager.initUndoManager(e.undoDispatcher),this.currentActiveId=e.id,this.mountOptions[t]=e,this.addHost(t,n),x.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_add",table_id:t}),this.mountPromise(t,e)}},{key:"addHost",value:function(e,t){if(this.containers[e]=this.containers[e]||t,this.displayMultiple||!(0<Object.keys(this.hosts).length)){var n=this.hosts[e]||document.createElement("div");this.displayMultiple||(n.className="bitable-in-sheet__component-wrapper"),t.innerHTML="",t.appendChild(n),this.hosts[e]=n}}},{key:"mountPromise",value:function(n,r){var a=this;return new Promise(function(e,t){a.mountQueue.push({id:n,option:r,resolve:e,reject:t}),a.mountEventQueue.set(n,e),a.mountingInfo||a.mountNext()})}},{key:"getEmbeddedComponent",value:function(t){var n=this;return this.createEmbeddedComponent(t,function(e){return n.onComponentDidMount(t,e,n.mountingInfo)},this.onComponentContentLoaded,this.mountingInfo)}},{key:"notify",value:function(n,r){var a=r.targetIds;this.contentPersenters.forEach(function(e,t){t!==n&&(!a||-1<a.indexOf(t))&&e.receive(r.name)})}},{key:"getIsBlockMount",value:function(e){return!!this.isBlockMount.get(e)}},{key:"waitBlockMount",value:function(n){var r=this;return new Promise(function(e){if(r.getIsBlockMount(n))e();else{var t=r.blockMountResolver.get(n)||[];t.push(e),r.blockMountResolver.set(n,t)}})}},{key:"onComponentDidMount",value:function(t,n,e){var r=this;if(!this.isDestroyed){n.setNotifier(function(e){return r.notify(t,e)}),this.contentPersenters.set(t,n);var a={onClientVarLoaded:function(){var e=T()(k.a.mark(function e(){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.handleBitableIfPaste();case 2:n.onLoadedTable();case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),addNewTable:function(){},switchTable:function(){},onClientVarError:this.onClientVarError};if(e&&e.option&&e.option.historyInfo){var i=e.option.historyInfo;n.previewHistory(i,L({activeTableId:t},this.previewHistoryOptions))}else{var o=this.mountOptions[t],s=o.isHistoryMode,l=o.isTranslateMode;this.contentManager.initContents([t],t,a,s||l,2),this.contentManager.translateMode&&this.contentManager.dataSource.freeze()}this.updateBlockMountStatus(t),this.isBlockMount.set(t,!0)}}},{key:"activeBitable",value:function(e){this.setActiveBitableId(e),this.active(e)}},{key:"setActiveBitableId",value:function(e){this.currentActiveId=e}},{key:"enterHistoryMode",value:function(e,t,n){}},{key:"active",value:function(e){if(this.currentActiveId===e){var t=this.contentPersenters.values().next().value;if(!this.displayMultiple&&t){var n=Object.values(this.hosts)[0],r={switchTable:function(){t.switchTable(e)},onClientVarLoaded:function(){t.loadedTable(e)},addNewTable:function(){t.addNewTable(e)},onClientVarError:this.onClientVarError};n.parentElement&&n.parentElement.removeChild(n),this.containers[e].appendChild(n);var a=this.mountOptions[e],i=a.isHistoryMode,o=a.isTranslateMode;this.contentManager.initContents([e],e,r,i||o)}}}},{key:"unmountContentPresenter",value:function(t){var n=this,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=this.hosts[t];if(this.contentManager&&(r||!this.displayMultiple)){var a=this.contentPersenters.get(t);if(delete this.uiManager.getContainerSize()[t],a&&(a.cancelPaste(),a.destroy()),delete this.containers[t],this.selectionState=this.selectionState.filter(function(e){return e!==t}),e){var i=this.commentManager.getSmartableCommentManager(t);i&&i.showNewCommentFailTip(t)}if(this.displayMultiple){this.contentPersenters.delete(t),delete this.hosts[t],delete this.mountOptions[t];var o=this.autoSwitchActiveId?this.findNextActiveId(t):null;this.mountQueue=this.mountQueue.filter(function(e){return e.id!==t});try{M.a.unmountComponentAtNode(r),this.autoSwitchActiveId&&(o&&0<o.length&&this.activeNext(o),this.mountedIds=[],this.getOrders&&this.getOrders().forEach(function(e){n.mountedIds.push("object"===g()(e)?e.tableId:e)}),this.contentManager&&this.contentManager.reorder())}catch(e){}}else if(0===Object.keys(this.containers).length){var s=Object.values(this.hosts)[0];s&&M.a.unmountComponentAtNode(s),this.contentPersenters.clear(),this.hosts={},this.mountOptions={},this.isRender=!1}}}},{key:"fetchClientVars",value:function(e,t){this.contentManager.initContents(e,t,{onClientVarLoaded:this.onClientVarLoaded,onClientVarError:this.onClientVarError})}},{key:"freeze",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.freeze()}},{key:"unfreeze",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.unfreeze()}},{key:"suspend",value:function(e){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.suspend(e)}},{key:"resume",value:function(e){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.resume(e)}},{key:"enableEdit",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.enableEdit()}},{key:"disableEdit",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.disableEdit()}},{key:"previewHistory",value:function(t,e){var n=this;e&&e.users&&(this.previewHistoryOptions.isHighlight=Boolean(e.isHighlight),Object.assign(this.previewHistoryOptions.users,e.users)),this.contentPersenters.forEach(function(e){e.previewHistory(t,n.previewHistoryOptions)});var r=t.revInfo,a=[];for(var i in r){var o=r[i];o.firstRev!==o.lastRev&&a.push(i)}return a}},{key:"locateHistory",value:function(e,t){var n=this.contentPersenters.get(e);n&&"locate"in n&&n.locate(t)}},{key:"highlightHistory",value:function(t){this.contentPersenters.forEach(function(e){e.highlightHistory(t)})}},{key:"showAllHistoryLabels",value:function(e){var t=this.contentPersenters.get(e);t&&t.showAllHistoryLabels()}},{key:"clearHistoryLabel",value:function(e){var t=this.contentPersenters.get(e);t&&t.clearHistoryLabel()}},{key:"setRecoverTransactionId",value:function(t){this.contentPersenters.forEach(function(e){e.setRecoverTransactionId(t)})}},{key:"exitHistoryMode",value:function(){this.contentPersenters.forEach(function(e){e.exitHistory()})}},{key:"collectMountError",value:function(e,t){x.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_failed",table_id:t,errorMessage:e})}},{key:"destroy",value:function(){var n=this;try{this.isDestroyed=!0,this.mountQueue=[],this.mountingInfo=null,this.contentPersenters.forEach(function(e,t){return n.unmountContentPresenter(t)}),this.contentPersenters.clear(),this.contentManager&&this.contentManager.destroy(),this.hosts={},this.mountOptions={}}catch(e){throw e}}}]),o}(),N=n("vb66"),V=n.n(N),H=n("vb52"),z=n("vb148"),W=n("vb378"),Z=n("vb115"),K=n("vb1048"),X=n("vb134"),J=n.n(X),Q=function(){function s(e,t,n,r,a,i){var o=this;u()(this,s),this.undoManager=t,this.getOrders=r,this.isCreateAction=a,this.displayMultiple=i,this.actionAfterLoaded=[],this.loaded=!1,this.clientVarsReady=!1,this.translateMode=!1,this._updateTime=0,this.initContents=function(e,t,n,r,a){var i=o.displayMultiple?e:[t];o.dataSource.prefetchClientVars(i,t,n,r,a),o.dataSource.setUndoManger(o.undoManager),o.bindEvents()},this.getAllMention=function(){return o.dataSource.getAllMention()},this.getTableDataForServerCopy=function(e){return o.dataSource.getTableDataForServerCopy(e)},this.removeLocalConflictRecord=function(e){return o.dataSource.removeLocalConflictRecord(e)},this.isLoaded=function(){return o.loaded||(o.loaded=o.dataSource.isAllLoaded()),o.loaded},this.isClientVarsReady=function(){return o.clientVarsReady},this.bindEvents=function(){},this.unbindEvents=function(){},this.applyBitableTemplate=function(){var t=T()(k.a.mark(function e(t){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.templateManager.useTemplate(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.dataSource=n(e),this.templateManager=new K.a(this.dataSource)}return d()(s,[{key:"initUndoManager",value:function(e){this.undoManager.register(e)}},{key:"getUpdatedTime",value:function(){return this._updateTime}},{key:"updateTime",value:function(){this._updateTime=Date.now()}},{key:"getTranslateManager",value:function(){}},{key:"enterTranslateMode",value:function(){x.RendererManager.enterSandbox(),this.translateMode=!0}},{key:"exitTranslateMode",value:function(){x.RendererManager.quitSandboxNextTick(),this.translateMode=!1,this.dataSource.unfreeze()}},{key:"reorder",value:function(){var a=this;this.getOrders().filter(function(e){return"object"===g()(e)?a.dataSource.exists(e.tableId):a.dataSource.exists(e)}).forEach(function(e,t){var n="object"===g()(e)?e.tableId:e,r=a.dataSource.getIndexFromId(n);null!==r&&-1!==r&&-1!==t&&r!==t&&t<a.dataSource.getLength()&&a.dataSource.move(r,t)})}},{key:"onLoaded",value:function(e){this.dataSource.isAllLoaded()&&(this.reorder(),this.actionAfterLoaded.length&&(this.applyActions(this.actionAfterLoaded,!1),this.actionAfterLoaded=[]),this.actionAfterLoaded.length&&(this.applyActions(this.actionAfterLoaded,!0),this.actionAfterLoaded=[]),this.dataSource.unfreeze())}},{key:"handleCSV",value:function(e){return this.dataSource.handleCSV(e)}},{key:"handleCopy",value:function(e){return this.dataSource.copy(e)||""}},{key:"handlePaste",value:function(e,t,n,r,a){return fe.paste(e,t,this.displayMultiple,n,r,a)}},{key:"handlePasteBlock",value:function(){var a=T()(k.a.mark(function e(t,n,r,a){var i,o,s,l,c,u,d,h,f,b,v,p,m,g,y,_,w,S;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(x.getNewId)(x.IDPrefix.table,[]),e.prev=1,o=JSON.parse(t),e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",null);case 9:if(s=fe.genPasteBitaleSnapshot(t,o,i)){e.next=12;break}return e.abrupt("return",null);case 12:if(l=s.snapshot,c=s.contentCreation,u=this.dataSource.getSource(),d=u.base.token,h=o.baseId,J()(d)===h){e.next=24;break}return e.prev=17,e.next=20,Object(x.deepCopyBitableDriveTokenFromSnapshot)(l,d);case 20:e.next=24;break;case 22:e.prev=22,e.t1=e.catch(17);case 24:return f=l.recordMeta||{},b=r?l.commentMap:{},v=l.viewMap,p=l.recordMap,m=l.fieldMap,g=l.userMap,y=l.resourceMap,_=l.reminderMap,w=l.milestoneMap,S={tableId:i,viewMap:v,recordMap:p,fieldMap:m,userMap:g,reminderMap:_,resourceMap:y,memberId:n,contentCreation:c,recordMeta:f,resetRecordMeta:a,commentMap:b,milestoneMap:void 0===w?{}:w},e.abrupt("return",Object(Z.generateAddTableCs)(S));case 29:case"end":return e.stop()}},e,this,[[1,5],[17,22]])}));function e(e,t,n,r){return a.apply(this,arguments)}return e}()},{key:"getInitBitableCs",value:function(e,t,n){return Z.DefaultActions.addTable(e,t,n)}},{key:"getActiveViewIdMap",value:function(){return fe.getActiveViewIdMap()}},{key:"getDeleteConfirmModal",value:function(e,t){}},{key:"checkUIIfChanged",value:function(e,t){}},{key:"executeLocalActions",value:function(e){this.isLoaded()?this.applyActions([e],!0):this.actionAfterLoaded.push(e)}},{key:"applyActions",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e=e.filter(function(e){return!t.isCreateAction(e)||!t.dataSource.exists(e.id)}),this.dataSource.applyActions(e,n)}},{key:"destroy",value:function(){try{this.unbindEvents(),this.dataSource.destroy(),this.loaded=!1}catch(e){throw e}}},{key:"recoverTableHistory",value:function(e){}},{key:"getTableRevision",value:function(){var t=T()(k.a.mark(function e(t){var n,r;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.dataSource.getSource(),r=n.base.getTableById(t),e.abrupt("return",r?r.rev:n.remoteDataProvider.fetchRemoteVersion(!1,t));case 3:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"getTableById",value:function(e){return this.dataSource.getSource().base.getTableById(e)}}]),s}(),q=n("vb117");(F=P||(P={}))[F.execute=0]="execute",F[F.undo=1]="undo",F[F.redo=2]="redo";var Y=65535,$="BITABLE",ee=function(e){function t(){var r;return u()(this,t),(r=e.call(this,$)||this).execCmd=function(e,t){var n=h()(r).commandManager;return e&&n&&n.hasCommand(e.cmd)?n._executeActions(e.cmd,{result:x.ExecuteResult.Success,data:{},actions:e.actions},t):null},r}return p()(t,e),d()(t,[{key:"setCommandManager",value:function(e){this.commandManager=e}}]),t}(function(){function t(e){u()(this,t),this.blockId=e,this.undoStack=[],this.redoStack=[]}return d()(t,[{key:"_addCommand",value:function(e,t){e&&e.cmd&&t===P.execute&&this.do(e)}},{key:"id",get:function(){return this.blockId}},{key:"register",value:function(e){!this.undoDispatcher&&e&&e.register(this),this.undoDispatcher=e}},{key:"do",value:function(e){var t=this.undoStack.length;Y<=t&&(this.undoStack=this.undoStack.slice(t-Y));var n=q.BlockUndoDispatcher.BlockRef;this.undoStack.push(e),this.redoStack=[],this.undoDispatcher&&this.undoDispatcher.do(new n(this.blockId))}},{key:"undo",value:function(){this.undoDispatcher&&this.undoDispatcher.undo()}},{key:"redo",value:function(){this.undoDispatcher&&this.undoDispatcher.redo()}},{key:"clear",value:function(){this.undoStack=[],this.redoStack=[],this.undoDispatcher=null}},{key:"clearAll",value:function(){this.undoStack=[],this.redoStack=[],this.undoDispatcher&&this.undoDispatcher.remove(this)}},{key:"onUndo",value:function(){var e=this.undoStack.pop();e&&(this.redoStack.push(e),this.execCmd(e,P.undo))}},{key:"onRedo",value:function(){var e=this.redoStack.pop();e&&(this.undoStack.push(e),this.execCmd(e,P.redo))}},{key:"onDo",value:function(){this.redoStack=[]}},{key:"clearStack",value:function(){this.undoStack=[],this.redoStack=[]}},{key:"canRedo",value:function(){return!0}},{key:"canUndo",value:function(){return!0}}]),t}()),te=n("vb325"),ne=n("vb53"),re=n("vb677");function ae(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function ie(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ae(Object(n),!0).forEach(function(e){I()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function oe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=se(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function se(e,t){if(e){if("string"==typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?le(e,t):void 0}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ce(e){for(var t=e.recordMap,n=0,r=Object.keys(t);n<r.length;n++){t[r[n]]={}}return e.reminderMap={},e}function ue(e,t,n){t&&(Je.set(e,{stdValueTable:t,tableDataSet:null,status:Ue.TO_PASTE,source:Ve.BITABLE,pasteTableBaseId:""}),ce(n))}function de(e,t,n,r,a){t&&(Je.set(e,{status:Ue.TO_PASTE,source:Ve.BLOCK,tableDataSet:t,pasteTableBaseId:r,stdValueTable:null,pasteComment:a}),ce(n))}var he=function(){function o(e,t,n,r,a,i){var s=this;u()(this,o),this.displayMultiple=t,this.reduxStore=i,this.currentFetchingTableId=null,this.isBitableEditable=!0,this.isDestroy=!1,this.fetchClientvarsQueue=new Map,this.fetchClientvarsResolve=new Map,this.bitableEditableRule=function(){return s.isBitableEditable},this.handleBeforeUnload=function(e){if(s.bitableStore.trySyncIfNeed()){var t="o/";return e.returnValue=t}},this.isBitableReadyAtDisplaySingle=function(e,t){return!s.displayMultiple&&1===e.length&&s.getTableClientVarsLoaded(t)&&!Z.DefaultActions.stashedActions[t]},this.isCreateBitableAtDisplaySingle=function(e){return s.bitableStore.base&&s.bitableStore.base.tables&&0<s.bitableStore.base.tables.length&&Z.DefaultActions.stashedActions[e]},this.trackBeforeFetchClientVars=function(e){var t=e[0]+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.InitSmartable;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.InitSmartable},{eventKey:t}),t=e[0]+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.FetchClientVar,x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:t})},this.trackAfterFetchClientVars=function(e,t){var n=e[0]+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.FetchClientVar;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.FetchClientVar,gzipSchemaLength:t.gzipSchema.length},{eventKey:n}),n=e[0]+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.DomRender,x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:n})},this.handleClientAlreadyLoaded=function(e,t){s.bitableStore.switchTable(e,!s.displayMultiple),t&&t.onClientVarLoaded&&t.onClientVarLoaded(e)},this.fetchBitableClientVars=function(){var a=T()(k.a.mark(function e(a,t,i,o){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.forEach(function(){var t=T()(k.a.mark(function e(t){var n,r;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.getTableClientVarsLoaded(t)){e.next=3;break}return s.handleClientAlreadyLoaded(t,i),e.abrupt("return");case 3:if(!s.fetchClientvarsQueue.get(t)){e.next=10;break}return o&&s.bitableStore.setClientVarRunnerPriority&&s.bitableStore.setClientVarRunnerPriority([t],o),e.next=7,s.waitTableClientVarLoaded(t);case 7:s.handleClientAlreadyLoaded(t,i),e.next=27;break;case 10:return e.prev=10,s.trackBeforeFetchClientVars(a),i&&i.switchTable&&i.switchTable(),e.next=15,s.fetchClientVarsCore(t);case 15:n=e.sent,s.handleFetchClientsSuccess(n,a,t,i),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(10),r=Object(H.a)(e.t0,"ex.code",0),i&&i.onClientVarError&&r!==x.STATUS_CODE.DOCUMENT_KEY_INVALID&&i.onClientVarError(t,r);case 23:return e.prev=23,s.resolveTableClientVarLoaded(t),s.fetchClientvarsQueue.set(t,!1),e.finish(23);case 27:case"end":return e.stop()}},e,null,[[10,19,23,27]])}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e)}));return function(e,t,n,r){return a.apply(this,arguments)}}(),this.handleFetchClientsSuccess=function(e,t,n,r){if(!s.isDestroy){var a=!(s.currentFetchingTableId!==n&&s.bitableStore.isEmbeddedInSheet);s.trackAfterFetchClientVars(t,e),s.bitableStore.handleClientVars(e),a&&s.bitableStore.switchTable(n,!s.displayMultiple),r&&r.onClientVarLoaded&&r.onClientVarLoaded(n),ne.EventEmitter.emit(re.a.LOADED_BITABLE_BLOCK)}},this.fetchClientVarsCore=function(){var t=T()(k.a.mark(function e(t){var n,r,a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.getViewIdFromUrl()||void 0,r={openType:1,tableId:t,viewId:n},!(a=s.getPreloadDataSync(r))){e.next=5;break}return e.abrupt("return",a);case 5:return e.next=7,s.getPreloadDataAsync(r);case 7:if(a=e.sent,s.fetchClientvarsQueue.set(t,!0),e.t0=a,e.t0){e.next=14;break}return e.next=13,s.bitableStore.getClientVars(r);case 13:e.t0=e.sent;case 14:return a=e.t0,e.abrupt("return",a);case 16:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.getPreloadDataSync=function(e){var t,n=ne.preloadHttp.getData(s.bitableStore.token+"_"+e.tableId);return n&&n.data&&(t=n.data.data),t},this.getPreloadDataAsync=function(){var t=T()(k.a.mark(function e(t){var n,r,a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=ne.preloadHttp.getData(s.bitableStore.token+"_"+t.tableId))||!n.promise){e.next=12;break}return e.prev=2,e.next=5,n.promise;case 5:a=e.sent,r=a.data,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("preloadError",e.t0);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},e,null,[[2,9]])}));return function(e){return t.apply(this,arguments)}}(),this.enableEdit=function(){s.isBitableEditable=!0,s.bitableStore.getPermissionStore().emitPermissionChange()},this.disableEdit=function(){s.isBitableEditable=!1,s.bitableStore.getPermissionStore().emitPermissionChange()},this.getAllMention=function(){return s.bitableStore.getAllMention()},this.getTableDataForServerCopy=function(e){return s.bitableStore.getTableDataForServerCopy(e)},this.removeLocalConflictRecord=function(){var t=T()(k.a.mark(function e(t){var n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.bitableStore.getQueueStorage()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.clearBackup();case 5:return e.next=7,n.removeLocalRecord(t);case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.bitableStore=new x.BitableStore(e,ne.IO.getInstance(),n,{resetHook:function(){return x.DriveCoverManger.reset()},permissionSync:!1,needWatch:!0,allowNoTable:n===te.a.EmbeddedInDoc||n===te.a.EmbeddedInSheet},void 0,r,a,{onlyWatchActiveTable:!0}),this.createStorageManager(),this.bitableStore.getPermissionStore().addBasePermissionRules([this.bitableEditableRule],x.OperationType.Editable),window.addEventListener("beforeunload",this.handleBeforeUnload)}return d()(o,[{key:"createStorageManager",value:function(){this.storageManager=this.displayMultiple?new x.DocBitableStorageManager:new x.StorageManager,this.storageManager.bindEvents()}},{key:"waitTableClientVarLoaded",value:function(n){var r=this;return new Promise(function(e){if(r.getTableClientVarsLoaded(n))e();else{var t=r.fetchClientvarsResolve.get(n)||[];t.push(e),r.fetchClientvarsResolve.set(n,t)}})}},{key:"resolveTableClientVarLoaded",value:function(e){var t=this.fetchClientvarsResolve.get(e);t&&t.forEach(function(e){e&&e()})}},{key:"getSource",value:function(){return this.bitableStore}},{key:"getActivedId",value:function(){return this.bitableStore.getActiveTableId()}},{key:"active",value:function(e){var t=this.getIdFromIndex(e);t&&this.bitableStore.switchTable(t)}},{key:"getLength",value:function(){return this.bitableStore.base.tables.length}},{key:"getIndexFromId",value:function(e){return this.bitableStore.base.getTableIndex(e)}},{key:"exists",value:function(e){return this.bitableStore.base.isTableExists(e)}},{key:"getToken",value:function(){return this.bitableStore.base.token}},{key:"getTableClientVarsLoaded",value:function(e){var t=this.bitableStore.base.getTableById(e);return!!t&&t.clientvarLoaded}},{key:"getViewIdFromUrl",value:function(){return Object(x.getAllUrlParams)(location.href).view||null}},{key:"getShowingViewId",value:function(e){var t=this.storageManager.getShowingView(e),n=this.bitableStore.base.getTableById(e);if(n&&n.tableLoaded){var r=n.views;if(t){var a,i=oe(t);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(null!==n.getViewById(o))return o}}catch(e){i.e(e)}finally{i.f()}}return r[0]?r[0].id:void 0}}},{key:"prefetchClientVars",value:function(e,t,n,r,a){var i=this;if(this.currentFetchingTableId=t,this.bitableStore.setNeedWatch(!r),r||(window.bitableStore=this.bitableStore),this.isBitableReadyAtDisplaySingle(e,t))return!r&&this.bitableStore.addToWatchedTableIds(t),void(n&&n.switchTable&&n.switchTable());this.displayMultiple?e.forEach(function(e){return i.bitableStore.initTableEventManager(e)}):this.isCreateBitableAtDisplaySingle(t)&&(Z.DefaultActions.stashedActions[t].operations.forEach(function(e){e.actions.forEach(function(e){Object(x.applyBaseAction)(i.bitableStore.base,e,!0)})}),delete Z.DefaultActions.stashedActions[t],this.bitableStore.switchTable(t,!this.displayMultiple,!0),n&&n.addNewTable&&n.addNewTable(),this.bitableStore.fetchToMaxVersion(this.bitableStore.base.rev+1)),this.fetchBitableClientVars(e,t,n,a)}},{key:"isAllLoaded",value:function(){return this.bitableStore.isAllTableLoaded()}},{key:"isLoaded",value:function(e){return this.bitableStore.isTableLoaded(e)}},{key:"setUndoManger",value:function(e){this.bitableStore.getCommandManager().setUndoManager(e)}},{key:"move",value:function(e,t){var n=this.getIdFromIndex(e);n&&this.bitableStore.base.moveTable(n,t)}},{key:"getIdFromIndex",value:function(e){return this.bitableStore.base.tables.length<=e?null:this.bitableStore.base.tables[e].id}},{key:"copy",value:function(e){x.TrackerInstance.start(x.BITABLE_PERFORMANCE_STAGE);var t=this.bitableStore.base,n=t.getTableById(e);if(!n||!n.tableLoaded)return"";var r=Object(x.tableActiveViewIdSelector)(this.reduxStore.getState(),e),a=n.views.findIndex(function(e){return e.id===r}),i={copyType:te.b.Table,tableId:e,snapshot:Object(Z.addIndexToTableViewMap)(n.toJSON()),viewIndex:a,baseId:J()(t.token)},o=JSON.stringify(i);return x.TrackerInstance.send(x.BITABLE_PERFORMANCE_STAGE,{stage:x.BitablePerformanceStage.CopyParsing,fields_num:Object.keys(n.fields).length,records_num:Object.keys(n.records).length}),o}},{key:"handleCSV",value:function(e){var t=this.bitableStore.base.getTableById(e),n=Object(x.tableActiveViewIdSelector)(this.reduxStore.getState(),e),r=t.views.filter(function(e){return e.id===n}),a=V()(r,1)[0],i=a.getAllFields(),o=a.getVisibleRecords(),s=a.getStdValueTableFromRange([{row:0,col:0,rowCount:o.length,colCount:i.length}]);return Object(x.exportCSVData)(s)}},{key:"applyActions",value:function(e,t){var r=this;e.forEach(function(e){var t=r.bitableStore.getSyncTable(e.id);if(t){var n=t.engine;n.applyChangeset(n.getModel(),e)}})}},{key:"freeze",value:function(){this.bitableStore.freeze()}},{key:"unfreeze",value:function(){this.bitableStore.unfreeze()}},{key:"suspend",value:function(e){this.bitableStore.stopQueue()}},{key:"resume",value:function(e){this.bitableStore.restartQueue()}},{key:"destroy",value:function(){this.isDestroy=!0,window.removeEventListener("beforeunload",this.handleBeforeUnload),Z.DefaultActions.clearStashedActions(),this.bitableStore.getPermissionStore().removeBasePermissionRule(this.bitableEditableRule,x.OperationType.Editable),this.bitableStore.reset(),this.reduxStore.dispatch(Object(x.resetRedux)()),window.bitableStore=null}},{key:"fetchTableToMaxVersion",value:function(e,t){this.bitableStore.fetchTableToMaxVersion(e,t)}},{key:"getStorageManager",value:function(){return this.storageManager}}],[{key:"addTable",value:function(e){return Z.DefaultActions.addTable(e,te.a.EmbeddedInDoc,x.ViewType.Grid)}},{key:"addKanban",value:function(e){return Z.DefaultActions.addTable(e,te.a.EmbeddedInDoc,x.ViewType.Kanban)}},{key:"addGantt",value:function(e){return Z.DefaultActions.addTable(e,te.a.EmbeddedInDoc,x.ViewType.Gantt)}},{key:"addGallery",value:function(e){return Z.DefaultActions.addTable(e,te.a.EmbeddedInDoc,x.ViewType.Gallery)}},{key:"paste",value:function(e,t,n,r){var a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=5<arguments.length?arguments[5]:void 0;x.TrackerInstance.start(x.BitablePerformanceStage.PasteParsing);var o,s,l=Object(x.getNewId)(x.IDPrefix.table,[]);try{s=JSON.parse(e)}catch(e){return console.error(e),null}var c=!1;if(s.copyType===te.b.Table){var u=s,d=u.snapshot,h=u.viewIndex,f=u.baseId,b=[];d.views.forEach(function(e,t){var n=Object(x.getNewId)(x.IDPrefix.view,[]);d.viewMap[n]=d.viewMap[e],d.viewMap[n].id=n,delete d.viewMap[e],b.push(n)}),d.views=b;var v=d.views[h];d.viewMap[v]&&n&&de(l,Object(z.a)(d),d,f,r),o=ie({},d,{id:l,name:Object(x.getCopyTableName)([],d.name),viewMap:Object(W.a)(d.viewMap,function(e){return ie({},e,{owner:""})})}),Object(x.adjustSnapshotOnCopy)(o,d,n,i),c=0!==d.rev||!(!d.exInfo||!d.exInfo.contentCreation)}else{o=Z.DefaultActions.jsonToCS(e),ue(l,x.Serializer.json.parse(e),o)}x.TrackerInstance.send(x.BITABLE_PERFORMANCE_STAGE,{stage:x.BitablePerformanceStage.PasteParsing,copyType:s.copyType,fields_num:Object.keys(o.fieldMap).length,records_num:Object.keys(o.recordMap).length});var p=l+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.Done;x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:p}),p=l+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.GetToken,x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:p});var m=o.recordMeta,g=o,y=g.viewMap,_=g.recordMap,w=g.fieldMap,S=g.userMap,k=g.resourceMap,C=g.reminderMap,T=g.milestoneMap,E={tableId:l,viewMap:y,recordMap:_,fieldMap:w,userMap:S,memberId:t,contentCreation:c,recordMeta:m,resetRecordMeta:a,reminderMap:C,resourceMap:k,milestoneMap:void 0===T?{}:T};return Object(Z.generateAddTableCs)(E)}},{key:"genPasteBitaleSnapshot",value:function(e,t,n){var r,a=!1;if(t.copyType===te.b.Table){var i=t.snapshot;r=this.genCopyTypeSnapshot(t,n,!0),a=0!==i.rev||!(!i.exInfo||!i.exInfo.contentCreation)}else r=Z.DefaultActions.jsonToCS(e);return{snapshot:r,contentCreation:a}}},{key:"genCopyTypeSnapshot",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=e.snapshot,a=[];r.views.forEach(function(e,t){var n=Object(x.getNewId)(x.IDPrefix.view,[]);r.viewMap[n]=r.viewMap[e],r.viewMap[n].id=n,delete r.viewMap[e],a.push(n)}),r.views=a;var i=ie({},r,{id:t,name:Object(x.getCopyTableName)([],r.name),viewMap:Object(W.a)(r.viewMap,function(e){return ie({},e,{owner:""})})});return Object(x.adjustSnapshotOnCopy)(i,r,n),i}}]),o}(),fe=function(s){function c(e,t,n,r,a,i){var l;u()(this,c);var o=function(e){return new he(e,n,r,t,a,i)};return(l=s.call(this,e,new ee,o,t,function(e){return e.operations.some(function(e){return e.command===x.CollaCommands.AddTable})},n)||this).recoverTableHistory=function(n){if(!n)return Promise.reject("recoverTableHistory no snapshot");var a=l.dataSource.getSource(),i=n.id,o=a.getCommandManager(),s=a.base.getTableById(i);return new Promise(function(r,e){var t=function e(t){var n=s&&t.changesets[0].rev>=s.rev;t.token===i&&n&&(a.removeEventListeners(i,I()({},x.Events.ChangesetApplied,e)),a.fetchClientVars({tableId:i}),r())};a.addEventListeners(i,I()({},x.Events.ChangesetApplied,t)),o.execute({cmd:x.CollaCommands.RecoverTableHistory,tableId:i,data:{revision:n.rev,snapshot:n}}),setTimeout(e,5e3)})},l}return p()(c,s),d()(c,[{key:"key",get:function(){return""}}],[{key:"getActiveViewIdMap",value:function(){return Object(H.a)(ne.store.getState(),"bitable.Tables.activeViewIdMap",null)}},{key:"paste",value:function(e,t,n,r){var a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=5<arguments.length?arguments[5]:void 0;return he.paste(e,t,n,r,a,i)}},{key:"genPasteBitaleSnapshot",value:function(e,t,n){return he.genPasteBitaleSnapshot(e,t,n)}},{key:"addTable",value:function(e){return he.addTable(e)}},{key:"addKanban",value:function(e){return he.addKanban(e)}},{key:"addGantt",value:function(e){return he.addGantt(e)}},{key:"addGallery",value:function(e){return he.addGallery(e)}}]),c}(Q),be=n("vb58"),ve=n.n(be),pe=n("vb1049"),me=n("vb526"),ge=n("vb90"),ye=(n("vb679"),function(t){function r(e){var n;return u()(this,r),(n=t.call(this,e)||this).setHistory=function(){},n.loadedTable=function(e){n.renderer.loadedTable(e)},n.switchTable=function(e){n.historyModeTableId=e,n.forceUpdate()},n.addNewTable=function(e){var t=n.bitableStore.base;ne.store.dispatch(Object(x.updateTables)(t)),n.renderer.addNewTable(t,e),n.setState({delayLoading:!0},function(){requestAnimationFrame(function(){return n.state.delayLoading&&n.setState({delayLoading:!1})})})},n}return p()(r,t),d()(r,[{key:"componentDidMount",value:function(){y()(_()(r.prototype),"componentDidMount",this).call(this)}},{key:"componentDidUpdate",value:function(e){y()(_()(r.prototype),"componentDidUpdate",this).call(this,e),this.props.onLoaded&&!this._onMountFired&&(this._onMountFired=!0,this.props.onLoaded())}},{key:"previewHistory",value:function(e,t){var a=this,i=e.revInfo,n=e.changesets,r=t?t.activeTableId:void 0;this.revInfo=i,this.localChangesets=n,r&&i[r]||Object.keys(i).forEach(function(e){0===i[e].lastRev&&(r=e)}),r?this.historyModeTableId=r:Object.keys(i).forEach(function(e){var t=i[e],n=t.lastRev,r=t.firstRev;Number.isInteger(n)&&Number.isInteger(r)&&(a.historyModeTableId=e)}),this.forceUpdate()}},{key:"exitHistory",value:function(){y()(_()(r.prototype),"exitHistory",this).call(this)}},{key:"render",value:function(){var e=this.props,t=e.bitableStore,n=e.token,r=e.activeTableId,a=this.bitableStore.base.getOrderedInfos(),i=this.state,o=i.suspend,s=i.height;return o?null:ve.a.createElement(x.EmbeddedBitableHistoryForSheet,{token:n,io:t.io,key:this.historyModeTableId||r,bitableBase:t.base.toJSON(),activeTableId:this.historyModeTableId||r,hideTab:!0,hideList:!0,hideHeader:!0,height:s,revInfo:this.revInfo,orderedInfos:a,store:this.props.store,localChangesets:this.localChangesets})}}]),r}(me.a)),_e=Object(ge.connect)(function(e){return{tableId:Object(x.activeTableIdSelector)(e),viewId:Object(x.activeViewIdSelector)(e)}})(ye),we=n("vb681"),Se=n("vb361"),ke=n("vb574"),Ce=n("vb575"),Te=n("vb341"),Ee=(n("vb455"),n("vb529"),n("vb1055")),Ie=n("vb576"),Oe=n("vb119"),Me=n("vb253"),Be=n.n(Me),xe=n("vb191"),Ae=n("vb131"),De=n.n(Ae);function Re(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Le(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Re(Object(n),!0).forEach(function(e){I()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Pe=function(t){function g(e){var d;return u()(this,g),(d=t.call(this,e)||this).highlightInfos={},d.historyPreviewOption={isHighlight:!0,users:{}},d.highlightRangeMap={},d.isShowAllHistoryLabels=!1,d.setOffsetXPromise=new Promise(function(e){return d.setOffsetXResolve=e}),d.onOffsetLeftChange=function(e){d.props.shell.onRectChange&&d.props.shell.onRectChange(e)},d.onHoverCellChange=function(l){if(d.historyPreviewOption.isHighlight&&!d.isShowAllHistoryLabels){var e=d.highlightInfos[l.tableId],t=e?e.cells:[],c=d.renderer.activeBitableWidget.getActiveWidget(),u=d.renderer.getActiveView();if(u)Be()(t).reverse().some(function(e){var t=e.recordId,n=e.fieldId,r=e.userId,a=t?u.getVisibleRecordIndexById(t):-1,i=n?u.getFieldIndexById(n):-1,o=r?d.historyPreviewOption.users[r]:void 0;if(n&&!t&&i===l.col||t&&!n&&a===l.row||a===l.row&&i===l.col){var s=Object(x.findTextRange)(d.highlightRangeMap[l.tableId],l.row,l.col);if(s&&o)return c.showHistoryLabels([{col:s.col,row:s.row,bgColor:o.labelColor,color:"static-white",text:Object(x.getUserName)(o),name:Object(x.getUserName)(o)}]),!0}return!1})||c.showHistoryLabels([])}},d.state=Le({},d.state,{isLoaded:!1}),d}return p()(g,t),d()(g,[{key:"getTable",value:function(){var e=this.props,t=e.bitableStore,n=e.tableId;return t.base.getTableById(n)}},{key:"setOffsetX",value:function(e){y()(_()(g.prototype),"setOffsetX",this).call(this,e),this.setOffsetXResolve()}},{key:"fetchTableData",value:function(){var n=T()(k.a.mark(function e(t,n){var r,a,i,o,s,l,c;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(x.getHistoryPrivider)();case 2:return r=e.sent,a=n.lastRev,i=this.props.bitableStore,o=r.getInstance(i),s=n.lastRev?n.lastRev:n.firstRev||0,e.next=9,o.fetchHistoryMeta(t,s);case 9:if(l=e.sent,n===this.activeTableRevInfo){e.next=12;break}return e.abrupt("return",null);case 12:return e.next=14,o.fetchHistoryChangesets(t,l.rev,a);case 14:if(c=e.sent,n===this.activeTableRevInfo){e.next=17;break}return e.abrupt("return",null);case 17:return e.abrupt("return",{snapshot:l,changesets:c});case 18:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"applyChangesets",value:function(t,e,n,r){var a,i=this.props.bitableStore;r&&n<=t.rev&&(a=t.toJSON());var o=[];e.forEach(function(e){Object(x.applyHistoryChangeset)(i.base,e,x.ActionTypes.Table,t.id),r&&(n===e.rev?a=t.toJSON():e.rev>n&&o.push(e))});var s=null,l=this.renderer.getShowingViewId(t.id)||"";return r&&0<o.length&&(s=Object(x.getHistoryHighlightInfo)(Object(x.combineChangesets)(o),a,l)),s}},{key:"highlight",value:function(e){var t=this.renderer.activeBitableWidget,n=t.getActiveWidget(),r=this.historyPreviewOption.users||{};if(t.events.removeListener(x.CommonEvents.CellHover,this.onHoverCellChange),n){Object(x.clearHistoryHighlight)(n);var a=this.renderer.getShowingViewId(this.props.tableId);if(!a)return;var i=this.getTable().getViewById(a);if(e&&e.cells&&e.cells.length&&(e.cells.forEach(function(e){var t=e.userId?r[e.userId]:void 0;t&&(e.textColor=t.textColor,e.labelColor=t.labelColor,e.color=t.bgColor,e.text=Object(x.getUserName)(t))}),t.events.addListener(x.CommonEvents.CellHover,this.onHoverCellChange)),e&&e.cells){var o=Object(x.updateHistoryHighlight)(n,e.cells,!1,!1);o&&i&&i.type===x.ViewType.Grid&&(this.highlightRangeMap[n.getTableId()]=o)}}}},{key:"onLoaded",value:function(){var e=this.props.onLoaded;!this._onMountFired&&e&&(this._onMountFired=!0,e())}},{key:"previewHistory",value:function(){var n=T()(k.a.mark(function e(t,n){var r,a,i,o,s,l,c,u,d,h,f,b,v,p,m=this;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y()(_()(g.prototype),"previewHistory",this).call(this,t,n),r=t.revInfo,a=(n||{}).isHighlight,i=void 0!==a&&a,o=this.props,s=o.bitableStore,l=o.tableId,c=o.updateTables,u=r[l]){e.next=7;break}return e.abrupt("return");case 7:return s.Options.module="history",this.setState({isLoaded:!1}),this.activeTableRevInfo=u,d=this.getTable(),e.next=13,this.fetchTableData(l,u);case 13:if(h=e.sent){e.next=16;break}return e.abrupt("return");case 16:return f=h.snapshot,b=h.changesets,d.records={},d.fromJSON(f),d.status=x.TableLoadStatus.TableLoaded,v=this.applyChangesets(d,b,u.firstRev||0,!0),c(s.base),e.next=24,new Promise(function(e){return m.setState({isLoaded:!0},e)});case 24:return p=this.renderer.getShowingViewId(l)||"",this.embedBitableRef&&this.embedBitableRef.applyFasterView(l,p),this.onLoaded(),this.historyPreviewOption=n,e.next=30,this.setOffsetXPromise;case 30:v&&(this.highlightInfos[d.id]=v,i&&this.highlight(v)),this.props.mountOption.onHistoryResultReady&&Object(xe.a)(u.firstRev)&&u.firstRev!==u.lastRev&&this.props.mountOption.onHistoryResultReady([this.props.tableId]),this.renderer.activeBitableWidget.events.addListener(x.CommonEvents.EmbedOffsetLeftChanged,this.onOffsetLeftChange);case 33:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"locate",value:function(e){var t=this.renderer.getShowingViewId(this.props.tableId);if(t){var n=this.getTable(),r=n.getViewById(t);if(r){var a;if(r.type===x.ViewType.Grid){var i=this.highlightRangeMap[n.id].keys().next().value;if(i){var o=i.split(","),s=V()(o,2),l=s[0],c=s[1];a={area:x.SearchHighlightArea.GridBody,row:parseInt(l,10),col:parseInt(c,10)}}else a={area:x.SearchHighlightArea.GridBody,row:1,col:0}}else{var u=this.highlightInfos[n.id],d=u?u.cells.filter(function(e){return e.recordId})[0]:void 0;a={area:x.SearchHighlightArea.KanbanCard,recordId:d?d.recordId:r.getVisibleRecords()[0]}}var h=this.getEtherpadWrapper(),f=this.renderer.activeBitableWidget.getActiveWidget();h&&this.bitableRef&&f&&Object(x.scrollInDoc)(h,this.bitableRef,f,e,a),this.showAllHistoryLabels()}}}},{key:"highlightHistory",value:function(e){var t=this.getTable(),n=this.highlightInfos[t.id];this.highlight(null),this.historyPreviewOption=e,n&&e.isHighlight&&this.highlight(this.highlightInfos[t.id])}},{key:"showAllHistoryLabels",value:function(){var e=this.getTable(),t=this.renderer.activeBitableWidget.getActiveWidget(),n=this.highlightInfos[e.id];this.isShowAllHistoryLabels=!0,t&&Object(x.showAllHistoryLabels)(t,n,this.historyPreviewOption.users)}},{key:"clearHistoryLabel",value:function(){var e=this.renderer.activeBitableWidget.getActiveWidget();this.isShowAllHistoryLabels=!1,e&&Object(x.clearHistoryLabel)(e)}},{key:"componentWillUnmount",value:function(){var e=this.renderer.activeBitableWidget;e&&e.events.removeListener("EmbedOffsetLeftChanged",this.onOffsetLeftChange),y()(_()(g.prototype),"componentWillUnmount",this).call(this),this.renderer.reset(),this.bitableStore.reset()}},{key:"render",value:function(){var t=this,e=this.props,n=e.bitableStore,r=e.table,a=e.view,i=e.views,o=e.tableId,s=e.viewId,l=e.isFullScreenMode,c=e.shell,u=e.editbarPinChanged,d=e.mountOption,h=this.state,f=h.maxWidth,b=h.maxHeight,v=h.offsetX,p=h.isSelect,m=h.docWidth,g=h.delayLoading,y=h.collapsed,_=h.zoom,w=h.isLoaded,S=d.overlayContainer;return w?ve.a.createElement("div",{className:De()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":l}),ref:function(e){return t.bitableRef=e}},!l&&S?M.a.createPortal(this.renderOverlay(),S):null,a&&ve.a.createElement(x.TableView,{bitableStore:n,renderer:this.renderer,smartableCommentManager:null,tableId:o,viewId:s,table:r,view:a,views:i,shell:c,maxWidth:f,maxHeight:b,offsetX:l?20:v,docWidth:m,isSelect:p,editbarPinChanged:u,renderEmbededToolbar:this.renderToolbar,notify:this.notify,isFullScreenMode:l,mountOption:d,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:_,ref:this.setBitableRef,delayLoading:g,collapsed:y})):null}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.bitableStore,n=e.tableId;if(!t.base.getTableById(n)){var r=new x.Table(n,"");r.setBase(t.base),t.base.tables.push(r)}return{}}}]),g}(we.b),Fe=Object(ge.connect)(function(e,t){var n=t.tableId;return{tableId:n,table:Object(x.tableSelector)(e,n),view:Object(x.tableViewSelector)(e,n,Object(x.tableActiveViewIdSelector)(e,n)),views:Object(x.tableViewsSelector)(e,n),viewId:Object(x.tableActiveViewIdSelector)(e,n),showFloatToolbar:Object(x.floatToolbarVisibilitySelector)(e,n),isEditing:Object(x.editingSelector)(e,n),fullScreenTableId:Object(x.getFullScreenTableId)(e)}},{setFullScreenTableId:x.setFullScreenTableId,setFloatToolbarTable:x.setFloatToolbarTable,updateTables:x.updateTables})(Pe),je=n("vb102");n.d(t,"BitableToPasteStatus",function(){return Ue}),n.d(t,"BitablePasteSource",function(){return Ve}),n.d(t,"bitableToPaste",function(){return Je}),n.d(t,"EmbeddedBitableManager",function(){return Qe}),n.d(t,"NEW_VIEW_RECORD_COUNT_IN_DOC",function(){return Z.NEW_VIEW_RECORD_COUNT_IN_DOC}),n.d(t,"NEW_VIEW_FIELD_MAP_IN_DOC",function(){return Z.NEW_VIEW_FIELD_MAP_IN_DOC}),n.d(t,"addIndexToTableViewMap",function(){return Z.addIndexToTableViewMap}),n.d(t,"generateAddTableCs",function(){return Z.generateAddTableCs}),n.d(t,"DefaultActions",function(){return Z.DefaultActions});var Ue,Ne,Ve,He,ze=function(e,t,n,r){var a,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":g()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(a=e[s])&&(o=(i<3?a(o):3<i?a(t,n,o):a(t,n))||o);return 3<i&&o&&Object.defineProperty(t,n,o),o},We=Object(x.getBitableModule)(),Ze=Object(x.getAloneBitableModule)(),Ke=240,Ge=0;function Xe(e){if(!e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(Ne=Ue||(Ue={})).TO_PASTE="toPaste",Ne.PASTING="pasting",Ne.PASTED="pasted",(He=Ve||(Ve={})).BLOCK="BLOCK",He.BITABLE="BITABLE";var Je=new Map,Qe=function(i){function o(e,t,n,r){var l,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:ne.store;return u()(this,o),(l=i.call(this,e,n===te.a.EmbeddedInDoc,t,n,r,a)||this).hostType=n,l.blockExtraFunctions=r,l.reduxStore=a,l.docFullScreenWrapper=null,l.fullScreenTableId=null,l.openVCFollow=function(){Object(x.enableModuleFollowState)(x.BitableFollowModule.BitableFullScreen,l.replayVCFollowState),l.sendVCStateChange(l.getVCFollowState())},l.closeVCFollow=function(){Object(x.closeModuleFollow)(x.BitableFollowModule.BitableFullScreen,l.replayVCFollowState)},l.sendVCStateChange=function(e){Object(x.sendFollowState)(x.BitableFollowModule.BitableFullScreen,e)},l.getVCFollowState=function(){return{fullscreen:l.fullScreenTableId}},l.enterDocFullScreen=function(i){l.docFullScreenWrapper&&l.exitDocFullScreen(),x.BitableDep.CommonUtil.closeDocFindReplaceBox(l.reduxStore),x.BitableDep.CommonUtil.banDocFindReplaceBox(!0);var e=ke.a.createForFullScreen(!1);e.className+=" bitable-doc-fullscreen-wrapper",l.docFullScreenWrapper=e;var t=l.contentManager.dataSource.getSource(),n=l.contentManager.dataSource.getStorageManager(),r=l.mountOptions[i];l.fullScreenTableId=i;var a,o=Object(Se.a)(),s=l.contentPersenters.get(i);s&&(a=s.getSmartableCommentManager(i)),l.sendVCStateChange(l.getVCFollowState()),l.enterDocFullScreenTimer=Object(Ce.a)(function(){M.a.render(ve.a.createElement(ge.Provider,{store:l.reduxStore},ve.a.createElement(Oe.Router,{history:o},ve.a.createElement(we.a,{history:Object(Se.a)(),isFullScreenMode:!0,token:l.token,store:l.reduxStore,bitableStore:t,storageManager:n,tableId:i,maxWidth:window.innerWidth,mountOption:r,smartableCommentManager:a,offsetX:0,shell:{onDeleteSheet:function(){},onSizeAndScrollChange:function(e,t,n,r,a){l.internalSizeChanged(i,t,e,n,r,a)},onRenderError:function(){},onScreenShotReady:function(e){},onCutWholeSheet:function(e){},onContextMenuComment:function(){},exitFullScreenMode:l.exitDocFullScreen}}))),e)})},l.exitDocFullScreen=function(){l.enterDocFullScreenTimer&&Object(Ce.b)(l.enterDocFullScreenTimer),x.BitableDep.CommonUtil.banDocFindReplaceBox(!1);var e=h()(l).docFullScreenWrapper;l.fullScreenTableId=null,l.sendVCStateChange(l.getVCFollowState()),e&&(M.a.unmountComponentAtNode(e),ke.a.remove(e),l.docFullScreenWrapper=null)},l.isManagerDestroyed=function(){return l.isDestroyed},x.BitableDep.store&&(l.oldBitableDepStore=x.BitableDep.store),x.BitableDep.store=a,l.openVCFollow(),l}return p()(o,i),d()(o,[{key:"replayVCFollowState",value:function(e){var t=e.data.fullscreen;if(e.data.pvn===x.PVN.Version1)return{status:x.ReplayStatus.Ignore,code:x.ReplayCode.NotSupport};if(this.fullScreenTableId===t)return{status:x.ReplayStatus.Success};if(t){if(!this.contentPersenters.get(t))return{status:x.ReplayStatus.Fail,code:x.ReplayCode.NotExist};this.enterDocFullScreen(t)}else this.exitDocFullScreen();return{status:x.ReplayStatus.Success}}},{key:"bitableDepRevert",value:function(){this.oldBitableDepStore&&(x.BitableDep.store=this.oldBitableDepStore,delete this.oldBitableDepStore)}},{key:"destroy",value:function(){y()(_()(o.prototype),"destroy",this).call(this),this.bitableDepRevert(),this.closeVCFollow()}},{key:"createContentManager",value:function(){var e=this;return new fe(this.token,function(){return e.getOrders()},this.displayMultiple,this.hostType,this.blockExtraFunctions,this.reduxStore)}},{key:"getAction",value:function(e,t){var n=this.contentManager.dataSource.getSource();switch(e){case s.Add:case s.Paste:return Z.DefaultActions.addTable(n.getMemberId(),te.a.EmbeddedInDoc);case s.Del:var r=t;return Z.DefaultActions.delTable(r,this.contentManager.dataSource.getIndexFromId(r));default:throw new Error("Not support action type")}}},{key:"unmountContentPresenter",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.bitableDepRevert(),e===this.fullScreenTableId&&this.exitDocFullScreen(),y()(_()(o.prototype),"unmountContentPresenter",this).call(this,e,t)}},{key:"createSheetShell",value:function(){return{onScreenShotReady:w.a}}},{key:"createDocShell",value:function(i){var o=this,t=this.mountOptions[i];return{onDeleteSheet:w.a,onFullScreenMode:this.enterDocFullScreen,onSizeAndScrollChange:function(e,t,n,r,a){o.internalSizeChanged(i,t,e,n,r,a)},onRenderError:w.a,onScreenShotReady:w.a,onCutWholeSheet:w.a,onContextMenuComment:w.a,onHeightWillUpdate:function(){t.onHeightWillUpdate&&t.onHeightWillUpdate()},onHeightDidUpdate:function(){t.onHeightDidUpdate&&t.onHeightDidUpdate()},onRectChange:function(e){t.onRectChange&&t.onRectChange(e)}}}},{key:"onDocEnterBuffer",value:function(e){var t=this.contentPersenters.get(e);t&&t.resume()}},{key:"onDocLeaveBuffer",value:function(e){var t=this.contentPersenters.get(e);t&&t.suspend()}},{key:"createHistoryEmbeddedComponent",value:function(t,n,e,r){var a=this,i=this.reduxStore.getState(),o=Object(Ie.a)(i),s=this.contentManager.dataSource.getSource(),l=this.contentManager.dataSource.getStorageManager(),c=this.uiManager.getContainerSize(),u=this.uiManager.getWidth(),d=this.uiManager.getDocWidth(),h=this.mountOptions[t];return ve.a.createElement(ge.Provider,{store:o},ve.a.createElement("div",{className:s.isEmbeddedInSheet?"bitable-in-sheet__component-wrapper":""},s.isEmbeddedInSheet&&ve.a.createElement(_e,{token:this.token,bitableStore:s,storageManager:l,store:o,tableId:t,activeTableId:t,mountOption:h,height:this.uiManager.getHeight(),onMount:function(e){return n(e)},onRecover:h.operator.onRecover,onLoaded:function(){return e(r,s)},onTableChangedInUndo:this.onTableChangedInUndo,onChanged:function(e){return a.onDataChanged(e)},shell:this.createSheetShell()}),s.isEmbeddedInDoc&&ve.a.createElement(Fe,{token:this.token,width:u,maxWidth:c[t]?c[t].width:Ke,offsetX:c[t]?c[t].offsetX:Ge,docWidth:d,initViewIdIndex:r&&r.option&&r.option.viewIndex||0,bitableStore:s,storageManager:l,tableId:t,mountOption:h,onMount:function(e){return n(e)},onLoaded:function(){return e(r,s)},onTableChangedInUndo:this.onTableChangedInUndo,internalSizeChanged:this.internalSizeChanged,editbarPinChanged:function(e){a.editbarPinChanged(t,e)},onChanged:function(e){return a.onDataChanged(e)},shell:this.createDocShell(t),store:o})))}},{key:"createEmbeddedComponent",value:function(t,n,e,r){var a=this,i=this.contentManager.dataSource.getSource(),o=this.contentManager.dataSource.getStorageManager(),s=i.base,l=s.getTrashTableById(t);if(l){s.recoverTable(t,{index:-1,name:l.name});var c=n;n=function(){c.apply(void 0,arguments),a.reduxStore.dispatch(Object(x.updateTables)(s)),a.reduxStore.dispatch(Object(x.setBitableStage)(x.BitableStage.READY))}}var u=this.uiManager.getContainerSize(),d=this.uiManager.getWidth(),h=this.uiManager.getDocWidth(),f=this.uiManager.getActionTypeMap().get(t)||0,b=this.mountOptions[t];if(b.isHistoryMode)return this.createHistoryEmbeddedComponent(t,n,e,r);var v=Object(Se.a)();return ve.a.createElement(ge.Provider,{store:this.reduxStore},ve.a.createElement(Oe.Router,{history:v},ve.a.createElement("div",{className:i.isEmbeddedInSheet?"bitable-in-sheet__component-wrapper":""},i.isEmbeddedInSheet?ve.a.createElement(Te.DynamicModuleLoader,{modules:[Ze]},ve.a.createElement(pe.a,{history:v,token:this.token,bitableStore:i,storageManager:o,tableId:t,activeTableId:t,mountOption:b,height:this.uiManager.getHeight(),onMount:function(e){return n(e)},onRecover:b.operator.onRecover,onLoaded:function(){return e(r,i)},onTableChangedInUndo:this.onTableChangedInUndo,onChanged:function(e){return a.onDataChanged(e)},shell:this.createSheetShell(),store:this.reduxStore})):null,i.isEmbeddedInDoc?ve.a.createElement(Te.DynamicModuleLoader,{modules:[We]},ve.a.createElement(we.a,{isManagerDestroyed:this.isManagerDestroyed,history:Object(Se.a)(),token:this.token,width:d,commentActionType:f,maxWidth:u[t]?u[t].width:Ke,offsetX:u[t]?u[t].offsetX:Ge,docWidth:h,initViewIdIndex:r&&r.option&&r.option.viewIndex||0,bitableStore:i,storageManager:o,tableId:t,mountOption:b,onMount:function(e){return n(e)},onLoaded:function(){return e(r,i)},onTableChangedInUndo:this.onTableChangedInUndo,internalSizeChanged:this.internalSizeChanged,editbarPinChanged:function(e){a.editbarPinChanged(t,e)},onChanged:function(e){return a.onDataChanged(e)},shell:this.createDocShell(t),store:this.reduxStore,zoom:this.uiManager.getZoom()})):null)))}}],[{key:"pasteBitableWithoutBridge",value:function(e,t,n,r){return fe.paste(e,t,n,r)}},{key:"getInitCSWithoutBridge",value:function(e){return fe.addTable(e)}},{key:"getInitKanbanCSWithoutBridge",value:function(e){return fe.addKanban(e)}},{key:"getInitGanttCSWithoutBridge",value:function(e){return fe.addGantt(e)}},{key:"getInitGalleryCSWithoutBridge",value:function(e){return fe.addGallery(e)}},{key:"getBitablePasteDataWithoutBridge",value:function(e){var t=e.dataset.byteBitable;if(!t)return"";if(Xe(t))return t;try{return t=Ee.Base64.decode(t),x.BitableDep.collectBitableEvent("bitable_doc_paste_base64_data",{scm_version:JSON.stringify(window.scm||{}),scm_bitable:JSON.stringify(window.scmbitable||{}),source:"paste_bitable_cells"}),t}catch(e){var n=e.stack||e.toString();return x.BitableDep.collectBitableEvent("bitable_doc_paste_error",{name:e.name,stack:n||"",info:e.message}),""}}}]),o}(U);ze([Object(je.Bind)(),x.VCFollowReplayDecorator],Qe.prototype,"replayVCFollowState",null)},vb153:function(e,t,n){var r=n("vb316"),a=n("vb258"),i=r.t;e.exports=function(){var e=i.apply(null,arguments);return a(e)}},vb258:function(e,t,n){var r=n("vb259").getAppNameFromConfig;e.exports=function(e){var t=r();return e.replace(/\{\{APP_DISPLAY_NAME\}\}/g,t)}},vb259:function(e,v,p){"use strict";p.r(v),function(e){p.d(v,"getAppNameFromConfig",function(){return d});var t,n,r,a,i,o=p("vb136"),s=p("vb52"),l=null,c="undefined"==typeof window?e:window,u=(t={zh:"zh-CN",en:"en-US",ja:"ja-JP",fr:"fr-FR",hi:"hi-IN",id:"id-ID",it:"it-IT",ko:"ko-KR",pt:"pt-BR",ru:"ru-RU",th:"th-TH",vi:"vi-VN",de:"de-DE",es:"es-ES","zh-TW":"zh-TW","zh-HK":"zh-HK"},n=Object(s.a)(c,"User.language"),r=Object(s.a)(c,"navigator.language"),i=(a=n||r||"").split("-")[0],t[a]||t[i]||"en-US");function d(){if(null!==l)return l;var e="Lark";try{var t=c.globalConfig?c.globalConfig.common:c.backupDomain.ext,n="common."+Object(s.a)(t,"brand.app_name","").toLowerCase(),r=c.TTI18N[n];r&&(e=r)}catch(e){}return l=h()||f()||b()||e}function h(){var e=c.globalKaConfig;if(e){var t=Object(s.a)(e,"i18n.IDS_LARK_PRODUCT_NAME");return Object(o.a)(t)?t:""}}function f(){var e=c.globalKaConfig;if(e){var t=Object(s.a)(e,"i18n.app_name.$base","");return Object(s.a)(e,"i18n.app_name[".concat(u,"]"),t)}}function b(){if(c.materialConfig)return c.materialConfig.brand_app_name}}.call(this,p("vb78"))},vb269:function(e,t,n){"use strict";n.d(t,"a",function(){return m}),n.d(t,"b",function(){return o});var r=n("vb60"),a=n.n(r),h=n("vb52"),f=n("vb53"),b=n("vb114");function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){a()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var p=Object(f.getAllUrlParams)().localhost,m={eventMap:null},o=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if((Object(h.a)(window,"local.localhost")||p)&&console.log("collectBitableEvent",e,n),m.eventMap&&0<Object.keys(m.eventMap).length&&(t=m.eventMap[e]),Object(f.collectSuiteEvent)(e,v({is_bitable:!0},n,{},t)),r&&n.bitable_view_type){var a=n.smartable_token,i=n.row,o=n.col,s=n.table_id,l=n.bitable_view_type,c=n.bitable_field_type,u=n.view_id,d={is_bitable:!0,bitable_view_type:l};void 0!==a&&(d.smartable_token=a,d.bitable_id=a),void 0!==i&&(d.row=i),void 0!==o&&(d.col=o),void 0!==s&&(d.table_id=s),void 0!==c&&(d.bitable_field_type=c),void 0!==u&&(d.view_id=u),Object(f.collectSuiteEvent)(b.LogEvent.ClientFielBitableEdit,d)}}},vb321:function(e,t){},vb325:function(e,t,n){"use strict";var r,a,i,o;n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),(a=r||(r={})).Default="Default",a.EmbeddedInSheet="EmbeddedInSheet",a.EmbeddedInDoc="EmbeddedInDoc",(o=i||(i={})).Default="Default",o.Table="Table"},vb378:function(e,t,n){"use strict";var i=n("vb290"),o=n("vb302"),s=n("vb242");function r(e,r){var a={};return r=Object(s.a)(r,3),Object(o.a)(e,function(e,t,n){Object(i.a)(a,t,r(e,t,n))}),a}t.a=r},vb379:function(e,t,n){"use strict";n.d(t,"a",function(){return Wr});var a=n("vb254"),s=4,r=0,i=1,l=2;function o(e){for(var t=e.length;0<=--t;)e[t]=0}var c=0,u=1,d=2,h=3,f=258,b=29,v=256,p=v+1+b,m=30,g=19,y=2*p+1,_=15,w=16,S=7,k=256,C=16,T=17,E=18,I=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),O=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),M=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),x=512,D=new Array(2*(p+2));o(D);var R=new Array(2*m);o(R);var L=new Array(x);o(L);var P=new Array(f-h+1);o(P);var F=new Array(b);o(F);var j,U,N,V=new Array(m);function H(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}function z(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}o(V);var W=function(e){return e<256?L[e]:L[256+(e>>>7)]},Z=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},K=function(e,t,n){e.bi_valid>w-n?(e.bi_buf|=t<<e.bi_valid&65535,Z(e,e.bi_buf),e.bi_buf=t>>w-e.bi_valid,e.bi_valid+=n-w):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},X=function(e,t,n){K(e,n[2*t],n[2*t+1])},J=function(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1},Q=function(e){16===e.bi_valid?(Z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)},q=function(e,t){var n,r,a,i,o,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,b=t.stat_desc.max_length,v=0;for(i=0;i<=_;i++)e.bl_count[i]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<y;n++)b<(i=l[2*l[2*(r=e.heap[n])+1]+1]+1)&&(i=b,v++),l[2*r+1]=i,c<r||(e.bl_count[i]++,o=0,f<=r&&(o=h[r-f]),s=l[2*r],e.opt_len+=s*(i+o),d&&(e.static_len+=s*(u[2*r+1]+o)));if(0!==v){do{for(i=b-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[b]--,v-=2}while(0<v);for(i=b;0!==i;i--)for(r=e.bl_count[i];0!==r;)c<(a=e.heap[--n])||(l[2*a+1]!==i&&(e.opt_len+=(i-l[2*a+1])*l[2*a],l[2*a+1]=i),r--)}},Y=function(e,t,n){var r,a,i=new Array(_+1),o=0;for(r=1;r<=_;r++)i[r]=o=o+n[r-1]<<1;for(a=0;a<=t;a++){var s=e[2*a+1];0!==s&&(e[2*a]=J(i[s]++,s))}},$=function(){var e,t,n,r,a,i=new Array(_+1);for(r=n=0;r<b-1;r++)for(F[r]=n,e=0;e<1<<I[r];e++)P[n++]=r;for(P[n-1]=r,r=a=0;r<16;r++)for(V[r]=a,e=0;e<1<<O[r];e++)L[a++]=r;for(a>>=7;r<m;r++)for(V[r]=a<<7,e=0;e<1<<O[r]-7;e++)L[256+a++]=r;for(t=0;t<=_;t++)i[t]=0;for(e=0;e<=143;)D[2*e+1]=8,e++,i[8]++;for(;e<=255;)D[2*e+1]=9,e++,i[9]++;for(;e<=279;)D[2*e+1]=7,e++,i[7]++;for(;e<=287;)D[2*e+1]=8,e++,i[8]++;for(Y(D,p+1,i),e=0;e<m;e++)R[2*e+1]=5,R[2*e]=J(e,5);j=new H(D,I,v+1,p,_),U=new H(R,O,0,m,_),N=new H(new Array(0),M,0,g,S)},ee=function(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<g;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*k]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},te=function(e){8<e.bi_valid?Z(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},ne=function(e,t,n,r){te(e),r&&(Z(e,n),Z(e,~n)),e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},re=function(e,t,n,r){var a=2*t,i=2*n;return e[a]<e[i]||e[a]===e[i]&&r[t]<=r[n]},ae=function(e,t,n){for(var r=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&re(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!re(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r},ie=function(e,t,n){var r,a,i,o,s=0;if(0!==e.last_lit)for(;r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],a=e.pending_buf[e.l_buf+s],s++,0===r?X(e,a,t):(i=P[a],X(e,i+v+1,t),0!==(o=I[i])&&(a-=F[i],K(e,a,o)),i=W(--r),X(e,i,n),0!==(o=O[i])&&(r-=V[i],K(e,r,o))),s<e.last_lit;);X(e,k,t)},oe=function(e,t){var n,r,a,i=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=y,n=0;n<l;n++)0!==i[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(a=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[a]=0,e.opt_len--,s&&(e.static_len-=o[2*a+1]);for(t.max_code=c,n=e.heap_len>>1;1<=n;n--)ae(e,i,n);for(a=l;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ae(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,i[2*a]=i[2*n]+i[2*r],e.depth[a]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,i[2*n+1]=i[2*r+1]=a,e.heap[1]=a++,ae(e,i,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],q(e,t),Y(i,c,e.bl_count)},se=function(e,t,n){var r,a,i=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=o,o=t[2*(r+1)+1],++s<l&&a===o||(s<c?e.bl_tree[2*a]+=s:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[2*C]++):s<=10?e.bl_tree[2*T]++:e.bl_tree[2*E]++,i=a,(s=0)===o?(l=138,c=3):a===o?(l=6,c=3):(l=7,c=4))},le=function(e,t,n){var r,a,i=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),r=0;r<=n;r++)if(a=o,o=t[2*(r+1)+1],!(++s<l&&a===o)){if(s<c)for(;X(e,a,e.bl_tree),0!=--s;);else 0!==a?(a!==i&&(X(e,a,e.bl_tree),s--),X(e,C,e.bl_tree),K(e,s-3,2)):s<=10?(X(e,T,e.bl_tree),K(e,s-3,3)):(X(e,E,e.bl_tree),K(e,s-11,7));i=a,(s=0)===o?(l=138,c=3):a===o?(l=6,c=3):(l=7,c=4)}},ce=function(e){var t;for(se(e,e.dyn_ltree,e.l_desc.max_code),se(e,e.dyn_dtree,e.d_desc.max_code),oe(e,e.bl_desc),t=g-1;3<=t&&0===e.bl_tree[2*B[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t},ue=function(e,t,n,r){var a;for(K(e,t-257,5),K(e,n-1,5),K(e,r-4,4),a=0;a<r;a++)K(e,e.bl_tree[2*B[a]+1],3);le(e,e.dyn_ltree,t-1),le(e,e.dyn_dtree,n-1)},de=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return r;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return i;for(t=32;t<v;t++)if(0!==e.dyn_ltree[2*t])return i;return r},he=!1,fe=function(e,t,n,r){K(e,(c<<1)+(r?1:0),3),ne(e,t,n,!0)},be=function(e,t,n,r){var a,i,o=0;0<e.level?(e.strm.data_type===l&&(e.strm.data_type=de(e)),oe(e,e.l_desc),oe(e,e.d_desc),o=ce(e),a=e.opt_len+3+7>>>3,(i=e.static_len+3+7>>>3)<=a&&(a=i)):a=i=n+5,n+4<=a&&-1!==t?fe(e,t,n,r):e.strategy===s||i===a?(K(e,(u<<1)+(r?1:0),3),ie(e,D,R)):(K(e,(d<<1)+(r?1:0),3),ue(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),ie(e,e.dyn_ltree,e.dyn_dtree)),ee(e),r&&te(e)},ve={_tr_init:function(e){he||($(),he=!0),e.l_desc=new z(e.dyn_ltree,j),e.d_desc=new z(e.dyn_dtree,U),e.bl_desc=new z(e.bl_tree,N),e.bi_buf=0,e.bi_valid=0,ee(e)},_tr_stored_block:fe,_tr_flush_block:be,_tr_tally:function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(P[n]+v+1)]++,e.dyn_dtree[2*W(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){K(e,u<<1,3),X(e,k,D),Q(e)}},pe=function(e,t,n,r){for(var a=65535&e|0,i=e>>>16&65535|0,o=0;0!==n;){for(n-=o=2e3<n?2e3:n;i=i+(a=a+t[r++]|0)|0,--o;);a%=65521,i%=65521}return a|i<<16|0},me=new Uint32Array(function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),ge=function(e,t,n,r){var a=me,i=r+n;e^=-1;for(var o=r;o<i;o++)e=e>>>8^a[255&(e^t[o])];return-1^e},ye={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_e={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},we=ve._tr_init,Se=ve._tr_stored_block,ke=ve._tr_flush_block,Ce=ve._tr_tally,Te=ve._tr_align,Ee=_e.Z_NO_FLUSH,Ie=_e.Z_PARTIAL_FLUSH,Oe=_e.Z_FULL_FLUSH,Me=_e.Z_FINISH,Be=_e.Z_BLOCK,xe=_e.Z_OK,Ae=_e.Z_STREAM_END,De=_e.Z_STREAM_ERROR,Re=_e.Z_DATA_ERROR,Le=_e.Z_BUF_ERROR,Pe=_e.Z_DEFAULT_COMPRESSION,Fe=_e.Z_FILTERED,je=_e.Z_HUFFMAN_ONLY,Ue=_e.Z_RLE,Ne=_e.Z_FIXED,Ve=_e.Z_DEFAULT_STRATEGY,He=_e.Z_UNKNOWN,ze=_e.Z_DEFLATED,We=9,Ze=15,Ke=8,Ge=256+1+29,Xe=30,Je=19,Qe=2*Ge+1,qe=15,Ye=3,$e=258,et=$e+Ye+1,tt=32,nt=42,rt=69,at=73,it=91,ot=103,st=113,lt=666,ct=1,ut=2,dt=3,ht=4,ft=3,bt=function(e,t){return e.msg=ye[t],t},vt=function(e){return(e<<1)-(4<e?9:0)},pt=function(e){for(var t=e.length;0<=--t;)e[t]=0},mt=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},gt=function(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},yt=function(e,t){ke(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,gt(e.strm)},_t=function(e,t){e.pending_buf[e.pending++]=t},wt=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},St=function(e,t,n,r){var a=e.avail_in;return r<a&&(a=r),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),n),1===e.state.wrap?e.adler=pe(e.adler,t,a,n):2===e.state.wrap&&(e.adler=ge(e.adler,t,a,n)),e.next_in+=a,e.total_in+=a,a)},kt=function(e,t){var n,r,a=e.max_chain_length,i=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-et?e.strstart-(e.w_size-et):0,c=e.window,u=e.w_mask,d=e.prev,h=e.strstart+$e,f=c[i+o-1],b=c[i+o];e.prev_length>=e.good_match&&(a>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+o]===b&&c[n+o-1]===f&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<h);if(r=$e-(h-i),i=h-$e,o<r){if(e.match_start=t,s<=(o=r))break;f=c[i+o-1],b=c[i+o]}}}while((t=d[t&u])>l&&0!=--a);return o<=e.lookahead?o:e.lookahead},Ct=function(e){var t,n,r,a,i,o=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-et)){for(e.window.set(e.window.subarray(o,o+o),0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=n=e.hash_size;r=e.head[--t],e.head[t]=o<=r?r-o:0,--n;);for(t=n=o;r=e.prev[--t],e.prev[t]=o<=r?r-o:0,--n;);a+=o}if(0===e.strm.avail_in)break;if(n=St(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=n,e.lookahead+e.insert>=Ye)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=mt(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=mt(e,e.ins_h,e.window[i+Ye-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<Ye)););}while(e.lookahead<et&&0!==e.strm.avail_in)},Tt=function(e,t){for(var n,r;;){if(e.lookahead<et){if(Ct(e),e.lookahead<et&&t===Ee)return ct;if(0===e.lookahead)break}if(n=0,e.lookahead>=Ye&&(e.ins_h=mt(e,e.ins_h,e.window[e.strstart+Ye-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-et&&(e.match_length=kt(e,n)),e.match_length>=Ye)if(r=Ce(e,e.strstart-e.match_start,e.match_length-Ye),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=Ye){for(e.match_length--;e.strstart++,e.ins_h=mt(e,e.ins_h,e.window[e.strstart+Ye-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=mt(e,e.ins_h,e.window[e.strstart+1]);else r=Ce(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(yt(e,!1),0===e.strm.avail_out))return ct}return e.insert=e.strstart<Ye-1?e.strstart:Ye-1,t===Me?(yt(e,!0),0===e.strm.avail_out?dt:ht):e.last_lit&&(yt(e,!1),0===e.strm.avail_out)?ct:ut},Et=function(e,t){for(var n,r,a;;){if(e.lookahead<et){if(Ct(e),e.lookahead<et&&t===Ee)return ct;if(0===e.lookahead)break}if(n=0,e.lookahead>=Ye&&(e.ins_h=mt(e,e.ins_h,e.window[e.strstart+Ye-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=Ye-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-et&&(e.match_length=kt(e,n),e.match_length<=5&&(e.strategy===Fe||e.match_length===Ye&&4096<e.strstart-e.match_start)&&(e.match_length=Ye-1)),e.prev_length>=Ye&&e.match_length<=e.prev_length){for(a=e.strstart+e.lookahead-Ye,r=Ce(e,e.strstart-1-e.prev_match,e.prev_length-Ye),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=a&&(e.ins_h=mt(e,e.ins_h,e.window[e.strstart+Ye-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=Ye-1,e.strstart++,r&&(yt(e,!1),0===e.strm.avail_out))return ct}else if(e.match_available){if((r=Ce(e,0,e.window[e.strstart-1]))&&yt(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ct}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Ce(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<Ye-1?e.strstart:Ye-1,t===Me?(yt(e,!0),0===e.strm.avail_out?dt:ht):e.last_lit&&(yt(e,!1),0===e.strm.avail_out)?ct:ut},It=function(e,t){for(var n,r,a,i,o=e.window;;){if(e.lookahead<=$e){if(Ct(e),e.lookahead<=$e&&t===Ee)return ct;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=Ye&&0<e.strstart&&(r=o[a=e.strstart-1])===o[++a]&&r===o[++a]&&r===o[++a]){i=e.strstart+$e;do{}while(r===o[++a]&&r===o[++a]&&r===o[++a]&&r===o[++a]&&r===o[++a]&&r===o[++a]&&r===o[++a]&&r===o[++a]&&a<i);e.match_length=$e-(i-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=Ye?(n=Ce(e,1,e.match_length-Ye),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Ce(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(yt(e,!1),0===e.strm.avail_out))return ct}return e.insert=0,t===Me?(yt(e,!0),0===e.strm.avail_out?dt:ht):e.last_lit&&(yt(e,!1),0===e.strm.avail_out)?ct:ut},Ot=function(e,t){for(var n;;){if(0===e.lookahead&&(Ct(e),0===e.lookahead)){if(t===Ee)return ct;break}if(e.match_length=0,n=Ce(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(yt(e,!1),0===e.strm.avail_out))return ct}return e.insert=0,t===Me?(yt(e,!0),0===e.strm.avail_out?dt:ht):e.last_lit&&(yt(e,!1),0===e.strm.avail_out)?ct:ut};function Mt(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}var Bt=[new Mt(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ct(e),0===e.lookahead&&t===Ee)return ct;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,yt(e,!1),0===e.strm.avail_out))return ct;if(e.strstart-e.block_start>=e.w_size-et&&(yt(e,!1),0===e.strm.avail_out))return ct}return e.insert=0,t===Me?(yt(e,!0),0===e.strm.avail_out?dt:ht):(e.strstart>e.block_start&&(yt(e,!1),e.strm.avail_out),ct)}),new Mt(4,4,8,4,Tt),new Mt(4,5,16,8,Tt),new Mt(4,6,32,32,Tt),new Mt(4,4,16,16,Et),new Mt(8,16,32,32,Et),new Mt(8,16,128,128,Et),new Mt(8,32,128,256,Et),new Mt(32,128,258,1024,Et),new Mt(32,258,258,4096,Et)],xt=function(e){e.window_size=2*e.w_size,pt(e.head),e.max_lazy_match=Bt[e.level].max_lazy,e.good_match=Bt[e.level].good_length,e.nice_match=Bt[e.level].nice_length,e.max_chain_length=Bt[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=Ye-1,e.match_available=0,e.ins_h=0};function At(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ze,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Qe),this.dyn_dtree=new Uint16Array(2*(2*Xe+1)),this.bl_tree=new Uint16Array(2*(2*Je+1)),pt(this.dyn_ltree),pt(this.dyn_dtree),pt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(qe+1),this.heap=new Uint16Array(2*Ge+1),pt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ge+1),pt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Dt=function(e){if(!e||!e.state)return bt(e,De);e.total_in=e.total_out=0,e.data_type=He;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?nt:st,e.adler=2===t.wrap?0:1,t.last_flush=Ee,we(t),xe},Rt=function(e){var t=Dt(e);return t===xe&&xt(e.state),t},Lt=function(e,t,n,r,a,i){if(!e)return De;var o=1;if(t===Pe&&(t=6),r<0?(o=0,r=-r):15<r&&(o=2,r-=16),a<1||We<a||n!==ze||r<8||15<r||t<0||9<t||i<0||Ne<i)return bt(e,De);8===r&&(r=9);var s=new At;return(e.state=s).strm=e,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=a+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Ye-1)/Ye),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<a+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=i,s.method=n,Rt(e)},Pt={deflateInit:function(e,t){return Lt(e,t,ze,Ze,Ke,Ve)},deflateInit2:Lt,deflateReset:Rt,deflateResetKeep:Dt,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?De:(e.state.gzhead=t,xe):De},deflate:function(e,t){var n,r;if(!e||!e.state||Be<t||t<0)return e?bt(e,De):De;var a=e.state;if(!e.output||!e.input&&0!==e.avail_in||a.status===lt&&t!==Me)return bt(e,0===e.avail_out?Le:De);a.strm=e;var i=a.last_flush;if(a.last_flush=t,a.status===nt)if(2===a.wrap)e.adler=0,_t(a,31),_t(a,139),_t(a,8),a.gzhead?(_t(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),_t(a,255&a.gzhead.time),_t(a,a.gzhead.time>>8&255),_t(a,a.gzhead.time>>16&255),_t(a,a.gzhead.time>>24&255),_t(a,9===a.level?2:a.strategy>=je||a.level<2?4:0),_t(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(_t(a,255&a.gzhead.extra.length),_t(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=ge(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=rt):(_t(a,0),_t(a,0),_t(a,0),_t(a,0),_t(a,0),_t(a,9===a.level?2:a.strategy>=je||a.level<2?4:0),_t(a,ft),a.status=st);else{var o=ze+(a.w_bits-8<<4)<<8;o|=(a.strategy>=je||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(o|=tt),o+=31-o%31,a.status=st,wt(a,o),0!==a.strstart&&(wt(a,e.adler>>>16),wt(a,65535&e.adler)),e.adler=1}if(a.status===rt)if(a.gzhead.extra){for(n=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>n&&(e.adler=ge(e.adler,a.pending_buf,a.pending-n,n)),gt(e),n=a.pending,a.pending!==a.pending_buf_size));)_t(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>n&&(e.adler=ge(e.adler,a.pending_buf,a.pending-n,n)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=at)}else a.status=at;if(a.status===at)if(a.gzhead.name){n=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>n&&(e.adler=ge(e.adler,a.pending_buf,a.pending-n,n)),gt(e),n=a.pending,a.pending===a.pending_buf_size)){r=1;break}r=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,_t(a,r)}while(0!==r);a.gzhead.hcrc&&a.pending>n&&(e.adler=ge(e.adler,a.pending_buf,a.pending-n,n)),0===r&&(a.gzindex=0,a.status=it)}else a.status=it;if(a.status===it)if(a.gzhead.comment){n=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>n&&(e.adler=ge(e.adler,a.pending_buf,a.pending-n,n)),gt(e),n=a.pending,a.pending===a.pending_buf_size)){r=1;break}r=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,_t(a,r)}while(0!==r);a.gzhead.hcrc&&a.pending>n&&(e.adler=ge(e.adler,a.pending_buf,a.pending-n,n)),0===r&&(a.status=ot)}else a.status=ot;if(a.status===ot&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&gt(e),a.pending+2<=a.pending_buf_size&&(_t(a,255&e.adler),_t(a,e.adler>>8&255),e.adler=0,a.status=st)):a.status=st),0!==a.pending){if(gt(e),0===e.avail_out)return a.last_flush=-1,xe}else if(0===e.avail_in&&vt(t)<=vt(i)&&t!==Me)return bt(e,Le);if(a.status===lt&&0!==e.avail_in)return bt(e,Le);if(0!==e.avail_in||0!==a.lookahead||t!==Ee&&a.status!==lt){var s=a.strategy===je?Ot(a,t):a.strategy===Ue?It(a,t):Bt[a.level].func(a,t);if(s!==dt&&s!==ht||(a.status=lt),s===ct||s===dt)return 0===e.avail_out&&(a.last_flush=-1),xe;if(s===ut&&(t===Ie?Te(a):t!==Be&&(Se(a,0,0,!1),t===Oe&&(pt(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),gt(e),0===e.avail_out))return a.last_flush=-1,xe}return t!==Me?xe:a.wrap<=0?Ae:(2===a.wrap?(_t(a,255&e.adler),_t(a,e.adler>>8&255),_t(a,e.adler>>16&255),_t(a,e.adler>>24&255),_t(a,255&e.total_in),_t(a,e.total_in>>8&255),_t(a,e.total_in>>16&255),_t(a,e.total_in>>24&255)):(wt(a,e.adler>>>16),wt(a,65535&e.adler)),gt(e),0<a.wrap&&(a.wrap=-a.wrap),0!==a.pending?xe:Ae)},deflateEnd:function(e){if(!e||!e.state)return De;var t=e.state.status;return t!==nt&&t!==rt&&t!==at&&t!==it&&t!==ot&&t!==st&&t!==lt?bt(e,De):(e.state=null,t===st?bt(e,Re):xe)},deflateSetDictionary:function(e,t){var n=t.length;if(!e||!e.state)return De;var r=e.state,a=r.wrap;if(2===a||1===a&&r.status!==nt||r.lookahead)return De;if(1===a&&(e.adler=pe(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===a&&(pt(r.head),r.strstart=0,r.block_start=0,r.insert=0);var i=new Uint8Array(r.w_size);i.set(t.subarray(n-r.w_size,n),0),t=i,n=r.w_size}var o=e.avail_in,s=e.next_in,l=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Ct(r);r.lookahead>=Ye;){for(var c=r.strstart,u=r.lookahead-(Ye-1);r.ins_h=mt(r,r.ins_h,r.window[c+Ye-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++,--u;);r.strstart=c,r.lookahead=Ye-1,Ct(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Ye-1,r.match_available=0,e.next_in=s,e.input=l,e.avail_in=o,r.wrap=a,xe},deflateInfo:"pako deflate (from Nodeca project)"},Ft=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},jt={assign:function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==a(n))throw new TypeError(n+"must be non-object");for(var r in n)Ft(n,r)&&(e[r]=n[r])}}return e},flattenChunks:function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var a=new Uint8Array(t),i=0,o=0,s=e.length;i<s;i++){var l=e[i];a.set(l,o),o+=l.length}return a}},Ut=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ut=!1}for(var Nt=new Uint8Array(256),Vt=0;Vt<256;Vt++)Nt[Vt]=252<=Vt?6:248<=Vt?5:240<=Vt?4:224<=Vt?3:192<=Vt?2:1;Nt[254]=Nt[254]=1;var Ht=function(e,t){if(t<65534&&e.subarray&&Ut)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n},zt={string2buf:function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,n,r,a,i,o=e.length,s=0;for(a=0;a<o;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=i=0;i<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[i++]=n:(n<2048?t[i++]=192|n>>>6:(n<65536?t[i++]=224|n>>>12:(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63),t[i++]=128|n>>>6&63),t[i++]=128|63&n);return t},buf2string:function(e,t){var n,r,a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var i=new Array(2*a);for(n=r=0;n<a;){var o=e[n++];if(o<128)i[r++]=o;else{var s=Nt[o];if(4<s)i[r++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;1<s&&n<a;)o=o<<6|63&e[n++],s--;1<s?i[r++]=65533:o<65536?i[r++]=o:(o-=65536,i[r++]=55296|o>>10&1023,i[r++]=56320|1023&o)}}}return Ht(i,r)},utf8border:function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+Nt[e[n]]>t?n:t}};function Wt(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Zt=Wt,Kt=Object.prototype.toString,Gt=_e.Z_NO_FLUSH,Xt=_e.Z_SYNC_FLUSH,Jt=_e.Z_FULL_FLUSH,Qt=_e.Z_FINISH,qt=_e.Z_OK,Yt=_e.Z_STREAM_END,$t=_e.Z_DEFAULT_COMPRESSION,en=_e.Z_DEFAULT_STRATEGY,tn=_e.Z_DEFLATED;function nn(e){this.options=jt.assign({level:$t,method:tn,chunkSize:16384,windowBits:15,memLevel:8,strategy:en},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Zt,this.strm.avail_out=0;var n=Pt.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==qt)throw new Error(ye[n]);if(t.header&&Pt.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?zt.string2buf(t.dictionary):"[object ArrayBuffer]"===Kt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=Pt.deflateSetDictionary(this.strm,r))!==qt)throw new Error(ye[n]);this._dict_set=!0}}function rn(e,t){var n=new nn(t);if(n.push(e,!0),n.err)throw n.msg||ye[n.err];return n.result}function an(e,t){return(t=t||{}).raw=!0,rn(e,t)}function on(e,t){return(t=t||{}).gzip=!0,rn(e,t)}nn.prototype.push=function(e,t){var n,r,a=this.strm,i=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Qt:Gt,"string"==typeof e?a.input=zt.string2buf(e):"[object ArrayBuffer]"===Kt.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(r===Xt||r===Jt)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if((n=Pt.deflate(a,r))===Yt)return 0<a.next_out&&this.onData(a.output.subarray(0,a.next_out)),n=Pt.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===qt;if(0!==a.avail_out){if(0<r&&0<a.next_out)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},nn.prototype.onData=function(e){this.chunks.push(e)},nn.prototype.onEnd=function(e){e===qt&&(this.result=jt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var sn={Deflate:nn,deflate:rn,deflateRaw:an,gzip:on,constants:_e},ln=30,cn=12,un=function(e,t){var n,r,a,i,o,s,l,c,u,d,h,f,b,v,p,m,g,y,_,w,S,k,C,T,E=e.state;n=e.next_in,C=e.input,r=n+(e.avail_in-5),a=e.next_out,T=e.output,i=a-(t-e.avail_out),o=a+(e.avail_out-257),s=E.dmax,l=E.wsize,c=E.whave,u=E.wnext,d=E.window,h=E.hold,f=E.bits,b=E.lencode,v=E.distcode,p=(1<<E.lenbits)-1,m=(1<<E.distbits)-1;e:do{f<15&&(h+=C[n++]<<f,f+=8,h+=C[n++]<<f,f+=8),g=b[h&p];t:for(;;){if(h>>>=y=g>>>24,f-=y,0===(y=g>>>16&255))T[a++]=65535&g;else{if(!(16&y)){if(0==(64&y)){g=b[(65535&g)+(h&(1<<y)-1)];continue t}if(32&y){E.mode=cn;break e}e.msg="invalid literal/length code",E.mode=ln;break e}_=65535&g,(y&=15)&&(f<y&&(h+=C[n++]<<f,f+=8),_+=h&(1<<y)-1,h>>>=y,f-=y),f<15&&(h+=C[n++]<<f,f+=8,h+=C[n++]<<f,f+=8),g=v[h&m];n:for(;;){if(h>>>=y=g>>>24,f-=y,!(16&(y=g>>>16&255))){if(0==(64&y)){g=v[(65535&g)+(h&(1<<y)-1)];continue n}e.msg="invalid distance code",E.mode=ln;break e}if(w=65535&g,f<(y&=15)&&(h+=C[n++]<<f,(f+=8)<y&&(h+=C[n++]<<f,f+=8)),s<(w+=h&(1<<y)-1)){e.msg="invalid distance too far back",E.mode=ln;break e}if(h>>>=y,f-=y,(y=a-i)<w){if(c<(y=w-y)&&E.sane){e.msg="invalid distance too far back",E.mode=ln;break e}if(k=d,(S=0)===u){if(S+=l-y,y<_){for(_-=y;T[a++]=d[S++],--y;);S=a-w,k=T}}else if(u<y){if(S+=l+u-y,(y-=u)<_){for(_-=y;T[a++]=d[S++],--y;);if(S=0,u<_){for(_-=y=u;T[a++]=d[S++],--y;);S=a-w,k=T}}}else if(S+=u-y,y<_){for(_-=y;T[a++]=d[S++],--y;);S=a-w,k=T}for(;2<_;)T[a++]=k[S++],T[a++]=k[S++],T[a++]=k[S++],_-=3;_&&(T[a++]=k[S++],1<_&&(T[a++]=k[S++]))}else{for(S=a-w;T[a++]=T[S++],T[a++]=T[S++],T[a++]=T[S++],2<(_-=3););_&&(T[a++]=T[S++],1<_&&(T[a++]=T[S++]))}break}}break}}while(n<r&&a<o);n-=_=f>>3,h&=(1<<(f-=_<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=a<o?o-a+257:257-(a-o),E.hold=h,E.bits=f},dn=15,hn=852,fn=592,bn=0,vn=1,pn=2,mn=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),gn=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_n=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),wn=function(e,t,n,r,a,i,o,s){var l,c,u,d,h,f,b,v,p,m=s.bits,g=0,y=0,_=0,w=0,S=0,k=0,C=0,T=0,E=0,I=0,O=null,M=0,B=new Uint16Array(dn+1),x=new Uint16Array(dn+1),D=null,R=0;for(g=0;g<=dn;g++)B[g]=0;for(y=0;y<r;y++)B[t[n+y]]++;for(S=m,w=dn;1<=w&&0===B[w];w--);if(w<S&&(S=w),0===w)return a[i++]=20971520,a[i++]=20971520,s.bits=1,0;for(_=1;_<w&&0===B[_];_++);for(S<_&&(S=_),g=T=1;g<=dn;g++)if(T<<=1,(T-=B[g])<0)return-1;if(0<T&&(e===bn||1!==w))return-1;for(x[1]=0,g=1;g<dn;g++)x[g+1]=x[g]+B[g];for(y=0;y<r;y++)0!==t[n+y]&&(o[x[t[n+y]]++]=y);if(e===bn?(O=D=o,f=19):e===vn?(O=mn,M-=257,D=gn,R-=257,f=256):(O=yn,D=_n,f=-1),g=_,h=i,C=y=I=0,u=-1,d=(E=1<<(k=S))-1,e===vn&&hn<E||e===pn&&fn<E)return 1;for(;;){for(b=g-C,o[y]<f?(v=0,p=o[y]):o[y]>f?(v=D[R+o[y]],p=O[M+o[y]]):(v=96,p=0),l=1<<g-C,_=c=1<<k;a[h+(I>>C)+(c-=l)]=b<<24|v<<16|p|0,0!==c;);for(l=1<<g-1;I&l;)l>>=1;if(0!==l?(I&=l-1,I+=l):I=0,y++,0==--B[g]){if(g===w)break;g=t[n+o[y]]}if(S<g&&(I&d)!==u){for(0===C&&(C=S),h+=_,T=1<<(k=g-C);k+C<w&&!((T-=B[k+C])<=0);)k++,T<<=1;if(E+=1<<k,e===vn&&hn<E||e===pn&&fn<E)return 1;a[u=I&d]=S<<24|k<<16|h-i|0}}return 0!==I&&(a[h+I]=g-C<<24|64<<16|0),s.bits=S,0},Sn=0,kn=1,Cn=2,Tn=_e.Z_FINISH,En=_e.Z_BLOCK,In=_e.Z_TREES,On=_e.Z_OK,Mn=_e.Z_STREAM_END,Bn=_e.Z_NEED_DICT,xn=_e.Z_STREAM_ERROR,An=_e.Z_DATA_ERROR,Dn=_e.Z_MEM_ERROR,Rn=_e.Z_BUF_ERROR,Ln=_e.Z_DEFLATED,Pn=1,Fn=2,jn=3,Un=4,Nn=5,Vn=6,Hn=7,zn=8,Wn=9,Zn=10,Kn=11,Gn=12,Xn=13,Jn=14,Qn=15,qn=16,Yn=17,$n=18,er=19,tr=20,nr=21,rr=22,ar=23,ir=24,or=25,sr=26,lr=27,cr=28,ur=29,dr=30,hr=31,fr=32,br=852,vr=592,pr=15,mr=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function gr(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var yr,_r,wr=function(e){if(!e||!e.state)return xn;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Pn,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(br),t.distcode=t.distdyn=new Int32Array(vr),t.sane=1,t.back=-1,On},Sr=function(e){if(!e||!e.state)return xn;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,wr(e)},kr=function(e,t){var n;if(!e||!e.state)return xn;var r=e.state;return t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?xn:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Sr(e))},Cr=function(e,t){if(!e)return xn;var n=new gr;(e.state=n).window=null;var r=kr(e,t);return r!==On&&(e.state=null),r},Tr=!0,Er=function(e){if(Tr){yr=new Int32Array(512),_r=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(wn(kn,e.lens,0,288,yr,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;wn(Cn,e.lens,0,32,_r,0,e.work,{bits:5}),Tr=!1}e.lencode=yr,e.lenbits=9,e.distcode=_r,e.distbits=5},Ir=function(e,t,n,r){var a,i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(t.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(r<(a=i.wsize-i.wnext)&&(a=r),i.window.set(t.subarray(n-r,n-r+a),i.wnext),(r-=a)?(i.window.set(t.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0},Or={inflateReset:Sr,inflateReset2:kr,inflateResetKeep:wr,inflateInit:function(e){return Cr(e,pr)},inflateInit2:Cr,inflate:function(e,t){var n,r,a,i,o,s,l,c,u,d,h,f,b,v,p,m,g,y,_,w,S,k,C,T,E=0,I=new Uint8Array(4),O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return xn;(n=e.state).mode===Gn&&(n.mode=Xn),o=e.next_out,a=e.output,l=e.avail_out,i=e.next_in,r=e.input,s=e.avail_in,c=n.hold,u=n.bits,d=s,h=l,k=On;e:for(;;)switch(n.mode){case Pn:if(0===n.wrap){n.mode=Xn;break}for(;u<16;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(2&n.wrap&&35615===c){I[n.check=0]=255&c,I[1]=c>>>8&255,n.check=ge(n.check,I,2,0),u=c=0,n.mode=Fn;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=dr;break}if((15&c)!==Ln){e.msg="unknown compression method",n.mode=dr;break}if(u-=4,S=8+(15&(c>>>=4)),0===n.wbits)n.wbits=S;else if(S>n.wbits){e.msg="invalid window size",n.mode=dr;break}n.dmax=1<<n.wbits,e.adler=n.check=1,n.mode=512&c?Zn:Gn,u=c=0;break;case Fn:for(;u<16;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(n.flags=c,(255&n.flags)!==Ln){e.msg="unknown compression method",n.mode=dr;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=dr;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(I[0]=255&c,I[1]=c>>>8&255,n.check=ge(n.check,I,2,0)),u=c=0,n.mode=jn;case jn:for(;u<32;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&(I[0]=255&c,I[1]=c>>>8&255,I[2]=c>>>16&255,I[3]=c>>>24&255,n.check=ge(n.check,I,4,0)),u=c=0,n.mode=Un;case Un:for(;u<16;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(I[0]=255&c,I[1]=c>>>8&255,n.check=ge(n.check,I,2,0)),u=c=0,n.mode=Nn;case Nn:if(1024&n.flags){for(;u<16;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(I[0]=255&c,I[1]=c>>>8&255,n.check=ge(n.check,I,2,0)),u=c=0}else n.head&&(n.head.extra=null);n.mode=Vn;case Vn:if(1024&n.flags&&(s<(f=n.length)&&(f=s),f&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(i,i+f),S)),512&n.flags&&(n.check=ge(n.check,r,f,i)),s-=f,i+=f,n.length-=f),n.length))break e;n.length=0,n.mode=Hn;case Hn:if(2048&n.flags){if(0===s)break e;for(f=0;S=r[i+f++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S)),S&&f<s;);if(512&n.flags&&(n.check=ge(n.check,r,f,i)),s-=f,i+=f,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=zn;case zn:if(4096&n.flags){if(0===s)break e;for(f=0;S=r[i+f++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S)),S&&f<s;);if(512&n.flags&&(n.check=ge(n.check,r,f,i)),s-=f,i+=f,S)break e}else n.head&&(n.head.comment=null);n.mode=Wn;case Wn:if(512&n.flags){for(;u<16;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=dr;break}u=c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Gn;break;case Zn:for(;u<32;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}e.adler=n.check=mr(c),u=c=0,n.mode=Kn;case Kn:if(0===n.havedict)return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,n.hold=c,n.bits=u,Bn;e.adler=n.check=1,n.mode=Gn;case Gn:if(t===En||t===In)break e;case Xn:if(n.last){c>>>=7&u,u-=7&u,n.mode=lr;break}for(;u<3;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}switch(n.last=1&c,u-=1,3&(c>>>=1)){case 0:n.mode=Jn;break;case 1:if(Er(n),n.mode=tr,t===In){c>>>=2,u-=2;break e}break;case 2:n.mode=Yn;break;case 3:e.msg="invalid block type",n.mode=dr}c>>>=2,u-=2;break;case Jn:for(c>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=dr;break}if(n.length=65535&c,u=c=0,n.mode=Qn,t===In)break e;case Qn:n.mode=qn;case qn:if(f=n.length){if(s<f&&(f=s),l<f&&(f=l),0===f)break e;a.set(r.subarray(i,i+f),o),s-=f,i+=f,l-=f,o+=f,n.length-=f;break}n.mode=Gn;break;case Yn:for(;u<14;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=dr;break}n.have=0,n.mode=$n;case $n:for(;n.have<n.ncode;){for(;u<3;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}n.lens[O[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},k=wn(Sn,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,k){e.msg="invalid code lengths set",n.mode=dr;break}n.have=0,n.mode=er;case er:for(;n.have<n.nlen+n.ndist;){for(;m=(E=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,g=65535&E,!((p=E>>>24)<=u);){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(g<16)c>>>=p,u-=p,n.lens[n.have++]=g;else{if(16===g){for(T=p+2;u<T;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(c>>>=p,u-=p,0===n.have){e.msg="invalid bit length repeat",n.mode=dr;break}S=n.lens[n.have-1],f=3+(3&c),c>>>=2,u-=2}else if(17===g){for(T=p+3;u<T;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}u-=p,S=0,f=3+(7&(c>>>=p)),c>>>=3,u-=3}else{for(T=p+7;u<T;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}u-=p,S=0,f=11+(127&(c>>>=p)),c>>>=7,u-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=dr;break}for(;f--;)n.lens[n.have++]=S}}if(n.mode===dr)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=dr;break}if(n.lenbits=9,C={bits:n.lenbits},k=wn(kn,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,k){e.msg="invalid literal/lengths set",n.mode=dr;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},k=wn(Cn,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,k){e.msg="invalid distances set",n.mode=dr;break}if(n.mode=tr,t===In)break e;case tr:n.mode=nr;case nr:if(6<=s&&258<=l){e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,n.hold=c,n.bits=u,un(e,h),o=e.next_out,a=e.output,l=e.avail_out,i=e.next_in,r=e.input,s=e.avail_in,c=n.hold,u=n.bits,n.mode===Gn&&(n.back=-1);break}for(n.back=0;m=(E=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,g=65535&E,!((p=E>>>24)<=u);){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(m&&0==(240&m)){for(y=p,_=m,w=g;m=(E=n.lencode[w+((c&(1<<y+_)-1)>>y)])>>>16&255,g=65535&E,!(y+(p=E>>>24)<=u);){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}c>>>=y,u-=y,n.back+=y}if(c>>>=p,u-=p,n.back+=p,n.length=g,0===m){n.mode=sr;break}if(32&m){n.back=-1,n.mode=Gn;break}if(64&m){e.msg="invalid literal/length code",n.mode=dr;break}n.extra=15&m,n.mode=rr;case rr:if(n.extra){for(T=n.extra;u<T;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=ar;case ar:for(;m=(E=n.distcode[c&(1<<n.distbits)-1])>>>16&255,g=65535&E,!((p=E>>>24)<=u);){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(0==(240&m)){for(y=p,_=m,w=g;m=(E=n.distcode[w+((c&(1<<y+_)-1)>>y)])>>>16&255,g=65535&E,!(y+(p=E>>>24)<=u);){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}c>>>=y,u-=y,n.back+=y}if(c>>>=p,u-=p,n.back+=p,64&m){e.msg="invalid distance code",n.mode=dr;break}n.offset=g,n.extra=15&m,n.mode=ir;case ir:if(n.extra){for(T=n.extra;u<T;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=dr;break}n.mode=or;case or:if(0===l)break e;if(f=h-l,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=dr;break}f>n.wnext?(f-=n.wnext,b=n.wsize-f):b=n.wnext-f,f>n.length&&(f=n.length),v=n.window}else v=a,b=o-n.offset,f=n.length;for(l<f&&(f=l),l-=f,n.length-=f;a[o++]=v[b++],--f;);0===n.length&&(n.mode=nr);break;case sr:if(0===l)break e;a[o++]=n.length,l--,n.mode=nr;break;case lr:if(n.wrap){for(;u<32;){if(0===s)break e;s--,c|=r[i++]<<u,u+=8}if(h-=l,e.total_out+=h,n.total+=h,h&&(e.adler=n.check=n.flags?ge(n.check,a,h,o-h):pe(n.check,a,h,o-h)),h=l,(n.flags?c:mr(c))!==n.check){e.msg="incorrect data check",n.mode=dr;break}u=c=0}n.mode=cr;case cr:if(n.wrap&&n.flags){for(;u<32;){if(0===s)break e;s--,c+=r[i++]<<u,u+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=dr;break}u=c=0}n.mode=ur;case ur:k=Mn;break e;case dr:k=An;break e;case hr:return Dn;case fr:default:return xn}return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,n.hold=c,n.bits=u,(n.wsize||h!==e.avail_out&&n.mode<dr&&(n.mode<lr||t!==Tn))&&Ir(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,n.wrap&&h&&(e.adler=n.check=n.flags?ge(n.check,a,h,e.next_out-h):pe(n.check,a,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Gn?128:0)+(n.mode===tr||n.mode===Qn?256:0),(0===d&&0===h||t===Tn)&&k===On&&(k=Rn),k},inflateEnd:function(e){if(!e||!e.state)return xn;var t=e.state;return t.window&&(t.window=null),e.state=null,On},inflateGetHeader:function(e,t){if(!e||!e.state)return xn;var n=e.state;return 0==(2&n.wrap)?xn:((n.head=t).done=!1,On)},inflateSetDictionary:function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==Kn?xn:n.mode===Kn&&pe(1,t,r,0)!==n.check?An:Ir(e,t,r,r)?(n.mode=hr,Dn):(n.havedict=1,On):xn},inflateInfo:"pako inflate (from Nodeca project)"};function Mr(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Br=Mr,xr=Object.prototype.toString,Ar=_e.Z_NO_FLUSH,Dr=_e.Z_FINISH,Rr=_e.Z_OK,Lr=_e.Z_STREAM_END,Pr=_e.Z_NEED_DICT,Fr=_e.Z_STREAM_ERROR,jr=_e.Z_DATA_ERROR,Ur=_e.Z_MEM_ERROR;function Nr(e){this.options=jt.assign({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Zt,this.strm.avail_out=0;var n=Or.inflateInit2(this.strm,t.windowBits);if(n!==Rr)throw new Error(ye[n]);if(this.header=new Br,Or.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=zt.string2buf(t.dictionary):"[object ArrayBuffer]"===xr.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Or.inflateSetDictionary(this.strm,t.dictionary))!==Rr))throw new Error(ye[n])}function Vr(e,t){var n=new Nr(t);if(n.push(e),n.err)throw n.msg||ye[n.err];return n.result}function Hr(e,t){return(t=t||{}).raw=!0,Vr(e,t)}Nr.prototype.push=function(e,t){var n,r,a,i=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Dr:Ar,"[object ArrayBuffer]"===xr.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(n=Or.inflate(i,r))===Pr&&s&&((n=Or.inflateSetDictionary(i,s))===Rr?n=Or.inflate(i,r):n===jr&&(n=Pr));0<i.avail_in&&n===Lr&&0<i.state.wrap&&0!==e[i.next_in];)Or.inflateReset(i),n=Or.inflate(i,r);switch(n){case Fr:case jr:case Pr:case Ur:return this.onEnd(n),!(this.ended=!0)}if(a=i.avail_out,i.next_out&&(0===i.avail_out||n===Lr))if("string"===this.options.to){var l=zt.utf8border(i.output,i.next_out),c=i.next_out-l,u=zt.buf2string(i.output,l);i.next_out=c,i.avail_out=o-c,c&&i.output.set(i.output.subarray(l,l+c),0),this.onData(u)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(n!==Rr||0!==a){if(n===Lr)return n=Or.inflateEnd(this.strm),this.onEnd(n),this.ended=!0;if(0===i.avail_in)break}}return!0},Nr.prototype.onData=function(e){this.chunks.push(e)},Nr.prototype.onEnd=function(e){e===Rr&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=jt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var zr={Inflate:Nr,inflate:Vr,inflateRaw:Hr,ungzip:Vr,constants:_e},Wr={Deflate:sn.Deflate,deflate:sn.deflate,deflateRaw:sn.deflateRaw,gzip:sn.gzip,Inflate:zr.Inflate,inflate:zr.inflate,inflateRaw:zr.inflateRaw,ungzip:zr.ungzip,constants:_e}},vb380:function(e,i,o){"use strict";(function(e){o.d(i,"a",function(){return a});var t=o("vb58"),n=o.n(t),r=o("vb527");o("vb528");function a(){return n.a.createElement("div",{className:"bitable-card-comment"},n.a.createElement("div",{className:"bitable-card-comment__title"},e("bitable.record_comments")),n.a.createElement("div",{className:"b-comment-loading-container"},n.a.createElement("div",{className:"b-comment-loading-content"},n.a.createElement(r.a,{className:"b-comment-loading-icon"}))))}}).call(this,o("vb153"))},vb381:function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},vb419:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n("vb253"),a=n.n(r),i=n("vb379"),o=n("vb130");function s(e){return JSON.parse(i.a.ungzip(o.Buffer.from(e,"base64"),{to:"string"}))}function l(e){return o.Buffer.from(i.a.gzip(JSON.stringify(e),{level:9})).toString("base64")}var c={ungzip:s,gzip:l},u=function(e){var t=c[e.method];if(t)return t.apply(void 0,a()(e.args))}},vb420:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i});var r=n("vb114");function a(e){var t=Object(r.selectCurrentSuitePermissionInfo)(e);return null!=t&&null!=t.get("permissions")&&Object(r.getIsEditable)(t.get("permissions"))}var i=Object(r.createPermissionsFieldSelector)("isContainerOrPageFA")},vb421:function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return b}),n.d(t,"d",function(){return v});var r=n("vb56"),a=n.n(r),i=n("vb64"),o=n.n(i),s=n("vb58"),l=n.n(s),c=n("vb61"),u=n.n(c),d=n("vb380"),h=u()({loader:function(){var e=o()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("8f14e45fceea"),n.e("7bb53f704439"),n.e("1e1ebf3e2b21")]).then(n.bind(null,"vb767"));case 2:return e.abrupt("return",e.sent.BitableCommentBar);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return null}}),f=u()({loader:function(){var e=o()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("8f14e45fceea"),n.e("7bb53f704439"),n.e("1e1ebf3e2b21")]).then(n.bind(null,"vb772"));case 2:return e.abrupt("return",e.sent.BitableCommentCard);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return l.a.createElement(d.a,null)}}),b=u()({loader:function(){var e=o()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("8f14e45fceea"),n.e("7bb53f704439"),n.e("3e7bc8266763")]).then(n.bind(null,"vb774"));case 2:return e.abrupt("return",e.sent.DocCommentBar);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return null}}),v=u()({loader:function(){var e=o()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("8f14e45fceea"),n.e("7bb53f704439"),n.e("3e7bc8266763")]).then(n.bind(null,"vb775"));case 2:return e.abrupt("return",e.sent.DocCommentCard);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return l.a.createElement(d.a,null)}})},vb526:function(e,t,n){"use strict";n.d(t,"a",function(){return k});var r=n("vb254"),i=n.n(r),a=n("vb56"),l=n.n(a),o=n("vb64"),c=n.n(o),s=n("vb60"),u=n.n(s),d=n("vb234"),h=n.n(d),f=n("vb235"),b=n.n(f),v=n("vb241"),p=n.n(v),m=n("vb58"),g=n.n(m),y=n("vb114"),_=n("vb800"),w=n("vb116"),S=n("vb53");Object(w.default)(y.BitableGlobalConfig),Object(S.injectEmbedBitableDep)(y.BitableGlobalConfig);var k=function(o){function s(e){var r;h()(this,s),(r=o.call(this,e)||this).commonInit=null,r._onMountFired=!1,r.getEventList=function(){var e;return e={},u()(e,y.Events.OperationProduced,r.onOperationProduced),u()(e,y.Events.ChangesetApplied,r.onChangesetApplied),e},r.toggleEvents=function(e){var t=r.getEventList();r.bitableStore&&(e?r.bitableStore.addEventListeners(r.state.tableId,t):r.bitableStore.removeEventListeners(r.state.tableId,t))},r.onOperationProduced=function(e){r.props.onChanged&&r.props.onChanged(e.token),r.handleTriggerTryEidt(e)},r.onChangesetApplied=function(e){r.props.onChanged&&r.props.onChanged(e.token)},r.onDocumentKeyInvalid=function(){r.forceUpdate()},r.setHistory=function(){},r.syncVirtualScroll=function(){},r.updateOverlayerPosition=function(){},r.updateHighlight=function(e){r.setState({commentActionType:e})},r.updateBitableSelectionState=function(e){},r.destroy=function(){},r.collapseLineChange=function(e){},r.updateBitableContent=function(){},r.cancelPaste=function(){r.renderer.isCancelPaste=!0},r.setWidth=function(e,t,n){t===r.state.width&&n===r.state.padding||r.setState({width:t,padding:n})},r.setDocWidth=function(e){e!==r.state.docWidth&&r.setState({docWidth:e})},r.setMaxWidth=function(e){e!==r.state.maxWidth&&r.setState({maxWidth:e,maxHeight:1/0})},r.setHeight=function(e){r.setState({height:e})},r.setSize=function(e,t){},r.setZoom=function(e){},r.loadedTable=function(e){},r.switchTable=function(e){},r.addNewTable=function(e){},r.addRecoverCallback=function(n){var e=r.props.tableId;r.recoverCb&&r.bitableStore.removeEventListeners(e,u()({},y.Events.FetchRecoverHistory,r.recoverCb)),r.recoverCb=function(e){var t="";(e.operations.some(function(e){return!!e.transactionId&&(t=e.transactionId)}),r.recoverTransaction)?t===r.recoverTransaction||n(t):n(t)},r.bitableStore.addEventListeners(e,u()({},y.Events.FetchRecoverHistory,r.recoverCb))},r.setCommentData=function(e,t){return r.smartableCommentManager.setCommentData(e,t)},r.startNewComment=function(e,t,n){return r.smartableCommentManager.startNewComment(e,t,n)},r.getComments=function(e){return r.smartableCommentManager.getComments(e)},r.setCommentBatchUpdate=function(e,t,n){r.smartableCommentManager.setBatchCommentUpdater(e,t,n)},r.addHoverHighlight=function(e,t){return r.smartableCommentManager.addHoverHighlight(e,t)},r.removeHoverHighlight=function(e,t){return r.smartableCommentManager.removeHoverHighlight(e,t)},r.getActiveComments=function(e){return r.smartableCommentManager.getActiveComments(e)},r.getResolvedComments=function(e){return r.smartableCommentManager.getResolvedComments(e)},r.setResolvedCommentIds=function(e,t){return r.smartableCommentManager.setResolvedCommentIds(e,t)},r.saveComment=function(e,t,n){return r.smartableCommentManager.saveComment(e,t,n)},r.removeComment=function(e,t){return r.smartableCommentManager.removeComment(e,t)},r.removeTempComment=function(e,t){return r.smartableCommentManager.removeTempComment(e,t)},r.resolveComment=function(e,t){return r.smartableCommentManager.resolveComment(e,t)},r.activateComment=function(e,t){return r.smartableCommentManager.activateComment(e,t)},r.deactivateComment=function(e,t){return r.smartableCommentManager.deactivateComment(e,t)},r.reopenComment=function(e,t){return r.smartableCommentManager.reopenComment(e,t)},r.findComment=function(e,t){return r.smartableCommentManager.findComment(e,t)},r.getTeaParams=function(e,t){return r.smartableCommentManager.getTeaParams(e,t)},r.getSmartableCommentManager=function(){return r.smartableCommentManager},r.getCommentPositions=function(e){return[]};var t=e.bitableStore,n=e.editable,a=void 0!==n&&n,i=e.mountOption;return t.setBasePermission(a),r.state={tableId:e.tableId,suspend:!1,width:_.a.width,padding:_.a.offsetX,commentActionType:e.commentActionType,maxWidth:e.maxWidth,offsetX:e.offsetX,docWidth:e.docWidth,zoom:"number"==typeof e.zoom?e.zoom:1,isSelect:!1,height:e.height,delayLoading:!1,isHistoryMode:!1,collapsed:!1,errorCodeType:i.errorCodeType||y.EErrorCodeType.none},r.init(r._token),r}return p()(s,o),b()(s,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.width,r=t.padding,a=t.height,i=t.maxWidth,o=t.offsetX,s=t.docWidth;e.width===n&&e.padding===r&&e.height===a&&e.maxWidth===i&&e.offsetX===o&&e.docWidth===s||this.setState({width:e.width,padding:e.padding,height:e.height,maxWidth:e.maxWidth,offsetX:e.offsetX,docWidth:e.docWidth})}},{key:"componentDidMount",value:function(){var e=this.props.onMount;this.toggleEvents(!0),this.setHistory(),e&&e(this),this.renderer.storageManager.setToken(this._token),this.notifyEmbedBitableLoaded(),this.commonInit&&this.commonInit.init()}},{key:"componentDidUpdate",value:function(e){this.notifyEmbedBitableLoaded();var t=this.props,n=t.editable,r=void 0!==n&&n,a=t.bitableStore;r!==(e.editable||!1)&&a.setBasePermission(r)}},{key:"notifyEmbedBitableLoaded",value:function(){var e=this.props.onLoaded;if(!this._onMountFired&&e){var t=this.props,n=t.bitableStore,r=t.tableId;(n.isTableOrClientVarLoaded(r)||!1)&&(e(),this._onMountFired=!0)}}},{key:"componentWillUnmount",value:function(){this.props.bitableStore.getBaseEventManager().removeListener(y.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid),this.toggleEvents(!1),delete this.notify,this.commonInit&&this.commonInit.unbindEvents()}},{key:"_token",get:function(){return this.props.token}},{key:"init",value:function(e){var t=this.props,n=t.bitableStore,r=t.storageManager,a=t.isVCEnable,i=new y.Renderer(n,r,{reduxStore:this.props.store,isVCEnable:a});this.bitableStore=n,this.renderer=i,this.initCommentManager(),this.setHistory(),i.storageManager.setToken(e),n.getBaseEventManager().addListener(y.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid)}},{key:"initCommentManager",value:function(){}},{key:"handleTriggerTryEidt",value:function(e){e.operation.command!==y.CollaCommands.AddComment&&S.BearWebHelper&&S.BearWebHelper.triggerBitableTryEdit&&S.BearWebHelper.triggerBitableTryEdit()}},{key:"takeScreenShot",value:function(){var n=c()(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(){return{scrollPosX:0,contentWidth:0}}},{key:"setBitableViewScrollPosition",value:function(e,t){}},{key:"setOffsetX",value:function(e){-30===e&&(e=0),e!==this.state.offsetX&&this.setState({offsetX:e})}},{key:"getSelection",value:function(){var e=this.renderer.activeBitableWidget;return e?e.getGridWidget().getSelection():null}},{key:"clearSelection",value:function(){var e=this.renderer.activeBitableWidget;if(!e)return null;e.getGridWidget().setSelection(null)}},{key:"switch",value:function(e,t){}},{key:"locateMention",value:function(){var r=c()(l.a.mark(function e(t,n,r){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.renderer.showMentionInFeed(t,n,r);case 2:if(a=e.sent,"object"!==i()(a)){e.next=5;break}return e.abrupt("return",a);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}},e,this)}));function e(e,t,n){return r.apply(this,arguments)}return e}()},{key:"registerScrollContainerRef",value:function(e,t){}},{key:"getDocWidth",value:function(){return 0}},{key:"receive",value:function(e){switch(e){case y.notifyEvents.UpdateBitableById:this.renderer.updateFaster();break;default:return}}},{key:"setNotifier",value:function(e){this.notify=e}},{key:"suspend",value:function(){this.setState({suspend:!0})}},{key:"resume",value:function(){this.setState({suspend:!1})}},{key:"setRecoverTransactionId",value:function(t){var e=this,n="",r=Object.keys(t);r.some(function(e){return!!t[e].transaction_id&&(n=t[e].transaction_id,!0)}),this.bitableStore.base.getTables().forEach(function(t){r.some(function(e){return e===t.id})||e.bitableStore.resetSyncTableById(t.id)}),this.recoverTransaction=n}},{key:"previewHistory",value:function(e,t){this.setState({isHistoryMode:!0})}},{key:"exitHistory",value:function(){this.setState({isHistoryMode:!1})}},{key:"recover",value:function(){var t=c()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"handleBitableIfPaste",value:function(){}},{key:"getZoom",value:function(){return 1}},{key:"onLoadedTable",value:function(){}},{key:"currentScreenShot",value:function(){}},{key:"freeze",value:function(){this.props.bitableStore.freeze()}},{key:"unfreeze",value:function(){this.props.bitableStore.unfreeze()}},{key:"updateErrorCodeType",value:function(e){e&&e!==this.state.errorCodeType&&this.setState({errorCodeType:e})}}]),s}(g.a.PureComponent)},vb527:function(e,t,n){"use strict";var r=n("vb381"),a=n.n(r),i=n("vb58"),o=n.n(i);function s(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}t.a=function(e){e.styles;var t=s(e,["styles"]);return o.a.createElement("svg",a()({width:"18",height:"18",viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("g",{fill:"#07F",fillRule:"nonzero"},o.a.createElement("circle",{opacity:".4",cx:"3.61",cy:"3.5",r:"3.5"}),o.a.createElement("path",{d:"M14.5 7a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"}),o.a.createElement("circle",{opacity:".7",cx:"14.5",cy:"14.5",r:"3.5"}),o.a.createElement("circle",{opacity:".2",cx:"3.5",cy:"14.5",r:"3.5"})))}},vb528:function(e,t,n){},vb529:function(e,t,n){},vb574:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n("vb234"),a=n.n(r),i=n("vb235"),o=n.n(i),s=function(){function e(){a()(this,e)}return o()(e,null,[{key:"createForFullScreen",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=document.createElement("div"),n=document.getElementById("mainContainer")||document.body;return e&&(n=document.querySelector(".create-by-template__container")||n),Object.assign(t.style,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"100",backgroundColor:"var(--bg-body)"}),t.className="layout-column flex",n.appendChild(t),t}},{key:"createForHistory",value:function(){var e=document.createElement("div"),t=document.getElementById("mainContainer");return Object.assign(e.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:"88",backgroundColor:"var(--bg-body)"}),t.appendChild(e),e}},{key:"remove",value:function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}}]),e}()},vb575:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r=function(e){return window.requestAnimationFrame?window.requestAnimationFrame(e):window.setTimeout(e,16)},a=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e):window.clearTimeout(e)}},vb576:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n("vb148"),a=n("vb341"),i=n("vb114"),o=n("vb53"),s=n("vb1043"),l=n("vb1046");function c(e){return e&&(e=Object(r.a)(e)),Object(a.createStore)({initialState:e,enhancers:[],extensions:[Object(s.getSagaExtension)(),Object(l.getThunkExtension)()]},Object(o.getAppStateModule)(),Object(o.getEntitiesModule)(),Object(i.getBitableModule)())}},vb676:function(e,t,n){"use strict";function r(e,t){if("function"==typeof e&&"function"==typeof t)return e===t;if(!e||!t)return e===t;if("function"==typeof e)return(r=e)===(n=t).saga&&!n.argument;if("function"==typeof t){var n=t;return(r=e).saga===n&&!r.argument}var r;n=t;return(r=e).saga===n.saga&&r.argument===n.argument}t.__esModule=!0,t.sagaEquals=r},vb677:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={LOADED_BITABLE_BLOCK:"LOADED_BITABLE_BLOCK",BITABLE_ENTER_DOC_FULLSCREEN:"BitableEnterDocFullScreen",BITABLE_EXIT_DOC_FULLSCREEN:"BitableExitDocFullScreen",BITABLE_OVERLAYER_POSITION_UPDATING:"BitableOverlayerPositionUpdating"}},vb678:function(e,t,n){"use strict";e.exports=function(t,n,r,a){var i=self||window;try{try{var o;try{o=new i.Blob([t])}catch(e){var s=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder;(o=new s).append(t),o=o.getBlob()}var e=i.URL||i.webkitURL,l=e.createObjectURL(o),c=new i[n](l,r);return e.revokeObjectURL(l),c}catch(e){return new i[n]("data:application/javascript,".concat(encodeURIComponent(t)),r)}}catch(e){if(!a)throw Error("Inline worker is not supported");return new i[n](a,r)}}},vb679:function(e,t,n){},vb680:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r=n("vb56"),i=n.n(r),a=n("vb64"),o=n.n(a),s=n("vb234"),l=n.n(s),c=n("vb235"),u=n.n(c),d=n("vb53"),h=n("vb114"),f=function(){function a(e){var r=this;l()(this,a),this.commentSDK=null,this.handleCommentDataChange=function(e,t,n){n&&n.isInit&&r.updateIsCommentDataInit()},this.updateIsCommentDataInit=function(){d.store.dispatch(Object(h.toggleIsCommentDataInit)(!0))};var t=e.suiteToken,n=e.suiteType;this.suiteToken=t,this.suiteType=n}return u()(a,[{key:"init",value:function(){var e=o()(i.a.mark(function e(){var t,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(d.loadableCommentDep)();case 3:if(t=e.sent,n=t.commentSDKManager,r=n.getOrCreate({serviceToken:this.suiteToken,serviceType:this.suiteType}),this.commentSDK=r){e.next=9;break}return e.abrupt("return");case 9:r&&r.hasInitCommentData&&this.updateIsCommentDataInit(),r.on("commentDataChange",this.handleCommentDataChange),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("CommentInit error",e.t0);case 17:case"end":return e.stop()}},e,this,[[0,14]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"unbindEvents",value:function(){this.commentSDK&&this.commentSDK.off("commentDataChange",this.handleCommentDataChange)}}]),a}()},vb681:function(e,J,Q){"use strict";(function(i){Q.d(J,"b",function(){return K}),Q.d(J,"a",function(){return X});var e=Q("vb56"),m=Q.n(e),t=Q("vb64"),o=Q.n(t),n=Q("vb60"),r=Q.n(n),a=Q("vb234"),s=Q.n(a),l=Q("vb235"),c=Q.n(l),u=Q("vb299"),p=Q.n(u),d=Q("vb241"),h=Q.n(d),f=Q("vb300"),b=Q.n(f),v=Q("vb287"),g=Q.n(v),y=Q("vb254"),_=Q.n(y),w=Q("vb140"),S=Q("vb87"),E=Q.n(S),k=Q("vb526"),I=Q("vb114"),C=Q("vb90"),O=Q("vb53"),T=Q("vb677"),M=Q("vb58"),B=Q.n(M),x=(Q("vb1050"),Q("vb131")),D=Q.n(x),R=Q("vb121"),L=Q("vb115"),P=Q("vb421"),F=Q("vb420"),j=Q("vb1051"),U=Q("vb1052"),N=Q("vb680"),V=Q("vb102");function H(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function z(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?H(Object(n),!0).forEach(function(e){r()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var W=function(e,t,n,r){var a,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":_()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(a=e[s])&&(o=(i<3?a(o):3<i?a(t,n,o):a(t,n))||o);return 3<i&&o&&Object.defineProperty(t,n,o),o},Z=!0,K=function(a){function l(e){var t,v;s()(this,l),(v=a.call(this,e)||this).updateSheetSelectionStateCoreTimer=0,v.overlayerRef=null,v.floatToolbarRef=null,v.docContainer=null,v.updateOverlayRafId=null,v.bitableRef=null,v.shouldBindContainerEvent=!0,v.scrollContainer=null,v.lastOverlayerPosition=null,v.collapseLineChange=function(e){v.state.collapsed!==e&&v.setState({collapsed:e})},v.updateBitableContent=function(){v.renderer.batchUpdateFaster()},v.syncVirtualScroll=function(){v.scrollHandle&&v.scrollHandle(),v.updateOverlayerPosition()},v.getActiveViewFromState=function(){var e=v.props.tableId,t=v.context.store;return Object(I.tableViewSelector)(t.getState(),e,Object(I.tableActiveViewIdSelector)(t.getState(),e))},v.getVCfollowId=function(){return v.props.tableId},v.openVCFollow=function(){Object(I.enableModuleFollowState)(I.BitableFollowModule.BitableFullScreen,v.replayVCFollowState,{instanceId:v.getVCfollowId()}),v.sendVCStateChange(v.getVCFollowState())},v.closeVCFollow=function(){v.sendVCStateChange({fullscreen:""}),Object(I.closeModuleFollow)(I.BitableFollowModule.BitableFullScreen,v.replayVCFollowState,{instanceId:v.getVCfollowId()})},v.sendVCStateChange=function(e){Object(I.sendFollowState)(I.BitableFollowModule.BitableFullScreen,e,{instanceId:v.getVCfollowId()})},v.getVCFollowState=function(){return{fullscreen:v.props.fullScreenTableId||""}},v.onFullScreenClick=function(){var e=v.props,t=e.tableId,n=e.shell.onFullScreenMode,r=e.isFullScreenMode,a=e.setFullScreenTableId;if(!r&&n){n(t),a(t),I.BitableTea.collectBitableEvent(I.ClickEvent.CcmBitableToolbarClick,{click:I.ToolbarItemClickEventMap[I.ToolbarItemType.FULL_SCREEN],target:I.DEFAULT_TARGET}),v._setActiveBitable();var i=v.getActiveViewFromState();i&&I.BitableDep.collectBitableEvent("click_enter_full_screen",{source:"click_btn",block_type:"bitable",view_type:I.ViewTypeStringMap[i.type]}),v.sendVCStateChange({fullscreen:t})}},v.exitFullScreen=function(){var e=v.props,t=e.shell.exitFullScreenMode,n=e.setFullScreenTableId;if(t){t(),n(""),I.BitableTea.collectBitableEvent(I.ClickEvent.CcmBitableToolbarClick,{click:I.ToolbarItemClickEventMap[I.ToolbarItemType.FULL_SCREEN],target:I.DEFAULT_TARGET});var r=v.getActiveViewFromState();r&&I.BitableDep.collectBitableEvent("click_exit_full_screen",{source:"click_btn",block_type:"bitable",view_type:I.ViewTypeStringMap[r.type]}),v.sendVCStateChange({fullscreen:""})}},v.setSize=function(e,t){e!==v.state.maxWidth&&t!==v.state.maxHeight&&v.setState({maxWidth:e,maxHeight:t})},v.setZoom=function(e){e!==v.state.zoom&&v.setState({zoom:e})},v._doResizeInFullScreen=Object(w.a)(function(){v.setState({maxWidth:window.innerWidth})},100),v._setActiveBitable=function(){var e=v.props.tableId,t=p()(v).renderer;I.RendererManager.getActiveTableId()!==e&&I.RendererManager.setActiveRenderer(t)},v._handleFullScreenClick=function(){O.BearWebHelper&&O.BearWebHelper.triggerBitableFullScreenClick&&O.BearWebHelper.triggerBitableFullScreenClick()},v.setHistory=function(){v.props.storageManager.setHistory(v.props.history)},v.renderToolbar=function(e,t){var n,r,a=p()(v),i=a.props,o=a.state,s=i.bitableStore,l=i.tableId,c=i.isFullScreenMode,u=i.viewId,d=i.mountOption,h=i.isVCEnable,f=o.docWidth,b=o.offsetX;return c||(n=z({position:"absolute",paddingLeft:e.paddingLeft||b,boxSizing:"content-box"},e),r=t),B.a.createElement("div",{className:D()("bitable-toolbar-doc-wrapper layout-row layout-cross-center f-s-0",{"bitable-toolbar-doc-fullscreen-wrapper":c}),ref:function(e){return v.toolBarRef=e},onWheel:r,style:n},B.a.createElement(I.EmbeddedDocToolBar,{tableId:l,viewId:u,isFullScreen:c,bitableStore:s,renderer:v.renderer,smartableCommentManager:v.smartableCommentManager,docWidth:f,exitFullScreen:c?v.exitFullScreen:void 0,viewsExclude:d.viewsExclude,sideBarOverlay:v.getIsDocx()?v.overlayerRef:null,isVCEnable:h}),O.browser.safari&&B.a.createElement("div",{className:"j-safari-selection"}))},v.renderScreenShotToolbar=function(e,t){var n=z({position:"static"},e);return v.renderToolbar(n,t)},v.onShowFloatToolBar=function(){I.BitableTea.collectBitableEvent(I.ViewEvent.CcmBitableToolbarView,{trigger_type:I.ToolBarShowType.HoverWhole},!0,v.renderer)},v.setFloatToolbarRef=function(e){v.floatToolbarRef=e},v._updateOverlayPosition=function(){var e=v.props.mountOption;if(O.EventEmitter.emit(T.a.BITABLE_OVERLAYER_POSITION_UPDATING),v.overlayerRef){var t=e.operator.getBitablePosition(),n=t.left,r=t.top;if(v.lastOverlayerPosition&&v.lastOverlayerPosition.left===n&&v.lastOverlayerPosition.top===r)return;v.lastOverlayerPosition={top:r,left:n},v.overlayerRef.style.left=n+"px",v.overlayerRef.style.top=r+"px"}},v.updateOverlayerPosition=function(){v.props.isFullScreenMode||(v.getIsDocx()?v._updateOverlayPosition():(null!==v.updateOverlayRafId&&(cancelAnimationFrame(v.updateOverlayRafId),v.updateOverlayRafId=null),v.updateOverlayRafId=requestAnimationFrame(function(){v.updateOverlayRafId=null,v._updateOverlayPosition()})))},v.setOverLayerRef=function(e){v.overlayerRef=e},v.setOnScrollHandle=function(e){v.scrollHandle=e},v.setToolBarStyle=function(e,t){function n(e,t){return e.top===t.top&&e.bottom===t.bottom}e&&v.toolBarRef&&!n(v.toolBarRef.style,e)&&Object.assign(v.toolBarRef.style,e)},v.updateSelect=function(e,t){v.setState({isSelect:e,selectedStyle:t})},v.hoverBitable=function(){v.notify&&v.notify({name:"HoverDocBitable"}),v.setState({hoverBitable:!0})},v.receive=function(e){switch(b()((t=p()(v),g()(l.prototype)),"receive",t).call(t,e),e){case"HoverDocBitable":v.state.hoverBitable&&v.setState({hoverBitable:!1});break;default:return}},v.isMouseInOverlay=function(e){var t=v.props.mountOption.overlayContainer;return!!(t&&e&&t.contains(e))},v.leaveBitable=function(e){if(!1!==v.state.hoverBitable){var t=e.relatedTarget;if(!v.props.isFullScreenMode){var n=!1,r=!1;t instanceof Node&&(n=v.isMouseInOverlay(t),r=!(!v.bitableRef||!v.bitableRef.contains(t)));var a=!t||!t.classList||!t.classList.contains("J-bitable-container");n||r||!a||v.setState({hoverBitable:!1})}}},v.setBitableRef=function(e){v.embedBitableRef=e&&e.wrappedInstance?e.wrappedInstance:e,v.scrollContainer&&v.embedBitableRef&&v.embedBitableRef.registerScrollContainerRef&&v.embedBitableRef.registerScrollContainerRef(v.scrollContainer),e&&v.openVCFollow()},v.getSearchBaseOpts=function(){var e=p()(v).renderer,t=v.props;return{bitableStore:t.bitableStore,renderer:e,tableId:t.tableId,viewId:t.viewId}},v.highlightSearchItem=function(e,t,n){return Object(I.highlightSearchResultInDoc)(t,v.getSearchBaseOpts(),n)},v.setBitableContainerRef=function(e){v.bitableRef&&e!==v.bitableRef&&v.unbindBitableContainerEvent(),v.bitableRef=e,v.props.isFullScreenMode||v.bindBitableContainerEvent()},v.handleUploadError=function(e){var t=e&&e.errorType;if(O.BearWebHelper&&!O.BearWebHelper.isLark()&&O.Constant&&t===O.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_CREATE_LIMIT)O.BearWebHelper.triggerStoragePicLimitDialog();else if(O.BearWebHelper&&O.Constant&&t===O.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_USER_STORAGE_LIMIT){var n={mountPoint:e.mountPoint,mountNodeToken:e.parentToken};O.BearWebHelper.triggerUserPicLimitDialog(n)}else O.Toast.show({type:"error",content:i("common.server_busy")})},v.triggerBitableCommentLoaded=o()(m.a.mark(function e(){var t,n,r,a,i;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.props,n=t.tableId,r=t.mountOption,!(a=r.operator)){e.next=7;break}return e.next=5,v.bitableStore.waitTableClientVarLoaded(n);case 5:i=v.smartableCommentManager.getComments(n),a.onCommentLoaded&&a.onCommentLoaded(i);case 7:case"end":return e.stop()}},e)})),v.renderBlockError=function(e){var t=v.state.offsetX;return B.a.createElement(U.a,{errorCodeType:e,offsetX:v.getIsDocx()?0:t})};var n=e.bitableStore,r=e.tableId;return n.initTableEventManager(r),v}return h()(l,a),c()(l,[{key:"componentDidMount",value:function(){var e=o()(m.a.mark(function e(){var t,n,r,a,i,o,s;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:b()(g()(l.prototype),"componentDidMount",this).call(this),t=this.props,n=t.bitableStore,r=t.tableId,a=t.isFullScreenMode,i=t.setFullScreenTableId,o=t.setFloatToolbarTable,(s=n.base.getTableById(r))&&s.tableLoaded&&this.renderer.loadedTable(r),a&&(window.addEventListener("resize",this._doResizeInFullScreen),window.addEventListener("click",this._handleFullScreenClick),i(r),o("",!1),O.EventEmitter.emit(T.a.BITABLE_ENTER_DOC_FULLSCREEN)),this.triggerBitableCommentLoaded();case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"componentWillUnmount",value:function(){var e=this.renderer,t=this.props,n=t.isFullScreenMode,r=t.setFullScreenTableId;n?(window.removeEventListener("resize",this._doResizeInFullScreen),window.removeEventListener("click",this._handleFullScreenClick),r(""),O.EventEmitter.emit(T.a.BITABLE_EXIT_DOC_FULLSCREEN),this.smartableCommentManager.exitDocFullScreen()):(e.destroyAllLoadingAttaches(),e.cancelPaste&&e.cancelPaste(),e.cancelPaste=null,this.updateOverlayRafId&&cancelAnimationFrame(this.updateOverlayRafId),this.updateOverlayRafId=null,this.unbindBitableContainerEvent(),this.bitableRef=null),this.scrollHandle=function(){return null},b()(g()(l.prototype),"componentWillUnmount",this).call(this),this.closeVCFollow()}},{key:"componentWillReceiveProps",value:function(e){""!==e.fullScreenTableId&&this.setState({hoverBitable:!1}),e.isEditMode!==this.props.isEditMode&&(!1===e.isEditMode?this.freeze():this.unfreeze())}},{key:"handleBitableIfPaste",value:function(){var e=o()(m.a.mark(function e(){var t,n,r,a,i,o,s,l,c,u,d,h,f,b,v,p;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.renderer,n=this.props,r=n.tableId,a=n.bitableStore,i=n.initViewIdIndex,o=void 0===i?0:i,(s=R.bitableToPaste.get(r))&&s.status===R.BitableToPasteStatus.TO_PASTE){e.next=5;break}return e.abrupt("return");case 5:if(l=a.base.getTableById(r)){e.next=8;break}return e.abrupt("return");case 8:if(c=l.views[o]){e.next=11;break}return e.abrupt("return");case 11:if(s.status=R.BitableToPasteStatus.PASTING,R.bitableToPaste.set(r,s),u=s.source,d=null,u===R.BitablePasteSource.BLOCK?(h=s.tableDataSet,f=s.pasteTableBaseId,b=s.pasteComment,(d=L.DefaultActions.csToJSON(h,c.id,a.base,b))&&(d.baseId=f)):u===R.BitablePasteSource.BITABLE&&(d=s.stdValueTable),d){e.next=18;break}return e.abrupt("return");case 18:return v=t.clipboardHelper,p=new I.Range(0,0,c.getAllRecords().length,c.getColumnCount()),e.next=22,v.pasteForDocBlock(d,c,[p]);case 22:this.setState({delayLoading:!1}),s.status=R.BitableToPasteStatus.PASTED,R.bitableToPaste.set(r,s);case 25:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getFloatToolbarVisibility",value:function(){var e=this.state.hoverBitable,t=this.props,n=t.showFloatToolbar,r=t.isEditing,a=t.fullScreenTableId,i=t.tableId,o=t.bitableStore,s=""!==a,l=this.context.store,c=Object(I.getOtherFloatToolbarShowing)(l.getState(),i);if(s||c||o.Options.module===I.BitableStoreModuleType.Template)return!1;var u=!!(n||r||e);return u?this.floatToolbarRef&&this.floatToolbarRef.addEventListener("click",this._setActiveBitable,!0):this.floatToolbarRef&&this.floatToolbarRef.removeEventListener("click",this._setActiveBitable,!0),u}},{key:"getDocContainer",value:function(){return this.docContainer||(this.getIsDocx()?this.docContainer=document.querySelector(".bear-web-x-container"):this.docContainer=document.querySelector(".history-editor-wrapper")||document.querySelector(".etherpad-container-wrapper")),this.docContainer}},{key:"init",value:function(e){var t=this.props,n=t.bitableStore,r=t.storageManager,a=t.tableId,i=t.initViewIdIndex,o=t.mountOption,s={tableId:a,initViewIdIndex:i,isFullScreen:!!t.isFullScreenMode,reduxStore:t.store,isVCEnable:Z},l=new I.DocBitableRenderer(n,r,s);this.bitableStore=n,this.renderer=l,this.initCommentManager(),this.setHistory(),this.props.storageManager.setToken(e),o.operator.onRecover&&this.addRecoverCallback(o.operator.onRecover),n.getBaseEventManager().addListener(I.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid)}},{key:"replayVCFollowState",value:function(e){var t=e.data.fullscreen;return this.getVCFollowState().fullscreen===t||(t?this.onFullScreenClick():this.exitFullScreen()),{status:I.ReplayStatus.Success}}},{key:"initCommentManager",value:function(){var e=this.props,t=e.bitableStore,n=e.mountOption,r=e.isFullScreenMode,a=e.smartableCommentManager,i=e.suiteToken,o=e.suiteType,s=n.operator.onActiveCommentChange,l=this.renderer;this.commonInit=new N.a({suiteToken:i,suiteType:o});var c={onActiveCommentChange:s};if(r)this.smartableCommentManager=a,this.smartableCommentManager.enterDocFullScreen(l);else{var u=O.CommentHelper&&O.CommentHelper.DocNewCommentEnable||this.getIsDocx();this.smartableCommentManager=new I.DocSmartableCommentManager({renderer:l,bitableStore:t,comment:c,customCommentCard:u?P.d:void 0,customCommentBar:u?P.c:void 0})}}},{key:"renderFloatToolbar",value:function(){var e=this.props,t=e.mountOption,n=e.tableId,r=e.viewId,a=e.bitableStore,i=e.fullScreenTableId,o=e.showFloatToolbar,s=e.isEditing,l=this.state,c=l.docWidth,u=l.offsetX;if(l.delayLoading)return null;var d={left:(void 0!==c?c:0)+u},h=""!==i,f=O.fsController.isInFullscreen();return B.a.createElement("div",{className:"bitable-float-toolbar-container",ref:this.setFloatToolbarRef,style:d},!h&&!f&&B.a.createElement(I.EmbeddedDocFloatToolBar,{tableId:n,viewId:r,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,onFullScreenClick:this.onFullScreenClick,bitableStore:a,mountOption:t,isShow:this.getFloatToolbarVisibility(),fixFloatToolbarShow:o||s,onShow:this.onShowFloatToolBar}))}},{key:"currentScreenShot",value:function(){if(this.embedBitableRef)return this.embedBitableRef.currentScreenShot();console.warn("bitable block is empty!")}},{key:"takeScreenShot",value:function(){var n=o()(m.a.mark(function e(t,n){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.embedBitableRef&&this.embedBitableRef.takeScreenShot&&this.embedBitableRef.takeScreenShot(t,n));case 1:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(){var e=this.renderer.activeBitableWidget,t=e&&this.renderer.activeBitableWidget.getActiveWidget();if(!t)return{scrollPosX:0,contentWidth:0};var n=t.getContentDocWidth?t.getContentDocWidth():0;return{scrollPosX:(t.getScrollPosition?t.getScrollPosition():{x:0}).x,contentWidth:n,viewType:e.getView().type||I.ViewType.NotSupport}}},{key:"setBitableViewScrollPosition",value:function(e,t){var n=this.renderer.activeBitableWidget&&this.renderer.activeBitableWidget.getActiveWidget();if(n){if(this.scrollContainer&&null!=t){var r,a=(this.scrollContainer.current.getBoundingClientRect().right||0)-((null===(r=this.bitableRef)||void 0===r?void 0:r.getBoundingClientRect().left)||0);n.setWidgetConfig&&n.setWidgetConfig({visibleRightBound:a}),this.setOffsetX(t)}if(void 0===(null==e?void 0:e.viewType)||void 0===(null==e?void 0:e.ratio))null!=e&&n.setScrollPosition&&n.setScrollPosition(e);else{if(!this.renderer.activeBitableWidget)return;if(e.viewType!==I.ViewType.Grid&&e.viewType!==I.ViewType.Kanban)return;var i=e.viewType===I.ViewType.Grid?this.renderer.activeBitableWidget.getGridWidget():this.renderer.activeBitableWidget.getKanbanWidget(),o=i.getContentDocWidth?i.getContentDocWidth():0;i.setScrollPosition({x:e.ratio*o})}}}},{key:"renderOverlay",value:function(){var e=this.props.mountOption;if(!e.overlayContainer)return null;var t=e.operator.getBitablePosition(),n=t.left,r=t.top;return B.a.createElement("div",{ref:this.setOverLayerRef,className:D()("bitable-doc-overlay","bitable-toolbar-docx",{"bitable-doc-overlay-hide":this.state.suspend}),style:{top:r,left:n}},this.renderFloatToolbar())}},{key:"getSearchResult",value:function(e,t){var n=this,r=Object(I.getSearchResultInDoc)(e,t,this.getSearchBaseOpts()),a=this.getDocContainer();return a?r.map(function(e){return z({},e,{scrollFn:Object(I.getScrollFnInDoc)(e,n.getSearchBaseOpts(),a,n.bitableRef)})}):[]}},{key:"getSearchItemPos",value:function(e,t){return Object(I.getSearchItemRectInDoc)(t,this.getSearchBaseOpts())||{x:0,y:0,width:0,height:0}}},{key:"clearHighlight",value:function(e,t){return Object(I.clearHighlightInDoc)(this.getSearchBaseOpts())}},{key:"registerScrollContainerRef",value:function(e,t){this.scrollContainer=t,this.embedBitableRef&&this.embedBitableRef.registerScrollContainerRef&&this.embedBitableRef.registerScrollContainerRef(t)}},{key:"bindBitableContainerEvent",value:function(){this.bitableRef&&this.shouldBindContainerEvent&&(this.bitableRef.addEventListener("mouseenter",this.hoverBitable),this.bitableRef.addEventListener("mouseleave",this.leaveBitable),this.bitableRef.addEventListener("click",this._setActiveBitable,!0),this.shouldBindContainerEvent=!1)}},{key:"unbindBitableContainerEvent",value:function(){this.bitableRef&&(this.bitableRef.removeEventListener("mouseenter",this.hoverBitable),this.bitableRef.removeEventListener("mouseleave",this.leaveBitable),this.bitableRef.removeEventListener("click",this._setActiveBitable,!0),this.shouldBindContainerEvent=!0)}},{key:"getIsDocx",value:function(){return this.props.suiteType===O.NUM_FILE_TYPE.DOCX}},{key:"getBitableContainerStyle",value:function(){var e=this.props.isFullScreenMode,t=this.state,n=t.offsetX,r=t.docWidth,a=void 0===r?0:r;if(!e){var i=this.getActiveViewFromState();if(i&&i.type===I.ViewType.Grid)return{minWidth:a+n}}}},{key:"renderDocBitable",value:function(){var e=this.props,t=e.bitableStore,n=e.token,r=e.tableId,a=e.viewId,i=e.isFullScreenMode,o=e.shell,s=e.editbarPinChanged,l=e.mountOption,c=e.suiteType,u=this.state,d=u.maxWidth,h=u.maxHeight,f=u.offsetX,b=u.commentActionType,v=u.isSelect,p=u.docWidth,m=u.delayLoading,g=u.collapsed,y=l.overlayContainer,_=l.hideComment,w=l.isTemplateMode,S=c?O.SUITE_TO_MENTION_SOURCE[c]:O.SOURCE_ENUM.DOC,k=!(Object(j.a)()||Object(j.c)()||Object(j.b)()||_),C={attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:S},ui:{showComment:k,disableKeepViewPosition:!0}};return B.a.createElement(I.DocBitable,{token:n,bitableStore:t,renderer:this.renderer,isTemplateMode:w,smartableCommentManager:this.smartableCommentManager,tableId:r,viewId:a,IOConfig:{IO:O.IO.getInstance()},bitableConfig:C},B.a.createElement("div",{className:D()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":i}),ref:this.setBitableContainerRef,style:this.getBitableContainerStyle()},!i&&y?E.a.createPortal(this.renderOverlay(),y):null,a&&B.a.createElement(I.DocTableView,{bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,tableId:r,viewId:a,shell:o,maxWidth:d,maxHeight:h,offsetX:i?20:f,docWidth:p,commentActionType:b,isSelect:v,editbarPinChanged:s,renderEmbededToolbar:this.renderToolbar,notify:this.notify,isFullScreenMode:i,mountOption:l,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:this.state.zoom,ref:this.setBitableRef,delayLoading:m,collapsed:g,isVCEnable:Z})))}},{key:"renderDocxBitable",value:function(){var n=this,e=this.props,t=e.bitableStore,r=e.token,a=e.tableId,i=e.viewId,o=e.isFullScreenMode,s=e.shell,l=e.editbarPinChanged,c=e.mountOption,u=e.suiteType,d=this.state,h=d.maxWidth,f=d.maxHeight,b=d.commentActionType,v=d.isSelect,p=d.docWidth,m=d.delayLoading,g=d.collapsed,y=d.selectedStyle,_=c.overlayContainer,w=c.hideComment,S=c.isTemplateMode,k=u?O.SUITE_TO_MENTION_SOURCE[u]:O.SOURCE_ENUM.DOC,C=function(e,t){return n.renderScreenShotToolbar(e,t)},T={ui:{bitableWidgetUIConfig:{disableHScroll:!o,ganttWidgetUIConfig:{marginRight:o?null:0},gridWidgetUIConfig:{marginRight:0},galleryWidgetUIConfig:{marginLeft:0},keepLastColumn:!1},showComment:!(Object(j.a)()||Object(j.c)()||Object(j.b)()||w),kanbanNewRecordOverlay:!0,disableKeepViewPosition:!0},attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:k}};return B.a.createElement(I.DocBitable,{token:r,bitableStore:t,renderer:this.renderer,isTemplateMode:S,smartableCommentManager:this.smartableCommentManager,tableId:a,viewId:i,IOConfig:{IO:O.IO.getInstance()},bitableConfig:T},B.a.createElement("div",{className:D()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":o}),ref:this.setBitableContainerRef,style:this.getBitableContainerStyle()},!o&&_?E.a.createPortal(this.renderOverlay(),_):null,i&&B.a.createElement(I.DocxTableView,{bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,tableId:a,viewId:i,shell:s,maxWidth:h,maxHeight:f,offsetX:o?20:0,docWidth:p,commentActionType:b,isSelect:v,selectedStyle:y,editbarPinChanged:l,renderEmbededToolbar:this.renderToolbar,renderScreenShotToolbar:C,notify:this.notify,isFullScreenMode:o,mountOption:c,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:this.state.zoom,ref:this.setBitableRef,delayLoading:m,collapsed:g,isVCEnable:Z})))}},{key:"render",value:function(){var e=this.state.errorCodeType,t=this.getIsDocx()&&e===I.EErrorCodeType.dataError;return e===I.EErrorCodeType.none||t?this.getIsDocx()?this.renderDocxBitable():this.renderDocBitable():this.renderBlockError(e)}}]),l}(k.a);K.contextType=C.ReactReduxContext,W([Object(V.Bind)(),I.VCFollowReplayDecorator],K.prototype,"replayVCFollowState",null);var X=Object(C.connect)(function(e,t){var n=t.tableId,r=!O.SuiteReduxSelector||!O.SuiteReduxSelector.selectIsInEditMode||O.SuiteReduxSelector.selectIsInEditMode(e);return{tableId:n,viewId:Object(I.tableActiveViewIdSelector)(e,n),query:Object(O.selectQuery)(e),showFloatToolbar:Object(I.floatToolbarVisibilitySelector)(e,n),isEditing:Object(I.editingSelector)(e,n),fullScreenTableId:Object(I.getFullScreenTableId)(e),suiteType:O.SuiteReduxSelector.selectCurrentSuiteType(e),suiteToken:O.SuiteReduxSelector.selectCurrentSuiteToken(e),isEditMode:r,editable:Object(F.a)(e)}},{setFullScreenTableId:I.setFullScreenTableId,setFloatToolbarTable:I.setFloatToolbarTable})(K)}).call(this,Q("vb153"))},vb800:function(e,t,n){"use strict";var r=n("vb60"),a=n.n(r),i=n("vb56"),o=n.n(i),s=n("vb64"),l=n.n(s),c=n("vb234"),u=n.n(c),d=n("vb235"),h=n.n(d),f=n("vb574"),b=n("vb575"),v=n("vb58"),p=n.n(v),m=n("vb87"),g=n.n(m),y=n("vb90"),_=n("vb576"),w=n("vb241"),S=n.n(w),k=n("vb114"),C=n("vb325"),T=k.EmbeddedBitableHistoryForDoc,E=function(n){function r(e){var t;return u()(this,r),(t=n.call(this,e)||this).state={height:Math.round(.85*window.innerHeight)},t}return S()(r,n),h()(r,[{key:"componentDidMount",value:function(){var e=this;this._resizeHandler=function(){e.setState({height:Math.round(.85*window.innerHeight)})},window.addEventListener("resize",this._resizeHandler)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._resizeHandler)}},{key:"render",value:function(){return p.a.createElement("div",{className:"bitable-in-doc-history-mode bitable-in-doc",style:{height:this.state.height}},p.a.createElement(T,Object.assign({},this.props,{embeddedType:C.a.EmbeddedInDoc,hideTab:!0})))}}]),r}(p.a.Component),I=n("vb53");function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach(function(e){a()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}n.d(t,"a",function(){return x}),n.d(t,"b",function(){return D});var B=240,x={width:B,offsetX:0},D=function(){function t(e){var i=this;u()(this,t),this.components=e,this.containerSize={},this.maxWidth=B,this.docWidth=2*B,this.actionTypeMap=new Map,this.zoom=1,this.updateOverlayRafId=null,this.openHistoryPanel=function(e){i.historyOverlay=f.a.createForHistory();var t=I.store.getState(),n=Object(_.a)(t);Object(b.a)(function(){g.a.render(p.a.createElement(y.Provider,{store:n},p.a.createElement(E,Object.assign({},e,{io:I.IO.getInstance(),store:n,hideHistory:i.closeHistoryPanel}))),i.historyOverlay)})},this.closeHistoryPanel=function(){var e=i.historyOverlay;e&&(g.a.unmountComponentAtNode(e),f.a.remove(e),i.historyOverlay=null)},this.locateMention=function(){var r=l()(o.a.mark(function e(t,n,r){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.components.get(t)){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,a.locateMention(t,n,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(e,t,n){return r.apply(this,arguments)}}(),this.registerScrollContainerRef=function(e,t){var n=i.components.get(e);if(n)return n.registerScrollContainerRef&&n.registerScrollContainerRef(e,t)},this.updateErrorCodeType=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:k.EErrorCodeType.none,n=i.components.get(e);if(n)return n.updateErrorCodeType&&n.updateErrorCodeType(t)}}return h()(t,[{key:"setWidth",value:function(e,t,n){this.containerSize[e]||(this.containerSize[e]=M({},x)),this.containerSize[e].width=t,null!=n&&(this.containerSize[e].offsetX=n);var r=this.components.get(e);r&&(r.setMaxWidth(t),null!=n&&r.setOffsetX(n))}},{key:"setDocWidth",value:function(t,e){if(this.docWidth=t,e){var n=this.components.get(e);n&&n.setDocWidth(t)}else this.components.forEach(function(e){return e.setDocWidth(t)})}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"getWidth",value:function(){return this.maxWidth}},{key:"getDocWidth",value:function(){return this.docWidth}},{key:"getActionTypeMap",value:function(){return this.actionTypeMap}},{key:"setMaxWidth",value:function(e){var t=this;this.maxWidth=e,this.components.forEach(function(e){return e.setMaxWidth(t.maxWidth)})}},{key:"setHeight",value:function(t){this.height=t,this.components.forEach(function(e){return e.setHeight(t)})}},{key:"getHeight",value:function(){return this.height}},{key:"setSize",value:function(t,n){this.components.forEach(function(e){return e.setSize(t,n)})}},{key:"setZoom",value:function(t){this.zoom=t,this.components.forEach(function(e){return e.setZoom(t)})}},{key:"getZoom",value:function(){return this.zoom}},{key:"syncVirtualScroll",value:function(e){var n=this;e&&e.length?e.forEach(function(e){var t=n.components.get(e);t&&t.syncVirtualScroll()}):this.components.forEach(function(e){return e.syncVirtualScroll()})}},{key:"onBlockPositionChange",value:function(){var e=this;null!==this.updateOverlayRafId&&(cancelAnimationFrame(this.updateOverlayRafId),this.updateOverlayRafId=null),this.updateOverlayRafId=requestAnimationFrame(function(){e.updateOverlayRafId=null,e.components.forEach(function(e){return e.updateOverlayerPosition()})})}},{key:"currentScreenShot",value:function(e){var t=this.components.get(e);if(t)return t.currentScreenShot()}},{key:"takeScreenShot",value:function(){var r=l()(o.a.mark(function e(t,n,r){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=this.components.get(t))||!a.takeScreenShot){e.next=3;break}return e.abrupt("return",a.takeScreenShot(n,r));case 3:case"end":return e.stop()}},e,this)}));function e(e,t,n){return r.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(e){var t=this.components.get(e);return t&&t.getBitableViewScrollInfo?t.getBitableViewScrollInfo():{scrollPosX:0,contentWidth:0}}},{key:"setBitableViewScrollPosition",value:function(e,t,n){var r=this.components.get(e);if(r&&r.setBitableViewScrollPosition)return r.setBitableViewScrollPosition(t,n)}},{key:"updateSelectionState",value:function(e,t,n){var r=this.components.get(e);r&&r.updateSelect?r.updateSelect(t,n):console.warn("component not found, unable to update")}},{key:"updateHighlight",value:function(e,t){var n=this.components.get(e);n?n.updateHighlight(t):this.actionTypeMap.set(e,t)}},{key:"updateBitableContent",value:function(e){var t=this.components.get(e);t&&t.updateBitableContent()}},{key:"collapseLineChange",value:function(e,t){var n=this.components.get(e);n&&n.collapseLineChange(t)}},{key:"getSearchResult",value:function(e,t){var n=this.components.get(e);return n&&n.getSearchResult?n.getSearchResult(e,t):[]}},{key:"getSearchItemPos",value:function(e,t){var n=this.components.get(e);return n&&n.getSearchItemPos?n.getSearchItemPos(e,t):{x:0,y:0,width:0,height:0}}},{key:"highlightSearchItem",value:function(e,t,n){var r=this.components.get(e);r&&r.highlightSearchItem&&r.highlightSearchItem(e,t,n)}},{key:"clearHighlight",value:function(e,t){var n=this.components.get(e);n&&n.clearHighlight&&n.clearHighlight(e,t)}}]),t}()}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=vb_EmbeddedBitable_DocManager.6dca46f444.chunk.js